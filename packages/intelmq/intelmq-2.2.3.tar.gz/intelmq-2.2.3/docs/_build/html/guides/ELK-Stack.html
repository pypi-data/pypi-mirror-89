
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ELK Stack &#8212; intelmq 2.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Frequently asked questions" href="FAQ.html" />
    <link rel="prev" title="Available Feeds" href="Feeds.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="elk-stack">
<h1>ELK Stack<a class="headerlink" href="#elk-stack" title="Permalink to this headline">¶</a></h1>
<p>If you wish to run IntelMQ with ELK (Elasticsearch, Logstash, Kibana) it is entirely possible. This guide assumes the reader is familiar with basic configuration of ELK and does not aim to cover using ELK in general. It is based on the version 6.8.0 (ELK is a fast moving train therefore things might change). Assuming you have IntelMQ (and Redis) installation in place, lets dive in.</p>
<div class="section" id="configuring-intelmq-for-logstash">
<h2>Configuring IntelMQ for Logstash<a class="headerlink" href="#configuring-intelmq-for-logstash" title="Permalink to this headline">¶</a></h2>
<p>In order to pass IntelMQ events to Logstash we will utilize already installed Redis. Add a new Redis Output Bot to your pipeline. As the minimum fill in the following parameters: <code class="docutils literal notranslate"><span class="pre">bot-id</span></code>, <code class="docutils literal notranslate"><span class="pre">redis_server_ip</span></code> (can be hostname), <code class="docutils literal notranslate"><span class="pre">redis_server_port</span></code>, <code class="docutils literal notranslate"><span class="pre">redis_password</span></code> (if required, else set to empty!), <code class="docutils literal notranslate"><span class="pre">redis_queue</span></code> (name for the queue). Redis IP, port and password can be taken from <code class="docutils literal notranslate"><span class="pre">defaults.conf</span></code>. It is recommended to use a different <code class="docutils literal notranslate"><span class="pre">redis_db</span></code> parameter than used by the IntelMQ (specified in <code class="docutils literal notranslate"><span class="pre">defaults.conf</span></code> as <code class="docutils literal notranslate"><span class="pre">source_pipeline_db</span></code>, <code class="docutils literal notranslate"><span class="pre">destination_pipeline_db</span></code> and <code class="docutils literal notranslate"><span class="pre">statistics_database</span></code>).</p>
<p>Example values:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>bot-id: logstash-output
redis_server_ip: 10.10.10.10
redis_server_port: 6379
redis_db: 4
redis_queue: logstash-queue
</pre></div>
</div>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Unfortunately you will not be able to monitor this redis queue via IntelMQ Manager.</p></li>
</ul>
</div>
</div>
<div class="section" id="configuring-logstash">
<h2>Configuring Logstash<a class="headerlink" href="#configuring-logstash" title="Permalink to this headline">¶</a></h2>
<p>Logstash defines pipeline as well. In the pipeline configuration of Logstash you need to specify where it should look for IntelMQ events, what to do with them and where to pass them.</p>
<div class="section" id="input">
<h3>Input<a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h3>
<p>This part describes how to receive data from Redis queue.
See the example configuration and comments below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span> <span class="p">{</span>
  <span class="n">redis</span> <span class="p">{</span>
    <span class="n">host</span> <span class="o">=&gt;</span> <span class="s2">&quot;10.10.10.10&quot;</span>
    <span class="n">port</span> <span class="o">=&gt;</span> <span class="mi">6379</span>
    <span class="n">db</span> <span class="o">=&gt;</span> <span class="mi">4</span> 
    <span class="n">data_type</span> <span class="o">=&gt;</span> <span class="s2">&quot;list&quot;</span>
    <span class="n">key</span> <span class="o">=&gt;</span> <span class="s2">&quot;logstash-queue&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">host</span></code> - same as redis_server_ip from the Redis Output Bot</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code> - the redis_server_port from the Redis Output Bot</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">db</span></code> - the redis_db parameter from the Redis Output Bot</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_type</span></code> - set to <code class="docutils literal notranslate"><span class="pre">list</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> - same as redis_queue from the Redis Output Bot</p></li>
</ul>
<div class="section" id="id1">
<h4>Notes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>You can also use syntax like this: <code class="docutils literal notranslate"><span class="pre">host</span> <span class="pre">=&gt;</span> <span class="pre">&quot;${REDIS_HOST:10.10.10.10}&quot;</span></code><br />The value will be taken from environment variable <code class="docutils literal notranslate"><span class="pre">$REDIS_HOST</span></code>. If the environment variable is not defined then the default value of <code class="docutils literal notranslate"><span class="pre">10.10.10.10</span></code> will be used instead.</p></li>
</ul>
</div>
</div>
<div class="section" id="filter-optional">
<h3>Filter (optional)<a class="headerlink" href="#filter-optional" title="Permalink to this headline">¶</a></h3>
<p>Before passing the data to the database you can apply certain changes. This is done with filters. See an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="p">{</span>
  <span class="n">mutate</span> <span class="p">{</span>
    <span class="n">lowercase</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;source.geolocation.city&quot;</span><span class="p">,</span> <span class="s2">&quot;classification.identifier&quot;</span><span class="p">]</span>
    <span class="n">remove_field</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;__type&quot;</span><span class="p">,</span> <span class="s2">&quot;@version&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">date</span> <span class="p">{</span>
    <span class="n">match</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;time.observation&quot;</span><span class="p">,</span> <span class="s2">&quot;ISO8601&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="id2">
<h4>Notes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>It is not recommended to apply any modifications to the data (within the <code class="docutils literal notranslate"><span class="pre">mutate</span></code> key) outside of the IntelMQ. All necessary modifications should be done only by appropriate IntelMQ bots. This example only demonstrates the possibility.</p></li>
<li><p>It is recommended to use the <code class="docutils literal notranslate"><span class="pre">date</span></code> filter: generally we have two timestamp fields - <code class="docutils literal notranslate"><span class="pre">time.source</span></code> (provided by the feed source this can be understood as when the event happend; however it is not always present) and <code class="docutils literal notranslate"><span class="pre">time.observation</span></code> (when IntelMQ collected this event). Logstash also adds another field <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> with time of processing by Logstash. While it can be useful for debugging, I recommend to set the <code class="docutils literal notranslate"><span class="pre">&#64;timestamp</span></code> to the same value as <code class="docutils literal notranslate"><span class="pre">time.observation</span></code>.</p></li>
</ul>
</div>
</div>
<div class="section" id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<p>The pipeline also needs output, where we define our database (Elasticsearch). The simplest way of doing so is defining an output like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="p">{</span>
  <span class="n">elasticsearch</span> <span class="p">{</span>
    <span class="n">hosts</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;http://10.10.10.11:9200&quot;</span><span class="p">,</span> <span class="s2">&quot;http://10.10.10.12:9200&quot;</span><span class="p">]</span>
    <span class="n">index</span> <span class="o">=&gt;</span> <span class="s2">&quot;intelmq-%{+YYYY.MM}&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hosts</span></code> - Elasticsearch host (or more) with the correct port (9200 by default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code> - name of the index where to insert data</p></li>
</ul>
<div class="section" id="id3">
<h4>Notes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Authors experience, hardware equipment and the amount of events collected led to having a separate index for each month. This might not necessarily suit your needs, but is a suggested option.</p></li>
<li><p>By default the ELK stack uses unsecure HTTP. It is possible to setup Security for secure connections and basic user management. This is possible with the Basic (free) licence since versions 6.8.0 and 7.1.0.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="configuring-elasticsearch">
<h2>Configuring Elasticsearch<a class="headerlink" href="#configuring-elasticsearch" title="Permalink to this headline">¶</a></h2>
<p>Configuring Elasticsearch is entirely up to you and should be consulted with the <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/index.html">official documentation</a>. What you will most likely need is something called <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-templates.html">index template</a> mappings. IntelMQ provides a tool for generating such mappings. See <a class="reference external" href="https://github.com/certtools/intelmq/blob/master/ElasticMapper Tool">ElasticMapper Tool</a>.</p>
<div class="section" id="id4">
<h3>Notes<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Default installation of Elasticsearch database allows anyone with cURL and connection capability administrative access to the database. Make sure you secure your toys!</p></li>
</ul>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/Logo_Intel_MQ.svg" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">IntelMQ is a solution for IT security teams for collecting and processing security feeds using a message queuing protocol.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=certtools&repo=intelmq&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Ecosystem.html">IntelMQ Ecosystem</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Welcome to IntelMQ!</a></li>
<li class="toctree-l1"><a class="reference internal" href="INSTALL.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="UPGRADING.html">Upgrade instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="User-Guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="intelmqctl.html">intelmqctl documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bots.html">Bots Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Feeds.html">Available Feeds</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ELK Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="MISP-Integrations.html">MISP integrations in IntelMQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="n6-integrations.html">IntelMQ - n6 Integration</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Developers-Guide.html">Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data-Harmonization.html">Data Harmonization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Harmonization-fields.html">Harmonization field names</a></li>
<li class="toctree-l1"><a class="reference internal" href="Release.html">Release procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="IntelMQ-3.0-Architecture.html">Idea list and architecture of IntelMQ 3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="Feeds-whishlist.html">Feeds whishlist</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Feeds.html" title="previous chapter">Available Feeds</a></li>
      <li>Next: <a href="FAQ.html" title="next chapter">Frequently asked questions</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, cert.at.
      
      |
      <a href="../_sources/guides/ELK-Stack.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>