/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var F=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)a.hasOwnProperty(s)&&(n[s]=a[s])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),W=Object.prototype.hasOwnProperty;function g(e,t){return W.call(e,t)}function I(e){if(Array.isArray(e)){for(var r=new Array(e.length),t=0;t<r.length;t++)r[t]=""+t;return r}if(Object.keys)return Object.keys(e);var r=[];for(var n in e)g(e,n)&&r.push(n);return r}function l(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function R(e){for(var t=0,r=e.length,n;t<r;){if(n=e.charCodeAt(t),n>=48&&n<=57){t++;continue}return!1}return!0}function v(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function P(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function S(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,r=e.length;t<r;t++)if(S(e[t]))return!0}else if(typeof e=="object"){for(var n=I(e),a=n.length,t=0;t<a;t++)if(S(e[n[t]]))return!0}}return!1}function j(e,t){var r=[e];for(var n in t){var a=typeof t[n]=="object"?JSON.stringify(t[n],null,2):t[n];typeof a!="undefined"&&r.push(n+": "+a)}return r.join(`
`)}var D=function(e){F(t,e);function t(r,n,a,s,o){var i=this.constructor,u=e.call(this,j(r,{name:n,index:a,operation:s,tree:o}))||this;return u.name=n,u.index=a,u.operation=s,u.tree=o,Object.setPrototypeOf(u,i.prototype),u.message=j(r,{name:n,index:a,operation:s,tree:o}),u}return t}(Error),f=D,B=l,m={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var n=E(r,this.path);n&&(n=l(n));var a=O(r,{op:"remove",path:this.from}).removed;return O(r,{op:"add",path:this.path,value:a}),{newDocument:r,removed:n}},copy:function(e,t,r){var n=E(r,this.from);return O(r,{op:"add",path:this.path,value:l(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:w(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},Y={add:function(e,t,r){return R(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){var n=e.splice(t,1);return{newDocument:r,removed:n[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:m.move,copy:m.copy,test:m.test,_get:m._get};function E(e,t){if(t=="")return e;var r={op:"_get",path:t};return O(e,r),r.value}function O(e,t,r,n,a,s){if(r===void 0&&(r=!1),n===void 0&&(n=!0),a===void 0&&(a=!0),s===void 0&&(s=0),r&&(typeof r=="function"?r(t,0,e,t.path):A(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=E(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=w(e,t.value),o.test===!1)throw new f("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(r)throw new f("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{n||(e=l(e));var i=t.path||"",u=i.split("/"),p=e,h=1,d=u.length,y=void 0,c=void 0,N=void 0;for(typeof r=="function"?N=r:N=A;;){if(c=u[h],a&&c=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&(y===void 0&&(p[c]===void 0?y=u.slice(0,h).join("/"):h==d-1&&(y=t.path),y!==void 0&&N(t,0,e,y))),h++,Array.isArray(p)){if(c==="-")c=p.length;else{if(r&&!R(c))throw new f("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);R(c)&&(c=~~c)}if(h>=d){if(r&&t.op==="add"&&c>p.length)throw new f("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=Y[t.op].call(t,p,c,e);if(o.test===!1)throw new f("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(c&&c.indexOf("~")!=-1&&(c=P(c)),h>=d){var o=m[t.op].call(t,p,c,e);if(o.test===!1)throw new f("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}p=p[c]}}}function T(e,t,r,n,a){if(n===void 0&&(n=!0),a===void 0&&(a=!0),r&&!Array.isArray(t))throw new f("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=l(e));for(var s=new Array(t.length),o=0,i=t.length;o<i;o++)s[o]=O(e,t[o],r,!0,a,o),e=s[o].newDocument;return s.newDocument=e,s}function C(e,t,r){var n=O(e,t);if(n.test===!1)throw new f("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function A(e,t,r,n){if(typeof e!="object"||e===null||Array.isArray(e))throw new f("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(m[e.op]){if(typeof e.path!="string")throw new f("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new f('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new f("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new f("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&S(e.value))throw new f("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r){if(e.op=="add"){var a=e.path.split("/").length,s=n.split("/").length;if(a!==s+1&&a!==s)throw new f("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==n)throw new f("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},i=b([o],r);if(i&&i.name==="OPERATION_PATH_UNRESOLVABLE")throw new f("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new f("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function b(e,t,r){try{if(!Array.isArray(e))throw new f("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)T(l(t),l(e),r||!0);else{r=r||A;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(a){if(a instanceof f)return a;throw a}}function w(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Array.isArray(e),n=Array.isArray(t),a,s,o;if(r&&n){if(s=e.length,s!=t.length)return!1;for(a=s;a--!==0;)if(!w(e[a],t[a]))return!1;return!0}if(r!=n)return!1;var i=Object.keys(e);if(s=i.length,s!==Object.keys(t).length)return!1;for(a=s;a--!==0;)if(!t.hasOwnProperty(i[a]))return!1;for(a=s;a--!==0;)if(o=i[a],!w(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var G=Object.freeze({__proto__:null,JsonPatchError:f,deepClone:B,getValueByPointer:E,applyOperation:O,applyPatch:T,applyReducer:C,validator:A,validate:b,_areEquals:w});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var L=new WeakMap,q=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),z=function(){function e(t,r){this.callback=t,this.observer=r}return e}();function K(e){return L.get(e)}function Q(e,t){return e.observers.get(t)}function x(e,t){e.observers.delete(t.callback)}function U(e,t){t.unobserve()}function H(e,t){var r=[],n,a=K(e);if(!a)a=new q(e),L.set(e,a);else{var s=Q(a,t);n=s&&s.observer}if(n)return n;if(n={},a.value=l(e),t){n.callback=t,n.next=null;var o=function(){_(n)},i=function(){clearTimeout(n.next),n.next=setTimeout(o)};typeof window!="undefined"&&(window.addEventListener("mouseup",i),window.addEventListener("keyup",i),window.addEventListener("mousedown",i),window.addEventListener("keydown",i),window.addEventListener("change",i))}return n.patches=r,n.object=e,n.unobserve=function(){_(n),clearTimeout(n.next),x(a,n),typeof window!="undefined"&&(window.removeEventListener("mouseup",i),window.removeEventListener("keyup",i),window.removeEventListener("mousedown",i),window.removeEventListener("keydown",i),window.removeEventListener("change",i))},a.observers.set(t,new z(t,n)),n}function _(e,t){t===void 0&&(t=!1);var r=L.get(e.object);J(r.value,e.object,e.patches,"",t),e.patches.length&&T(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function J(e,t,r,n,a){if(t===e)return;typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=I(t),o=I(e),i=!1,u=o.length-1;u>=0;u--){var p=o[u],h=e[p];if(g(t,p)&&!(t[p]===void 0&&h!==void 0&&Array.isArray(t)===!1)){var d=t[p];typeof h=="object"&&h!=null&&typeof d=="object"&&d!=null?J(h,d,r,n+"/"+v(p),a):h!==d&&(a&&r.push({op:"test",path:n+"/"+v(p),value:l(h)}),r.push({op:"replace",path:n+"/"+v(p),value:l(d)}))}else Array.isArray(e)===Array.isArray(t)?(a&&r.push({op:"test",path:n+"/"+v(p),value:l(h)}),r.push({op:"remove",path:n+"/"+v(p)}),i=!0):(a&&r.push({op:"test",path:n,value:e}),r.push({op:"replace",path:n,value:t}))}if(!i&&s.length==o.length)return;for(var u=0;u<s.length;u++){var p=s[u];!g(e,p)&&t[p]!==void 0&&r.push({op:"add",path:n+"/"+v(p),value:l(t[p])})}}function M(e,t,r){r===void 0&&(r=!1);var n=[];return J(e,t,n,"",r),n}var X=Object.freeze({__proto__:null,unobserve:U,observe:H,generate:_,compare:M}),$=Object.assign({},G,X,{JsonPatchError:D,deepClone:l,escapePathComponent:v,unescapePathComponent:P});export default $;export{D as JsonPatchError,w as _areEquals,O as applyOperation,T as applyPatch,C as applyReducer,M as compare,l as deepClone,v as escapePathComponent,_ as generate,E as getValueByPointer,H as observe,P as unescapePathComponent,U as unobserve,b as validate,A as validator};
