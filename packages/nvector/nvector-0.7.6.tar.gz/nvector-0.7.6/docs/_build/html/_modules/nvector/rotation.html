

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>nvector.rotation &mdash; Nvector 0.7.6 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Nvector
          

          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro/index.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">2. Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/index.html">3. How-to guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/index.html">4. Topics guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">5. Reference nvector package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/authors.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/acknowledgement.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/index.html">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/zreferences.html">Bibliography</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Nvector</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>nvector.rotation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for nvector.rotation</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module related to rotation matrices and angles</span>
<span class="sd">==============================================</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">arctan2</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">nvector._common</span> <span class="kn">import</span> <span class="n">test_docstrings</span><span class="p">,</span> <span class="n">_make_summary</span>
<span class="kn">from</span> <span class="nn">nvector.util</span> <span class="kn">import</span> <span class="n">mdot</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">_check_length_deviation</span>
<span class="kn">from</span> <span class="nn">nvector</span> <span class="kn">import</span> <span class="n">license</span> <span class="k">as</span> <span class="n">_license</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E_rotation&#39;</span><span class="p">,</span>
           <span class="s1">&#39;n_E_and_wa2R_EL&#39;</span><span class="p">,</span>
           <span class="s1">&#39;n_E2R_EN&#39;</span><span class="p">,</span>
           <span class="s1">&#39;R_EL2n_E&#39;</span><span class="p">,</span>
           <span class="s1">&#39;R_EN2n_E&#39;</span><span class="p">,</span>
           <span class="s1">&#39;R2xyz&#39;</span><span class="p">,</span>
           <span class="s1">&#39;R2zyx&#39;</span><span class="p">,</span>
           <span class="s1">&#39;xyz2R&#39;</span><span class="p">,</span>
           <span class="s1">&#39;zyx2R&#39;</span><span class="p">]</span>

<span class="n">E_ROTATION_MATRIX</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                     <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]),</span>
                         <span class="n">E</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>


<div class="viewcode-block" id="E_rotation"><a class="viewcode-back" href="../../reference/generated/nvector.rotation.E_rotation.html#nvector.core.E_rotation">[docs]</a><span class="k">def</span> <span class="nf">E_rotation</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="s1">&#39;e&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns rotation matrix R_Ee defining the axes of the coordinate frame E.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    axes : &#39;e&#39; or &#39;E&#39;</span>
<span class="sd">        defines orientation of the axes of the coordinate frame E.</span>
<span class="sd">        If axes is &#39;e&#39; then z-axis points to the North Pole along the Earth&#39;s</span>
<span class="sd">        rotation axis, x-axis points towards the point where latitude = longitude = 0.</span>
<span class="sd">        If axes is &#39;E&#39; then x-axis points to the North Pole along the Earth&#39;s</span>
<span class="sd">        rotation axis, y-axis points towards longitude +90deg (east) and latitude = 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R_Ee : 3 x 3 array</span>
<span class="sd">        rotation matrix defining the axes of the coordinate frame E as</span>
<span class="sd">        described in Table 2 in Gade (2010).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    R_Ee controls the axes of the coordinate frame E (Earth-Centred,</span>
<span class="sd">    Earth-Fixed, ECEF) used by the other functions in this library.</span>
<span class="sd">    It is very common in many fields to choose axes equal to &#39;e&#39;.</span>
<span class="sd">    If you choose axes equal to &#39;E&#39; the yz-plane coincides with the equatorial</span>
<span class="sd">    plane. This choice of axis ensures that at zero latitude and longitude,</span>
<span class="sd">    frame N (North-East-Down) has the same orientation as frame E. If</span>
<span class="sd">    roll/pitch/yaw are zero, also frame B (forward-starboard-down) has this</span>
<span class="sd">    orientation. In this manner, the axes of frame E is chosen to correspond</span>
<span class="sd">    with the axes of frame N and B.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import nvector as nv</span>
<span class="sd">    &gt;&gt;&gt; np.allclose(nv.E_rotation(axes=&#39;e&#39;), [[ 0,  0,  1],</span>
<span class="sd">    ...                                       [ 0,  1,  0],</span>
<span class="sd">    ...                                       [-1,  0,  0]])</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; np.allclose(nv.E_rotation(axes=&#39;E&#39;), [[ 1.,  0.,  0.],</span>
<span class="sd">    ...                                       [ 0.,  1.,  0.],</span>
<span class="sd">    ...                                       [ 0.,  0.,  1.]])</span>
<span class="sd">    True</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Gade, K. (2010). `A Nonsingular Horizontal Position Representation,</span>
<span class="sd">    The Journal of Navigation, Volume 63, Issue 03, pp 395-417, July 2010.</span>
<span class="sd">    &lt;www.navlab.net/Publications/A_Nonsingular_Horizontal_Position_Representation.pdf&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">E_ROTATION_MATRIX</span><span class="p">[</span><span class="n">axes</span><span class="p">]</span></div>


<div class="viewcode-block" id="R2xyz"><a class="viewcode-back" href="../../reference/generated/nvector.rotation.R2xyz.html#nvector.core.R2xyz">[docs]</a><span class="k">def</span> <span class="nf">R2xyz</span><span class="p">(</span><span class="n">R_AB</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the angles about new axes in the xyz-order from a rotation matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R_AB: 3 x 3 x n array</span>
<span class="sd">        rotation matrix [no unit] (direction cosine matrix) such that the</span>
<span class="sd">        relation between a vector v decomposed in A and B is given by:</span>
<span class="sd">        v_A = mdot(R_AB, v_B)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    x, y, z: real scalars or array of length n.</span>
<span class="sd">        Angles [rad] of rotation about new axes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The x, y, z angles are called Euler angles or Tait-Bryan angles and are</span>
<span class="sd">    defined by the following procedure of successive rotations:</span>
<span class="sd">    Given two arbitrary coordinate frames A and B. Consider a temporary frame</span>
<span class="sd">    T that initially coincides with A. In order to make T align with B, we</span>
<span class="sd">    first rotate T an angle x about its x-axis (common axis for both A and T).</span>
<span class="sd">    Secondly, T is rotated an angle y about the NEW y-axis of T. Finally, T</span>
<span class="sd">    is rotated an angle z about its NEWEST z-axis. The final orientation of</span>
<span class="sd">    T now coincides with the orientation of B.</span>

<span class="sd">    The signs of the angles are given by the directions of the axes and the</span>
<span class="sd">    right hand rule.</span>

<span class="sd">    See also:</span>
<span class="sd">    https://en.wikipedia.org/wiki/Aircraft_principal_axes</span>
<span class="sd">    https://en.wikipedia.org/wiki/Euler_angles</span>
<span class="sd">    https://en.wikipedia.org/wiki/Axes_conventions</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    xyz2R, R2zyx, xyz2R</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">R_AB</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">R_AB</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>  <span class="c1"># atan2: [-pi pi]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">R_AB</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">R_AB</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>

    <span class="n">sin_y</span> <span class="o">=</span> <span class="n">R_AB</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

    <span class="c1"># cos_y is based on as many elements as possible, to average out</span>
    <span class="c1"># numerical errors. It is selected as the positive square root since</span>
    <span class="c1"># y: [-pi/2 pi/2]</span>
    <span class="n">cos_y</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">R_AB</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">R_AB</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                  <span class="o">+</span> <span class="n">R_AB</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">R_AB</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span><span class="n">sin_y</span><span class="p">,</span> <span class="n">cos_y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>


<div class="viewcode-block" id="R2zyx"><a class="viewcode-back" href="../../reference/generated/nvector.rotation.R2zyx.html#nvector.core.R2zyx">[docs]</a><span class="k">def</span> <span class="nf">R2zyx</span><span class="p">(</span><span class="n">R_AB</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the angles about new axes in the zxy-order from a rotation matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R_AB:  3x3 array</span>
<span class="sd">        rotation matrix [no unit] (direction cosine matrix) such that the</span>
<span class="sd">        relation between a vector v decomposed in A and B is given by:</span>
<span class="sd">        v_A = np.dot(R_AB, v_B)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    z, y, x: real scalars</span>
<span class="sd">        Angles [rad] of rotation about new axes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The z, x, y angles are called Euler angles or Tait-Bryan angles and are</span>
<span class="sd">    defined by the following procedure of successive rotations:</span>
<span class="sd">    Given two arbitrary coordinate frames A and B. Consider a temporary frame</span>
<span class="sd">    T that initially coincides with A. In order to make T align with B, we</span>
<span class="sd">    first rotate T an angle z about its z-axis (common axis for both A and T).</span>
<span class="sd">    Secondly, T is rotated an angle y about the NEW y-axis of T. Finally, T</span>
<span class="sd">    is rotated an angle x about its NEWEST x-axis. The final orientation of</span>
<span class="sd">    T now coincides with the orientation of B.</span>

<span class="sd">    The signs of the angles are given by the directions of the axes and the</span>
<span class="sd">    right hand rule.</span>

<span class="sd">    Note that if A is a north-east-down frame and B is a body frame, we</span>
<span class="sd">    have that z=yaw, y=pitch and x=roll.</span>

<span class="sd">    See also:</span>
<span class="sd">    https://en.wikipedia.org/wiki/Aircraft_principal_axes</span>
<span class="sd">    https://en.wikipedia.org/wiki/Euler_angles</span>
<span class="sd">    https://en.wikipedia.org/wiki/Axes_conventions</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    zyx2R, xyz2R, R2xyz</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">R2xyz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">R_AB</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">z</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span></div>


<div class="viewcode-block" id="R_EL2n_E"><a class="viewcode-back" href="../../reference/generated/nvector.rotation.R_EL2n_E.html#nvector.core.R_EL2n_E">[docs]</a><span class="k">def</span> <span class="nf">R_EL2n_E</span><span class="p">(</span><span class="n">R_EL</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns n-vector from the rotation matrix R_EL.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R_EL: 3 x 3 x n array</span>
<span class="sd">        Rotation matrix (direction cosine matrix) [no unit]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n_E: 3 x n array</span>
<span class="sd">        n-vector(s) [no unit] decomposed in E.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    R_EN2n_E, n_E_and_wa2R_EL, n_E2R_EN</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># n-vector equals minus the last column of R_EL and R_EN, see Section 5.5</span>
    <span class="c1"># in Gade (2010)</span>
    <span class="n">n_E</span> <span class="o">=</span> <span class="n">mdot</span><span class="p">(</span><span class="n">R_EL</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">n_E</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="R_EN2n_E"><a class="viewcode-back" href="../../reference/generated/nvector.rotation.R_EN2n_E.html#nvector.core.R_EN2n_E">[docs]</a><span class="k">def</span> <span class="nf">R_EN2n_E</span><span class="p">(</span><span class="n">R_EN</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns n-vector from the rotation matrix R_EN.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R_EN: 3 x 3 x n array</span>
<span class="sd">        Rotation matrix (direction cosine matrix) [no unit]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n_E: 3 x n array</span>
<span class="sd">        n-vector [no unit] decomposed in E.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    n_E2R_EN, R_EL2n_E, n_E_and_wa2R_EL</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># n-vector equals minus the last column of R_EL and R_EN, see Section 5.5</span>
    <span class="c1"># in Gade (2010)</span>
    <span class="k">return</span> <span class="n">R_EL2n_E</span><span class="p">(</span><span class="n">R_EN</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_atleast_3d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; from nvector.rotation import _atleast_3d</span>
<span class="sd">    &gt;&gt;&gt; for arr in _atleast_3d([1, 2], [[1, 2]], [[[1, 2]]]):</span>
<span class="sd">    ...     print(arr, arr.shape)</span>
<span class="sd">    [[[[[1 2]]]]] (1, 1, 1, 1, 2)</span>
<span class="sd">    [[[[[1 2]]]]] (1, 1, 1, 1, 2)</span>
<span class="sd">    [[[[[1 2]]]]] (1, 1, 1, 1, 2)</span>

<span class="sd">    &gt;&gt;&gt; for arr in _atleast_3d([[1], [2]], [[[1], [2]]], [[[[1], [2]]]]):</span>
<span class="sd">    ...     print(arr, arr.shape)</span>
<span class="sd">    [[[[[[1]</span>
<span class="sd">         [2]]]]]] (1, 1, 1, 1, 2, 1)</span>
<span class="sd">    [[[[[[1]</span>
<span class="sd">         [2]]]]]] (1, 1, 1, 1, 2, 1)</span>
<span class="sd">    [[[[[[1]</span>
<span class="sd">         [2]]]]]] (1, 1, 1, 1, 2, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">z</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>


<div class="viewcode-block" id="xyz2R"><a class="viewcode-back" href="../../reference/generated/nvector.rotation.xyz2R.html#nvector.core.xyz2R">[docs]</a><span class="k">def</span> <span class="nf">xyz2R</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns rotation matrix from 3 angles about new axes in the xyz-order.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x,y,z: real scalars or array of lengths n</span>
<span class="sd">        Angles [rad] of rotation about new axes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R_AB: 3 x 3 x n array</span>
<span class="sd">        rotation matrix [no unit] (direction cosine matrix) such that the</span>
<span class="sd">        relation between a vector v decomposed in A and B is given by:</span>
<span class="sd">        v_A = mdot(R_AB, v_B)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The rotation matrix R_AB is created based on 3 angles x,y,z about new axes</span>
<span class="sd">    (intrinsic) in the order x-y-z. The angles are called Euler angles or</span>
<span class="sd">    Tait-Bryan angles and are defined by the following procedure of successive</span>
<span class="sd">    rotations:</span>
<span class="sd">    Given two arbitrary coordinate frames A and B. Consider a temporary frame</span>
<span class="sd">    T that initially coincides with A. In order to make T align with B, we</span>
<span class="sd">    first rotate T an angle x about its x-axis (common axis for both A and T).</span>
<span class="sd">    Secondly, T is rotated an angle y about the NEW y-axis of T. Finally, T</span>
<span class="sd">    is rotated an angle z about its NEWEST z-axis. The final orientation of</span>
<span class="sd">    T now coincides with the orientation of B.</span>

<span class="sd">    The signs of the angles are given by the directions of the axes and the</span>
<span class="sd">    right hand rule.</span>

<span class="sd">     See also:</span>
<span class="sd">    https://en.wikipedia.org/wiki/Aircraft_principal_axes</span>
<span class="sd">    https://en.wikipedia.org/wiki/Euler_angles</span>
<span class="sd">    https://en.wikipedia.org/wiki/Axes_conventions</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    R2xyz, zyx2R, R2zyx</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">_atleast_3d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="n">R_AB</span> <span class="o">=</span> <span class="n">array</span><span class="p">([[</span><span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span><span class="p">,</span> <span class="o">-</span><span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sy</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">sy</span> <span class="o">*</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sz</span><span class="p">,</span> <span class="o">-</span><span class="n">sy</span> <span class="o">*</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cz</span><span class="p">,</span> <span class="o">-</span><span class="n">cy</span> <span class="o">*</span> <span class="n">sx</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">sy</span> <span class="o">*</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">+</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cz</span><span class="p">,</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cx</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">R_AB</span><span class="p">)</span></div>


<div class="viewcode-block" id="zyx2R"><a class="viewcode-back" href="../../reference/generated/nvector.rotation.zyx2R.html#nvector.core.zyx2R">[docs]</a><span class="k">def</span> <span class="nf">zyx2R</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns rotation matrix from 3 angles about new axes in the zyx-order.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z, y, x: real scalars or arrays of lenths n</span>
<span class="sd">        Angles [rad] of rotation about new axes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R_AB: 3 x 3 x n array</span>
<span class="sd">        rotation matrix [no unit] (direction cosine matrix) such that the</span>
<span class="sd">        relation between a vector v decomposed in A and B is given by:</span>
<span class="sd">        v_A = mdot(R_AB, v_B)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The rotation matrix R_AB is created based on 3 angles</span>
<span class="sd">    z,y,x about new axes (intrinsic) in the order z-y-x. The angles are called</span>
<span class="sd">    Euler angles or Tait-Bryan angles and are defined by the following</span>
<span class="sd">    procedure of successive rotations:</span>
<span class="sd">    Given two arbitrary coordinate frames A and B. Consider a temporary frame</span>
<span class="sd">    T that initially coincides with A. In order to make T align with B, we</span>
<span class="sd">    first rotate T an angle z about its z-axis (common axis for both A and T).</span>
<span class="sd">    Secondly, T is rotated an angle y about the NEW y-axis of T. Finally, T</span>
<span class="sd">    is rotated an angle x about its NEWEST x-axis. The final orientation of</span>
<span class="sd">    T now coincides with the orientation of B.</span>

<span class="sd">    The signs of the angles are given by the directions of the axes and the</span>
<span class="sd">    right hand rule.</span>

<span class="sd">    Note that if A is a north-east-down frame and B is a body frame, we</span>
<span class="sd">    have that z=yaw, y=pitch and x=roll.</span>

<span class="sd">    See also:</span>
<span class="sd">    https://en.wikipedia.org/wiki/Aircraft_principal_axes</span>
<span class="sd">    https://en.wikipedia.org/wiki/Euler_angles</span>
<span class="sd">    https://en.wikipedia.org/wiki/Axes_conventions</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Suppose the yaw angle between coordinate system A and B is 45 degrees.</span>
<span class="sd">    Convert position p1_b = (1, 0, 0) in B to a point in A.</span>
<span class="sd">    Convert position p2_a =(0, 1, 0) in A to a point in B.</span>

<span class="sd">    Solution:</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import nvector as nv</span>
<span class="sd">        &gt;&gt;&gt; x, y, z = nv.rad(0, 0, 45)</span>
<span class="sd">        &gt;&gt;&gt; R_AB = nv.zyx2R(z, y, x)</span>

<span class="sd">        &gt;&gt;&gt; p1_b = np.atleast_2d((1, 0, 0)).T</span>
<span class="sd">        &gt;&gt;&gt; p1_a = nv.mdot(R_AB, p1_b)</span>
<span class="sd">        &gt;&gt;&gt; np.allclose(p1_a, [[0.7071067811865476], [0.7071067811865476], [0.0]])</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; p2_a = np.atleast_2d((0, 1, 0)).T</span>
<span class="sd">        &gt;&gt;&gt; p2_b = nv.mdot(R_AB.T, p2_a)</span>
<span class="sd">        &gt;&gt;&gt; np.allclose(p2_b, [[0.7071067811865476], [0.7071067811865476], [0.0]])</span>
<span class="sd">        True</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    R2zyx, xyz2R, R2xyz</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">_atleast_3d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="n">R_AB</span> <span class="o">=</span> <span class="n">array</span><span class="p">([[</span><span class="n">cz</span> <span class="o">*</span> <span class="n">cy</span><span class="p">,</span> <span class="o">-</span><span class="n">sz</span> <span class="o">*</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">sx</span> <span class="o">+</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">cx</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">sz</span> <span class="o">*</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">sx</span><span class="p">,</span> <span class="o">-</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">sx</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">cx</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="n">sy</span><span class="p">,</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cx</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">R_AB</span><span class="p">)</span></div>


<div class="viewcode-block" id="n_E2lat_lon"><a class="viewcode-back" href="../../reference/generated/nvector.core.n_E2lat_lon.html#nvector.core.n_E2lat_lon">[docs]</a><span class="k">def</span> <span class="nf">n_E2lat_lon</span><span class="p">(</span><span class="n">n_E</span><span class="p">,</span> <span class="n">R_Ee</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts n-vector to latitude and longitude.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_E: 3 x n array</span>
<span class="sd">        n-vector [no unit] decomposed in E.</span>
<span class="sd">    R_Ee : 3 x 3 array</span>
<span class="sd">        rotation matrix defining the axes of the coordinate frame E.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    latitude, longitude: real scalars or vectors of length n.</span>
<span class="sd">        Geodetic latitude and longitude given in [rad]</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    lat_lon2n_E</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">R_Ee</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">R_Ee</span> <span class="o">=</span> <span class="n">E_rotation</span><span class="p">()</span>
    <span class="n">_check_length_deviation</span><span class="p">(</span><span class="n">n_E</span><span class="p">)</span>
    <span class="n">n_E0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R_Ee</span><span class="p">,</span> <span class="n">n_E</span><span class="p">)</span>

    <span class="c1"># Equation (5) in Gade (2010):</span>
    <span class="n">longitude</span> <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span><span class="n">n_E0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="o">-</span><span class="n">n_E0</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>

    <span class="c1"># Equation (6) in Gade (2010) (Robust numerical solution)</span>
    <span class="n">equatorial_component</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n_E0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">n_E0</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># vector component in the equatorial plane</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span><span class="n">n_E0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">equatorial_component</span><span class="p">)</span>
    <span class="c1"># atan() could also be used since latitude is within [-pi/2,pi/2]</span>

    <span class="c1"># latitude=asin(n_E0[0] is a theoretical solution, but close to the Poles</span>
    <span class="c1"># it is ill-conditioned which may lead to numerical inaccuracies (and it</span>
    <span class="c1"># will give imaginary results for norm(n_E)&gt;1)</span>
    <span class="k">return</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span></div>


<div class="viewcode-block" id="n_E2R_EN"><a class="viewcode-back" href="../../reference/generated/nvector.rotation.n_E2R_EN.html#nvector.core.n_E2R_EN">[docs]</a><span class="k">def</span> <span class="nf">n_E2R_EN</span><span class="p">(</span><span class="n">n_E</span><span class="p">,</span> <span class="n">R_Ee</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the rotation matrix R_EN from n-vector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_E: 3 x n array</span>
<span class="sd">        n-vector [no unit] decomposed in E</span>
<span class="sd">    R_Ee : 3 x 3 array</span>
<span class="sd">        rotation matrix defining the axes of the coordinate frame E.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R_EN:  3 x 3 x n array</span>
<span class="sd">        The resulting rotation matrix [no unit] (direction cosine matrix).</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    R_EN2n_E, n_E_and_wa2R_EL, R_EL2n_E</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">R_Ee</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">R_Ee</span> <span class="o">=</span> <span class="n">E_rotation</span><span class="p">()</span>
    <span class="n">_check_length_deviation</span><span class="p">(</span><span class="n">n_E</span><span class="p">)</span>
    <span class="n">n_E</span> <span class="o">=</span> <span class="n">unit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R_Ee</span><span class="p">,</span> <span class="n">n_E</span><span class="p">))</span>

    <span class="c1"># N coordinate frame (North-East-Down) is defined in Table 2 in Gade (2010)</span>
    <span class="c1"># Find z-axis of N (Nz):</span>
    <span class="n">Nz_E</span> <span class="o">=</span> <span class="o">-</span><span class="n">n_E</span>  <span class="c1"># z-axis of N (down) points opposite to n-vector</span>

    <span class="c1"># Find y-axis of N (East)(remember that N is singular at Poles)</span>
    <span class="c1"># Equation (9) in Gade (2010):</span>
    <span class="c1"># Ny points perpendicular to the plane</span>
    <span class="n">Ny_E_direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">n_E</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># formed by n-vector and Earth&#39;s spin axis</span>
    <span class="n">on_poles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">Ny_E_direction</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Ny_E</span> <span class="o">=</span> <span class="n">unit</span><span class="p">(</span><span class="n">Ny_E_direction</span><span class="p">)</span>
    <span class="n">Ny_E</span><span class="p">[:,</span> <span class="n">on_poles</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])</span>  <span class="c1"># selected y-axis direction</span>

    <span class="c1"># Find x-axis of N (North):</span>
    <span class="n">Nx_E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">Ny_E</span><span class="p">,</span> <span class="n">Nz_E</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Final axis found by right hand rule</span>

    <span class="c1"># Form R_EN from the unit vectors:</span>
    <span class="c1"># R_EN = dot(R_Ee.T, np.hstack((Nx_E, Ny_E, Nz_E)))</span>
    <span class="n">Nxyz_E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Nx_E</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
                        <span class="n">Ny_E</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
                        <span class="n">Nz_E</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]))</span>
    <span class="n">R_EN</span> <span class="o">=</span> <span class="n">mdot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">R_Ee</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Nxyz_E</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">R_EN</span><span class="p">)</span></div>


<div class="viewcode-block" id="n_E_and_wa2R_EL"><a class="viewcode-back" href="../../reference/generated/nvector.rotation.n_E_and_wa2R_EL.html#nvector.core.n_E_and_wa2R_EL">[docs]</a><span class="k">def</span> <span class="nf">n_E_and_wa2R_EL</span><span class="p">(</span><span class="n">n_E</span><span class="p">,</span> <span class="n">wander_azimuth</span><span class="p">,</span> <span class="n">R_Ee</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns rotation matrix R_EL from n-vector and wander azimuth angle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_E: 3 x n array</span>
<span class="sd">        n-vector [no unit] decomposed in E</span>
<span class="sd">    wander_azimuth: real scalar or array of length n</span>
<span class="sd">        Angle [rad] between L&#39;s x-axis and north, positive about L&#39;s z-axis.</span>
<span class="sd">    R_Ee : 3 x 3 array</span>
<span class="sd">        rotation matrix defining the axes of the coordinate frame E.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R_EL: 3 x 3 x n array</span>
<span class="sd">        The resulting rotation matrix.       [no unit]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    When wander_azimuth=0, we have that N=L.</span>
<span class="sd">    (See Table 2 in Gade (2010) for details)</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    R_EL2n_E, R_EN2n_E, n_E2R_EN</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">R_Ee</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">R_Ee</span> <span class="o">=</span> <span class="n">E_rotation</span><span class="p">()</span>
    <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">n_E2lat_lon</span><span class="p">(</span><span class="n">n_E</span><span class="p">,</span> <span class="n">R_Ee</span><span class="p">)</span>

    <span class="c1"># Reference: See start of Section 5.2 in Gade (2010):</span>
    <span class="n">R_EL</span> <span class="o">=</span> <span class="n">mdot</span><span class="p">(</span><span class="n">R_Ee</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">xyz2R</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="o">-</span><span class="n">latitude</span><span class="p">,</span> <span class="n">wander_azimuth</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">R_EL</span><span class="p">)</span></div>


<span class="n">_odict</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
<span class="vm">__doc__</span> <span class="o">=</span> <span class="p">(</span><span class="vm">__doc__</span>  <span class="c1"># @ReservedAssignment</span>
           <span class="o">+</span> <span class="n">_make_summary</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">_odict</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">__all__</span><span class="p">))</span>
           <span class="o">+</span> <span class="s1">&#39;License</span><span class="se">\n</span><span class="s1">-------</span><span class="se">\n</span><span class="s1">&#39;</span>
           <span class="o">+</span> <span class="n">_license</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_docstrings</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2020, Norwegian Defence Research Establishment (FFI)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>