function n(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function h(t,e,s){return t[e].findIndex(i=>Object.is(i,s))}function r(t,e,s){if(t[e]||(t[e]=[]),h(t,e,s)!==-1)return;t[e].push(s)}function o(t,e,s){if(t[e])if(!s)delete t[e];else{const i=h(t,e,s);i!==-1&&t[e].splice(i,1)}}function c(t,e){var s;(s=t[e.type])===null||s===void 0||s.forEach(i=>{try{i(e.data)}catch(a){const l=a instanceof Error?a:new Error(a);this.emit("ERROR",l)}})}export class WorkerSelf{constructor(){n(this,"listeners",{}),n(this,"onceListeners",{}),self.addEventListener("message",this.listener.bind(this)),this.on("INITIALIZE",({env:e})=>{self.__snowpack_env__=e})}listener(e){c.call(this,this.onceListeners,e.data),c.call(this,this.listeners,e.data),delete this.onceListeners[e.data.type]}emit(e,s){self.postMessage({type:e,data:s})}on(e,s){r(this.listeners,e,s)}off(e,s){o(this.listeners,e,s),o(this.onceListeners,e,s)}once(e,s){r(this.onceListeners,e,s)}}export class WebWorker extends Worker{constructor(...e){super(...e);n(this,"listeners",{}),n(this,"onceListeners",{}),this.addEventListener("message",this.listener.bind(this))}listener(e){c.call(this,this.onceListeners,e.data),c.call(this,this.listeners,e.data),delete this.onceListeners[e.data.type]}emit(e,s){this.postMessage({type:e,data:s})}on(e,s){r(this.listeners,e,s)}off(e,s){o(this.listeners,e,s),o(this.onceListeners,e,s)}once(e,s){r(this.onceListeners,e,s)}}
