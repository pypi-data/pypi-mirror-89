import{c as lt,a as K}from"./common/_commonjsHelpers-4f955397.js";var pt=lt(function(s,e){var r=K&&K.__values||function(M){var d=typeof Symbol=="function"&&M[Symbol.iterator],a=0;return d?d.call(M):{next:function(){return M&&a>=M.length&&(M=void 0),{value:M&&M[a++],done:!M}}}};Object.defineProperty(e,"__esModule",{value:!0});function t(M,d){return Math.floor(d()*M)}e.tauRandInt=t;function n(M){return M()}e.tauRand=n;function o(M){var d,a,g=0;try{for(var m=r(M),w=m.next();!w.done;w=m.next()){var j=w.value;g+=Math.pow(j,2)}}catch(V){d={error:V}}finally{try{w&&!w.done&&(a=m.return)&&a.call(m)}finally{if(d)throw d.error}}return Math.sqrt(g)}e.norm=o;function u(M){for(var d=[],a=0;a<M;a++)d.push(void 0);return d}e.empty=u;function c(M){return u(M).map(function(d,a){return a})}e.range=c;function p(M,d){return u(M).map(function(){return d})}e.filled=p;function y(M){return p(M,0)}e.zeros=y;function k(M){return p(M,1)}e.ones=k;function I(M,d,a){return u(a).map(function(g,m){return M+m*((d-M)/(a-1))})}e.linear=I;function v(M){return M.reduce(function(d,a){return d+a})}e.sum=v;function F(M){return v(M)/M.length}e.mean=F;function E(M){for(var d=0,a=0;a<M.length;a++)d=M[a]>d?M[a]:d;return d}e.max=E;function b(M){for(var d=0,a=0;a<M.length;a++)for(var g=0;g<M[a].length;g++)d=M[a][g]>d?M[a][g]:d;return d}e.max2d=b;function N(M,d,a){for(var g=y(M),m=0;m<M;m++)for(var w=!0;w;){for(var j=t(d,a),V=!1,i=0;i<m;i++)if(j===g[i]){V=!0;break}V||(w=!1),g[m]=j}return g}e.rejectionSample=N;function z(M,d,a){var g=[],m=0;if(M.length!==d*a)throw new Error("Array dimensions must match input length.");for(var w=0;w<d;w++){for(var j=[],V=0;V<a;V++)j.push(M[m]),m+=1;g.push(j)}return g}e.reshape2d=z}),Mt=lt(function(s,e){var r=K&&K.__importStar||function(v){if(v&&v.__esModule)return v;var F={};if(v!=null)for(var E in v)Object.hasOwnProperty.call(v,E)&&(F[E]=v[E]);return F.default=v,F};Object.defineProperty(e,"__esModule",{value:!0});var t=r(pt);function n(v,F){var E=function(N){return t.empty(v).map(function(){return t.filled(F,N)})},b=[];return b.push(E(-1)),b.push(E(Infinity)),b.push(E(0)),b}e.makeHeap=n;function o(v,F,E){for(var b=t.zeros(v),N=0;N<v;N++){for(var z=!0,M=0;z;){M=t.tauRandInt(F,E);for(var d=!1,a=0;a<N;a++)if(M===b[a]){d=!0;break}d||(z=!1)}b[N]=M}return b}e.rejectionSample=o;function u(v,F,E,b,N){F=Math.floor(F);var z=v[0][F],M=v[1][F],d=v[2][F];if(E>=M[0])return 0;for(var a=0;a<z.length;a++)if(b===z[a])return 0;return c(v,F,E,b,N)}e.heapPush=u;function c(v,F,E,b,N){var z=v[0][F],M=v[1][F],d=v[2][F];if(E>=M[0])return 0;M[0]=E,z[0]=b,d[0]=N;for(var a=0,g=0;;){var m=2*a+1,w=m+1,j=v[0][0].length;if(m>=j)break;if(w>=j)if(M[m]>E)g=m;else break;else if(M[m]>=M[w])if(E<M[m])g=m;else break;else if(E<M[w])g=w;else break;M[a]=M[g],z[a]=z[g],d[a]=d[g],a=g}return M[a]=E,z[a]=b,d[a]=N,1}e.uncheckedHeapPush=c;function p(v,F,E,b,N){for(var z=n(F,b),M=0;M<F;M++)for(var d=0;d<E;d++){if(v[0][M][d]<0)continue;var a=v[0][M][d],g=v[2][M][d],m=t.tauRand(N);u(z,M,m,a,g),u(z,a,m,M,g),v[2][M][d]=0}return z}e.buildCandidates=p;function y(v){for(var F=v[0],E=v[1],b=0;b<F.length;b++)for(var N=F[b],z=E[b],M=0;M<N.length-1;M++){var d=N.length-M-1,a=z.length-M-1,g=N[0];N[0]=N[d],N[d]=g;var m=z[0];z[0]=z[a],z[a]=m,k(z,N,a,0)}return{indices:F,weights:E}}e.deheapSort=y;function k(v,F,E,b){for(;b*2+1<E;){var N=b*2+1,z=N+1,M=b;if(v[M]<v[N]&&(M=N),z<E&&v[M]<v[z]&&(M=z),M===b)break;var d=v[b];v[b]=v[M],v[M]=d;var a=F[b];F[b]=F[M],F[M]=a,b=M}}function I(v,F){for(var E=v[0][F],b=v[1][F],N=v[2][F],z=Infinity,M=-1,d=0;d>E.length;d++)N[d]===1&&b[d]<z&&(z=b[d],M=d);return M>=0?(N[M]=0,Math.floor(E[M])):-1}e.smallestFlagged=I}),jt=lt(function(s,e){var r=K&&K.__read||function(a,g){var m=typeof Symbol=="function"&&a[Symbol.iterator];if(!m)return a;var w=m.call(a),j,V=[],i;try{for(;(g===void 0||g-- >0)&&!(j=w.next()).done;)V.push(j.value)}catch(l){i={error:l}}finally{try{j&&!j.done&&(m=w.return)&&m.call(w)}finally{if(i)throw i.error}}return V},t=K&&K.__values||function(a){var g=typeof Symbol=="function"&&a[Symbol.iterator],m=0;return g?g.call(a):{next:function(){return a&&m>=a.length&&(a=void 0),{value:a&&a[m++],done:!a}}}},n=K&&K.__importStar||function(a){if(a&&a.__esModule)return a;var g={};if(a!=null)for(var m in a)Object.hasOwnProperty.call(a,m)&&(g[m]=a[m]);return g.default=a,g};Object.defineProperty(e,"__esModule",{value:!0});var o,u=n(pt),c=function(){function a(g,m,w,j){if(this.entries=new Map,this.nRows=0,this.nCols=0,g.length!==m.length||g.length!==w.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=j[0],this.nCols=j[1];for(var V=0;V<w.length;V++){var i=g[V],l=m[V];this.checkDims(i,l);var f=this.makeKey(i,l);this.entries.set(f,{value:w[V],row:i,col:l})}}return a.prototype.makeKey=function(g,m){return g+":"+m},a.prototype.checkDims=function(g,m){var w=g<this.nRows&&m<this.nCols;if(!w)throw new Error("row and/or col specified outside of matrix dimensions")},a.prototype.set=function(g,m,w){this.checkDims(g,m);var j=this.makeKey(g,m);this.entries.has(j)?this.entries.get(j).value=w:this.entries.set(j,{value:w,row:g,col:m})},a.prototype.get=function(g,m,w){w===void 0&&(w=0),this.checkDims(g,m);var j=this.makeKey(g,m);return this.entries.has(j)?this.entries.get(j).value:w},a.prototype.getAll=function(g){g===void 0&&(g=!0);var m=[];return this.entries.forEach(function(w){m.push(w)}),g&&m.sort(function(w,j){return w.row===j.row?w.col-j.col:w.row-j.row}),m},a.prototype.getDims=function(){return[this.nRows,this.nCols]},a.prototype.getRows=function(){return Array.from(this.entries,function(g){var m=r(g,2),w=m[0],j=m[1];return j.row})},a.prototype.getCols=function(){return Array.from(this.entries,function(g){var m=r(g,2),w=m[0],j=m[1];return j.col})},a.prototype.getValues=function(){return Array.from(this.entries,function(g){var m=r(g,2),w=m[0],j=m[1];return j.value})},a.prototype.forEach=function(g){this.entries.forEach(function(m){return g(m.value,m.row,m.col)})},a.prototype.map=function(g){var m=[];this.entries.forEach(function(j){m.push(g(j.value,j.row,j.col))});var w=[this.nRows,this.nCols];return new a(this.getRows(),this.getCols(),m,w)},a.prototype.toArray=function(){var g=this,m=u.empty(this.nRows),w=m.map(function(){return u.zeros(g.nCols)});return this.entries.forEach(function(j){w[j.row][j.col]=j.value}),w},a}();e.SparseMatrix=c;function p(a){var g=[],m=[],w=[];a.forEach(function(V,i,l){g.push(i),m.push(l),w.push(V)});var j=[a.nCols,a.nRows];return new c(m,g,w,j)}e.transpose=p;function y(a){for(var g=r(a,1),m=g[0],w=new c([],[],[],a),j=0;j<m;j++)w.set(j,j,1);return w}e.identity=y;function k(a,g){return M(a,g,function(m,w){return m*w})}e.pairwiseMultiply=k;function I(a,g){return M(a,g,function(m,w){return m+w})}e.add=I;function v(a,g){return M(a,g,function(m,w){return m-w})}e.subtract=v;function F(a,g){return M(a,g,function(m,w){return m>w?m:w})}e.maximum=F;function E(a,g){return a.map(function(m){return m*g})}e.multiplyScalar=E;function b(a){for(var g=new Set,m=a.getValues(),w=a.getRows(),j=a.getCols(),V=0;V<m.length;V++)m[V]===0&&g.add(V);var i=function(_,S){return!g.has(S)},l=m.filter(i),f=w.filter(i),h=j.filter(i);return new c(f,h,l,a.getDims())}e.eliminateZeros=b;function N(a,g){g===void 0&&(g="l2");var m,w,j=z[g],V=new Map;a.forEach(function(S,R,T){var O=V.get(R)||[];O.push(T),V.set(R,O)});var i=new c([],[],[],a.getDims()),l=function(S){for(var R=V.get(S).sort(),T=R.map(function(L){return a.get(S,L)}),O=j(T),P=0;P<O.length;P++)i.set(S,R[P],O[P])};try{for(var f=t(V.keys()),h=f.next();!h.done;h=f.next()){var _=h.value;l(_)}}catch(S){m={error:S}}finally{try{h&&!h.done&&(w=f.return)&&w.call(f)}finally{if(m)throw m.error}}return i}e.normalize=N;var z=(o={},o.max=function(a){for(var g=-Infinity,m=0;m<a.length;m++)g=a[m]>g?a[m]:g;return a.map(function(w){return w/g})},o.l1=function(a){for(var g=0,m=0;m<a.length;m++)g+=a[m];return a.map(function(w){return w/g})},o.l2=function(a){for(var g=0,m=0;m<a.length;m++)g+=Math.pow(a[m],2);return a.map(function(w){return Math.sqrt(Math.pow(w,2)/g)})},o);function M(a,g,m){for(var w=new Set,j=[],V=[],i=[],l=function($,q){j.push($),V.push(q);var W=m(a.get($,q),g.get($,q));i.push(W)},f=a.getValues(),h=a.getRows(),_=a.getCols(),S=0;S<f.length;S++){var R=h[S],T=_[S],O=R+":"+T;w.add(O),l(R,T)}for(var P=g.getValues(),L=g.getRows(),C=g.getCols(),S=0;S<P.length;S++){var R=L[S],T=C[S],O=R+":"+T;if(w.has(O))continue;l(R,T)}var U=[a.nRows,a.nCols];return new c(j,V,i,U)}function d(a){var g=[];a.forEach(function(S,R,T){g.push({value:S,row:R,col:T})}),g.sort(function(S,R){return S.row===R.row?S.col-R.col:S.row-R.row});for(var m=[],w=[],j=[],V=-1,i=0;i<g.length;i++){var l=g[i],f=l.row,h=l.col,_=l.value;f!==V&&(V=f,j.push(i)),m.push(h),w.push(_)}return{indices:m,values:w,indptr:j}}e.getCSR=d}),kt=lt(function(s,e){var r=K&&K.__read||function(d,a){var g=typeof Symbol=="function"&&d[Symbol.iterator];if(!g)return d;var m=g.call(d),w,j=[],V;try{for(;(a===void 0||a-- >0)&&!(w=m.next()).done;)j.push(w.value)}catch(i){V={error:i}}finally{try{w&&!w.done&&(g=m.return)&&g.call(m)}finally{if(V)throw V.error}}return j},t=K&&K.__spread||function(){for(var d=[],a=0;a<arguments.length;a++)d=d.concat(r(arguments[a]));return d},n=K&&K.__values||function(d){var a=typeof Symbol=="function"&&d[Symbol.iterator],g=0;return a?a.call(d):{next:function(){return d&&g>=d.length&&(d=void 0),{value:d&&d[g++],done:!d}}}},o=K&&K.__importStar||function(d){if(d&&d.__esModule)return d;var a={};if(d!=null)for(var g in d)Object.hasOwnProperty.call(d,g)&&(a[g]=d[g]);return a.default=d,a};Object.defineProperty(e,"__esModule",{value:!0});var u=o(pt),c=function(){function d(a,g,m,w){this.hyperplanes=a,this.offsets=g,this.children=m,this.indices=w}return d}();e.FlatTree=c;function p(d,a,g,m){var w=Math.max(10,a),j=u.range(g).map(function(i,l){return y(d,w,l,m)}),V=j.map(function(i){return v(i,w)});return V}e.makeForest=p;function y(d,a,g,m){a===void 0&&(a=30);var w=u.range(d.length),j=k(d,w,a,g,m);return j}function k(d,a,g,m,w){if(g===void 0&&(g=30),a.length>g){var j=I(d,a,w),V=j.indicesLeft,i=j.indicesRight,l=j.hyperplane,f=j.offset,h=k(d,V,g,m+1,w),_=k(d,i,g,m+1,w),S={leftChild:h,rightChild:_,isLeaf:!1,hyperplane:l,offset:f};return S}else{var S={indices:a,isLeaf:!0};return S}}function I(d,a,g){var m=d[0].length,w=u.tauRandInt(a.length,g),j=u.tauRandInt(a.length,g);j+=w===j?1:0,j=j%a.length;for(var V=a[w],i=a[j],l=0,f=u.zeros(m),h=0;h<f.length;h++)f[h]=d[V][h]-d[i][h],l-=f[h]*(d[V][h]+d[i][h])/2;for(var _=0,S=0,R=u.zeros(a.length),h=0;h<a.length;h++){for(var T=l,O=0;O<m;O++)T+=f[O]*d[a[h]][O];T===0?(R[h]=u.tauRandInt(2,g),R[h]===0?_+=1:S+=1):T>0?(R[h]=0,_+=1):(R[h]=1,S+=1)}var P=u.zeros(_),L=u.zeros(S);_=0,S=0;for(var h=0;h<R.length;h++)R[h]===0?(P[_]=a[h],_+=1):(L[S]=a[h],S+=1);return{indicesLeft:P,indicesRight:L,hyperplane:f,offset:l}}function v(d,a){var g=E(d),m=b(d),w=u.range(g).map(function(){return u.zeros(d.hyperplane?d.hyperplane.length:0)}),j=u.zeros(g),V=u.range(g).map(function(){return[-1,-1]}),i=u.range(m).map(function(){return u.range(a).map(function(){return-1})});return F(d,w,j,V,i,0,0),new c(w,j,V,i)}function F(d,a,g,m,w,j,V){var i;if(d.isLeaf)return m[j][0]=-V,(i=w[V]).splice.apply(i,t([0,d.indices.length],d.indices)),V+=1,{nodeNum:j,leafNum:V};a[j]=d.hyperplane,g[j]=d.offset,m[j][0]=j+1;var l=j,f=F(d.leftChild,a,g,m,w,j+1,V);return j=f.nodeNum,V=f.leafNum,m[l][1]=j+1,f=F(d.rightChild,a,g,m,w,j+1,V),{nodeNum:f.nodeNum,leafNum:f.leafNum}}function E(d){return d.isLeaf?1:1+E(d.leftChild)+E(d.rightChild)}function b(d){return d.isLeaf?1:b(d.leftChild)+b(d.rightChild)}function N(d){var a,g;if(d.length>0){var m=[];try{for(var w=n(d),j=w.next();!j.done;j=w.next()){var V=j.value;m.push.apply(m,t(V.indices))}}catch(i){a={error:i}}finally{try{j&&!j.done&&(g=w.return)&&g.call(w)}finally{if(a)throw a.error}}return m}else return[[-1]]}e.makeLeafArray=N;function z(d,a,g,m){for(var w=a,j=0;j<g.length;j++)w+=d[j]*g[j];if(w===0){var V=u.tauRandInt(2,m);return V}else return w>0?0:1}function M(d,a,g){for(var m=0;a.children[m][0]>0;){var w=z(a.hyperplanes[m],a.offsets[m],d,g);w===0?m=a.children[m][0]:m=a.children[m][1]}var j=-1*a.children[m][0];return a.indices[j]}e.searchFlatTree=M}),Vt=lt(function(s,e){var r=K&&K.__values||function(v){var F=typeof Symbol=="function"&&v[Symbol.iterator],E=0;return F?F.call(v):{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}}},t=K&&K.__importStar||function(v){if(v&&v.__esModule)return v;var F={};if(v!=null)for(var E in v)Object.hasOwnProperty.call(v,E)&&(F[E]=v[E]);return F.default=v,F};Object.defineProperty(e,"__esModule",{value:!0});var n=t(Mt),o=t(jt),u=t(kt),c=t(pt);function p(v,F){return function(b,N,z,M,d,a,g,m){M===void 0&&(M=10),d===void 0&&(d=50),a===void 0&&(a=.001),g===void 0&&(g=.5),m===void 0&&(m=!0);for(var w=b.length,j=n.makeHeap(b.length,z),V=0;V<b.length;V++)for(var i=n.rejectionSample(z,b.length,F),l=0;l<i.length;l++){var f=v(b[V],b[i[l]]);n.heapPush(j,V,f,i[l],1),n.heapPush(j,i[l],f,V,1)}if(m)for(var h=0;h<N.length;h++)for(var V=0;V<N[h].length&&!(N[h][V]<0);V++)for(var l=V+1;l<N[h].length&&!(N[h][l]<0);l++){var f=v(b[N[h][V]],b[N[h][l]]);n.heapPush(j,N[h][V],f,N[h][l],1),n.heapPush(j,N[h][l],f,N[h][V],1)}for(var h=0;h<M;h++){for(var _=n.buildCandidates(j,w,z,d,F),S=0,V=0;V<w;V++)for(var l=0;l<d;l++){var R=Math.floor(_[0][V][l]);if(R<0||c.tauRand(F)<g)continue;for(var T=0;T<d;T++){var O=Math.floor(_[0][V][T]),P=_[2][V][l],L=_[2][V][T];if(O<0||!P&&!L)continue;var f=v(b[R],b[O]);S+=n.heapPush(j,R,f,O,1),S+=n.heapPush(j,O,f,R,1)}}if(S<=a*z*b.length)break}var C=n.deheapSort(j);return C}}e.makeNNDescent=p;function y(v){function F(b,N,z,M,d){for(var a=0;a<z.length;a++)for(var g=c.rejectionSample(b,N.length,d),m=0;m<g.length;m++){if(g[m]<0)continue;var w=v(N[g[m]],z[a]);n.heapPush(M,a,w,g[m],1)}}function E(b,N,z,M,d){for(var a=0;a<z.length;a++)for(var g=u.searchFlatTree(z[a],b,d),m=0;m<g.length;m++){if(g[m]<0)return;var w=v(N[g[m]],z[a]);n.heapPush(M,a,w,g[m],1)}}return{initFromRandom:F,initFromTree:E}}e.makeInitializations=y;function k(v){return function(E,b,N,z){for(var M,d,a=o.getCSR(b),g=a.indices,m=a.indptr,w=0;w<z.length;w++)for(var j=new Set(N[0][w]);;){var V=n.smallestFlagged(N,w);if(V===-1)break;var i=g.slice(m[V],m[V+1]);try{for(var l=r(i),f=l.next();!f.done;f=l.next()){var h=f.value;if(h===V||h===-1||j.has(h))continue;var _=v(E[h],z[w]);n.uncheckedHeapPush(N,w,_,h,1),j.add(h)}}catch(S){M={error:S}}finally{try{f&&!f.done&&(d=l.return)&&d.call(l)}finally{if(M)throw M.error}}}return N}}e.makeInitializedNNSearch=k;function I(v,F,E,b,N,z,M){var d,a,g=n.makeHeap(E.length,b);if(N(b,F,E,g,M),v)try{for(var m=r(v),w=m.next();!w.done;w=m.next()){var j=w.value;z(j,F,E,g,M)}}catch(V){d={error:V}}finally{try{w&&!w.done&&(a=m.return)&&a.call(m)}finally{if(d)throw d.error}}return g}e.initializeSearch=I});const Tt=Object.prototype.toString;function ht(s){return Tt.call(s).endsWith("Array]")}function Rt(s,e,r){let t=0;const n=r(e);for(let o=0;o<s.x.length;o++)t+=Math.abs(s.y[o]-n(s.x[o]));return t}function Ot(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ht(s))throw new TypeError("input must be an array");if(s.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,n=e.toIndex,o=n===void 0?s.length:n;if(t<0||t>=s.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>s.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var u=s[t],c=t+1;c<o;c++)s[c]>u&&(u=s[c]);return u}function Lt(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ht(s))throw new TypeError("input must be an array");if(s.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,n=e.toIndex,o=n===void 0?s.length:n;if(t<0||t>=s.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>s.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var u=s[t],c=t+1;c<o;c++)s[c]<u&&(u=s[c]);return u}function _t(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ht(s)){if(s.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(e.output!==void 0){if(!ht(e.output))throw new TypeError("output option must be an array if specified");r=e.output}else r=new Array(s.length);var t=Lt(s),n=Ot(s);if(t===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=e.min,u=o===void 0?e.autoMinMax?t:0:o,c=e.max,p=c===void 0?e.autoMinMax?n:1:c;if(u>=p)throw new RangeError("min option must be smaller than max option");for(var y=(p-u)/(n-t),k=0;k<s.length;k++)r[k]=(s[k]-t)*y+u;return r}const dt=" ".repeat(2),Nt=" ".repeat(4);function $t(){return zt(this)}function zt(s,e={}){const{maxRows:r=15,maxColumns:t=10,maxNumSize:n=8}=e;return`${s.constructor.name} {
${dt}[
${Nt}${Ct(s,r,t,n)}
${dt}]
${dt}rows: ${s.rows}
${dt}columns: ${s.columns}
}`}function Ct(s,e,r,t){const{rows:n,columns:o}=s,u=Math.min(n,e),c=Math.min(o,r),p=[];for(let y=0;y<u;y++){let k=[];for(let I=0;I<c;I++)k.push(Dt(s.get(y,I),t));p.push(`${k.join(" ")}`)}return c!==o&&(p[p.length-1]+=` ... ${o-r} more columns`),u!==n&&p.push(`... ${n-e} more rows`),p.join(`
${Nt}`)}function Dt(s,e){const r=String(s);if(r.length<=e)return r.padEnd(e," ");const t=s.toPrecision(e-2);if(t.length<=e)return t;const n=s.toExponential(e-2),o=n.indexOf("e"),u=n.slice(o);return n.slice(0,e-u.length)+u}function qt(s,e){s.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},s.prototype.addS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+t);return this},s.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+t.get(n,o));return this},s.add=function(t,n){const o=new e(t);return o.add(n)},s.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},s.prototype.subS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-t);return this},s.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-t.get(n,o));return this},s.sub=function(t,n){const o=new e(t);return o.sub(n)},s.prototype.subtract=s.prototype.sub,s.prototype.subtractS=s.prototype.subS,s.prototype.subtractM=s.prototype.subM,s.subtract=s.sub,s.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},s.prototype.mulS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*t);return this},s.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*t.get(n,o));return this},s.mul=function(t,n){const o=new e(t);return o.mul(n)},s.prototype.multiply=s.prototype.mul,s.prototype.multiplyS=s.prototype.mulS,s.prototype.multiplyM=s.prototype.mulM,s.multiply=s.mul,s.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},s.prototype.divS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/t);return this},s.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/t.get(n,o));return this},s.div=function(t,n){const o=new e(t);return o.div(n)},s.prototype.divide=s.prototype.div,s.prototype.divideS=s.prototype.divS,s.prototype.divideM=s.prototype.divM,s.divide=s.div,s.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},s.prototype.modS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%t);return this},s.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%t.get(n,o));return this},s.mod=function(t,n){const o=new e(t);return o.mod(n)},s.prototype.modulus=s.prototype.mod,s.prototype.modulusS=s.prototype.modS,s.prototype.modulusM=s.prototype.modM,s.modulus=s.mod,s.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},s.prototype.andS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&t);return this},s.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&t.get(n,o));return this},s.and=function(t,n){const o=new e(t);return o.and(n)},s.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},s.prototype.orS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|t);return this},s.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|t.get(n,o));return this},s.or=function(t,n){const o=new e(t);return o.or(n)},s.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},s.prototype.xorS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^t);return this},s.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^t.get(n,o));return this},s.xor=function(t,n){const o=new e(t);return o.xor(n)},s.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},s.prototype.leftShiftS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<t);return this},s.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<t.get(n,o));return this},s.leftShift=function(t,n){const o=new e(t);return o.leftShift(n)},s.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},s.prototype.signPropagatingRightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>t);return this},s.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>t.get(n,o));return this},s.signPropagatingRightShift=function(t,n){const o=new e(t);return o.signPropagatingRightShift(n)},s.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},s.prototype.rightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>t);return this},s.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>t.get(n,o));return this},s.rightShift=function(t,n){const o=new e(t);return o.rightShift(n)},s.prototype.zeroFillRightShift=s.prototype.rightShift,s.prototype.zeroFillRightShiftS=s.prototype.rightShiftS,s.prototype.zeroFillRightShiftM=s.prototype.rightShiftM,s.zeroFillRightShift=s.rightShift,s.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,~this.get(t,n));return this},s.not=function(t){const n=new e(t);return n.not()},s.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.abs(this.get(t,n)));return this},s.abs=function(t){const n=new e(t);return n.abs()},s.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acos(this.get(t,n)));return this},s.acos=function(t){const n=new e(t);return n.acos()},s.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acosh(this.get(t,n)));return this},s.acosh=function(t){const n=new e(t);return n.acosh()},s.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asin(this.get(t,n)));return this},s.asin=function(t){const n=new e(t);return n.asin()},s.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asinh(this.get(t,n)));return this},s.asinh=function(t){const n=new e(t);return n.asinh()},s.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atan(this.get(t,n)));return this},s.atan=function(t){const n=new e(t);return n.atan()},s.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atanh(this.get(t,n)));return this},s.atanh=function(t){const n=new e(t);return n.atanh()},s.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cbrt(this.get(t,n)));return this},s.cbrt=function(t){const n=new e(t);return n.cbrt()},s.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.ceil(this.get(t,n)));return this},s.ceil=function(t){const n=new e(t);return n.ceil()},s.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.clz32(this.get(t,n)));return this},s.clz32=function(t){const n=new e(t);return n.clz32()},s.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cos(this.get(t,n)));return this},s.cos=function(t){const n=new e(t);return n.cos()},s.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cosh(this.get(t,n)));return this},s.cosh=function(t){const n=new e(t);return n.cosh()},s.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.exp(this.get(t,n)));return this},s.exp=function(t){const n=new e(t);return n.exp()},s.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.expm1(this.get(t,n)));return this},s.expm1=function(t){const n=new e(t);return n.expm1()},s.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.floor(this.get(t,n)));return this},s.floor=function(t){const n=new e(t);return n.floor()},s.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.fround(this.get(t,n)));return this},s.fround=function(t){const n=new e(t);return n.fround()},s.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log(this.get(t,n)));return this},s.log=function(t){const n=new e(t);return n.log()},s.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log1p(this.get(t,n)));return this},s.log1p=function(t){const n=new e(t);return n.log1p()},s.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log10(this.get(t,n)));return this},s.log10=function(t){const n=new e(t);return n.log10()},s.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log2(this.get(t,n)));return this},s.log2=function(t){const n=new e(t);return n.log2()},s.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.round(this.get(t,n)));return this},s.round=function(t){const n=new e(t);return n.round()},s.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sign(this.get(t,n)));return this},s.sign=function(t){const n=new e(t);return n.sign()},s.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sin(this.get(t,n)));return this},s.sin=function(t){const n=new e(t);return n.sin()},s.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sinh(this.get(t,n)));return this},s.sinh=function(t){const n=new e(t);return n.sinh()},s.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sqrt(this.get(t,n)));return this},s.sqrt=function(t){const n=new e(t);return n.sqrt()},s.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tan(this.get(t,n)));return this},s.tan=function(t){const n=new e(t);return n.tan()},s.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tanh(this.get(t,n)));return this},s.tanh=function(t){const n=new e(t);return n.tanh()},s.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.trunc(this.get(t,n)));return this},s.trunc=function(t){const n=new e(t);return n.trunc()},s.pow=function(t,n){const o=new e(t);return o.pow(n)},s.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},s.prototype.powS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.pow(this.get(n,o),t));return this},s.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.pow(this.get(n,o),t.get(n,o)));return this}}function et(s,e,r){let t=r?s.rows:s.rows-1;if(e<0||e>t)throw new RangeError("Row index out of range")}function rt(s,e,r){let t=r?s.columns:s.columns-1;if(e<0||e>t)throw new RangeError("Column index out of range")}function at(s,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==s.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function ft(s,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==s.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function Ut(s,e,r){return{row:Bt(s,e),column:Wt(s,r)}}function Bt(s,e){if(typeof e!="object")throw new TypeError("unexpected type for row indices");let r=e.some(t=>t<0||t>=s.rows);if(r)throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function Wt(s,e){if(typeof e!="object")throw new TypeError("unexpected type for column indices");let r=e.some(t=>t<0||t>=s.columns);if(r)throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function Pt(s,e,r,t,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(St("startRow",e),St("endRow",r),St("startColumn",t),St("endColumn",n),e>r||t>n||e<0||e>=s.rows||r<0||r>=s.rows||t<0||t>=s.columns||n<0||n>=s.columns)throw new RangeError("Submatrix indices are out of range")}function yt(s,e=0){let r=[];for(let t=0;t<s;t++)r.push(e);return r}function St(s,e){if(typeof e!="number")throw new TypeError(`${s} must be a number`)}function Kt(s){let e=yt(s.rows);for(let r=0;r<s.rows;++r)for(let t=0;t<s.columns;++t)e[r]+=s.get(r,t);return e}function Gt(s){let e=yt(s.columns);for(let r=0;r<s.rows;++r)for(let t=0;t<s.columns;++t)e[t]+=s.get(r,t);return e}function Qt(s){let e=0;for(let r=0;r<s.rows;r++)for(let t=0;t<s.columns;t++)e+=s.get(r,t);return e}function Yt(s){let e=yt(s.rows,1);for(let r=0;r<s.rows;++r)for(let t=0;t<s.columns;++t)e[r]*=s.get(r,t);return e}function Xt(s){let e=yt(s.columns,1);for(let r=0;r<s.rows;++r)for(let t=0;t<s.columns;++t)e[t]*=s.get(r,t);return e}function Jt(s){let e=1;for(let r=0;r<s.rows;r++)for(let t=0;t<s.columns;t++)e*=s.get(r,t);return e}function Zt(s,e,r){const t=s.rows,n=s.columns,o=[];for(let u=0;u<t;u++){let c=0,p=0,y=0;for(let k=0;k<n;k++)y=s.get(u,k)-r[u],c+=y,p+=y*y;e?o.push((p-c*c/n)/(n-1)):o.push((p-c*c/n)/n)}return o}function Ht(s,e,r){const t=s.rows,n=s.columns,o=[];for(let u=0;u<n;u++){let c=0,p=0,y=0;for(let k=0;k<t;k++)y=s.get(k,u)-r[u],c+=y,p+=y*y;e?o.push((p-c*c/t)/(t-1)):o.push((p-c*c/t)/t)}return o}function At(s,e,r){const t=s.rows,n=s.columns,o=t*n;let u=0,c=0,p=0;for(let y=0;y<t;y++)for(let k=0;k<n;k++)p=s.get(y,k)-r,u+=p,c+=p*p;return e?(c-u*u/o)/(o-1):(c-u*u/o)/o}function xt(s,e){for(let r=0;r<s.rows;r++)for(let t=0;t<s.columns;t++)s.set(r,t,s.get(r,t)-e[r])}function te(s,e){for(let r=0;r<s.rows;r++)for(let t=0;t<s.columns;t++)s.set(r,t,s.get(r,t)-e[t])}function ee(s,e){for(let r=0;r<s.rows;r++)for(let t=0;t<s.columns;t++)s.set(r,t,s.get(r,t)-e)}function re(s){const e=[];for(let r=0;r<s.rows;r++){let t=0;for(let n=0;n<s.columns;n++)t+=Math.pow(s.get(r,n),2)/(s.columns-1);e.push(Math.sqrt(t))}return e}function ne(s,e){for(let r=0;r<s.rows;r++)for(let t=0;t<s.columns;t++)s.set(r,t,s.get(r,t)/e[r])}function oe(s){const e=[];for(let r=0;r<s.columns;r++){let t=0;for(let n=0;n<s.rows;n++)t+=Math.pow(s.get(n,r),2)/(s.rows-1);e.push(Math.sqrt(t))}return e}function se(s,e){for(let r=0;r<s.rows;r++)for(let t=0;t<s.columns;t++)s.set(r,t,s.get(r,t)/e[t])}function ie(s){const e=s.size-1;let r=0;for(let t=0;t<s.columns;t++)for(let n=0;n<s.rows;n++)r+=Math.pow(s.get(n,t),2)/e;return Math.sqrt(r)}function le(s,e){for(let r=0;r<s.rows;r++)for(let t=0;t<s.columns;t++)s.set(r,t,s.get(r,t)/e)}class B{static from1DArray(e,r,t){let n=e*r;if(n!==t.length)throw new RangeError("data length does not match given dimensions");let o=new D(e,r);for(let u=0;u<e;u++)for(let c=0;c<r;c++)o.set(u,c,t[u*r+c]);return o}static rowVector(e){let r=new D(1,e.length);for(let t=0;t<e.length;t++)r.set(0,t,e[t]);return r}static columnVector(e){let r=new D(e.length,1);for(let t=0;t<e.length;t++)r.set(t,0,e[t]);return r}static zeros(e,r){return new D(e,r)}static ones(e,r){return new D(e,r).fill(1)}static rand(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:n=Math.random}=t;let o=new D(e,r);for(let u=0;u<e;u++)for(let c=0;c<r;c++)o.set(u,c,n());return o}static randInt(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:o=1e3,random:u=Math.random}=t;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(n>=o)throw new RangeError("min must be smaller than max");let c=o-n,p=new D(e,r);for(let y=0;y<e;y++)for(let k=0;k<r;k++){let I=n+Math.round(u()*c);p.set(y,k,I)}return p}static eye(e,r,t){r===void 0&&(r=e),t===void 0&&(t=1);let n=Math.min(e,r),o=this.zeros(e,r);for(let u=0;u<n;u++)o.set(u,u,t);return o}static diag(e,r,t){let n=e.length;r===void 0&&(r=n),t===void 0&&(t=r);let o=Math.min(n,r,t),u=this.zeros(r,t);for(let c=0;c<o;c++)u.set(c,c,e[c]);return u}static min(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,n=e.columns,o=new D(t,n);for(let u=0;u<t;u++)for(let c=0;c<n;c++)o.set(u,c,Math.min(e.get(u,c),r.get(u,c)));return o}static max(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,n=e.columns,o=new this(t,n);for(let u=0;u<t;u++)for(let c=0;c<n;c++)o.set(u,c,Math.max(e.get(u,c),r.get(u,c)));return o}static checkMatrix(e){return B.isMatrix(e)?e:new D(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.call(this,r,t);return this}to1DArray(){let e=[];for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}to2DArray(){let e=[];for(let r=0;r<this.rows;r++){e.push([]);for(let t=0;t<this.columns;t++)e[r].push(this.get(r,t))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let r=0;r<=e;r++)if(this.get(e,r)!==this.get(r,e))return!1;return!0}return!1}isEchelonForm(){let e=0,r=0,t=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(n=!1,o=!0);e++}return n}isReducedEchelonForm(){let e=0,r=0,t=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(n=!1,o=!0);for(let u=r+1;u<this.rows;u++)this.get(e,u)!==0&&(n=!1);e++}return n}echelonForm(){let e=this.clone(),r=0,t=0;for(;r<e.rows&&t<e.columns;){let n=r;for(let o=r;o<e.rows;o++)e.get(o,t)>e.get(n,t)&&(n=o);if(e.get(n,t)===0)t++;else{e.swapRows(r,n);let o=e.get(r,t);for(let u=t;u<e.columns;u++)e.set(r,u,e.get(r,u)/o);for(let u=r+1;u<e.rows;u++){let c=e.get(u,t)/e.get(r,t);e.set(u,t,0);for(let p=t+1;p<e.columns;p++)e.set(u,p,e.get(u,p)-e.get(r,p)*c)}r++,t++}}return e}reducedEchelonForm(){let e=this.echelonForm(),r=e.columns,t=e.rows,n=t-1;for(;n>=0;)if(e.maxRow(n)===0)n--;else{let o=0,u=!1;for(;o<t&&u===!1;)e.get(n,o)===1?u=!0:o++;for(let c=0;c<n;c++){let p=e.get(c,o);for(let y=o;y<r;y++){let k=e.get(c,y)-p*e.get(n,y);e.set(c,y,k)}}n--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:t=1}=e;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let n=new D(this.rows*r,this.columns*t);for(let o=0;o<r;o++)for(let u=0;u<t;u++)n.setSubMatrix(this,this.rows*o,this.columns*u);return n}fill(e){for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,e);return this}neg(){return this.mulS(-1)}getRow(e){et(this,e);let r=[];for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}getRowVector(e){return D.rowVector(this.getRow(e))}setRow(e,r){et(this,e),r=at(this,r);for(let t=0;t<this.columns;t++)this.set(e,t,r[t]);return this}swapRows(e,r){et(this,e),et(this,r);for(let t=0;t<this.columns;t++){let n=this.get(e,t);this.set(e,t,this.get(r,t)),this.set(r,t,n)}return this}getColumn(e){rt(this,e);let r=[];for(let t=0;t<this.rows;t++)r.push(this.get(t,e));return r}getColumnVector(e){return D.columnVector(this.getColumn(e))}setColumn(e,r){rt(this,e),r=ft(this,r);for(let t=0;t<this.rows;t++)this.set(t,e,r[t]);return this}swapColumns(e,r){rt(this,e),rt(this,r);for(let t=0;t<this.rows;t++){let n=this.get(t,e);this.set(t,e,this.get(t,r)),this.set(t,r,n)}return this}addRowVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[t]);return this}subRowVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[t]);return this}mulRowVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[t]);return this}divRowVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[t]);return this}addColumnVector(e){e=ft(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[r]);return this}subColumnVector(e){e=ft(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[r]);return this}mulColumnVector(e){e=ft(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[r]);return this}divColumnVector(e){e=ft(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[r]);return this}mulRow(e,r){et(this,e);for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r);return this}mulColumn(e,r){rt(this,e);for(let t=0;t<this.rows;t++)this.set(t,e,this.get(t,e)*r);return this}max(){let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxIndex(){let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n),r[0]=t,r[1]=n);return r}min(){let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.get(r,t)<e&&(e=this.get(r,t));return e}minIndex(){let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n),r[0]=t,r[1]=n);return r}maxRow(e){et(this,e);let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)>r&&(r=this.get(e,t));return r}maxRowIndex(e){et(this,e);let r=this.get(e,0),t=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)>r&&(r=this.get(e,n),t[1]=n);return t}minRow(e){et(this,e);let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)<r&&(r=this.get(e,t));return r}minRowIndex(e){et(this,e);let r=this.get(e,0),t=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)<r&&(r=this.get(e,n),t[1]=n);return t}maxColumn(e){rt(this,e);let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxColumnIndex(e){rt(this,e);let r=this.get(0,e),t=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)>r&&(r=this.get(n,e),t[0]=n);return t}minColumn(e){rt(this,e);let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)<r&&(r=this.get(t,e));return r}minColumnIndex(e){rt(this,e);let r=this.get(0,e),t=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)<r&&(r=this.get(n,e),t[0]=n);return t}diag(){let e=Math.min(this.rows,this.columns),r=[];for(let t=0;t<e;t++)r.push(this.get(t,t));return r}norm(e="frobenius"){let r=0;if(e==="max")return this.max();if(e==="frobenius"){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)r=r+this.get(t,n)*this.get(t,n);return Math.sqrt(r)}else throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){let e=0;for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e+=this.get(r,t),this.set(r,t,e);return this}dot(e){B.isMatrix(e)&&(e=e.to1DArray());let r=this.to1DArray();if(r.length!==e.length)throw new RangeError("vectors do not have the same size");let t=0;for(let n=0;n<r.length;n++)t+=r[n]*e[n];return t}mmul(e){e=D.checkMatrix(e);let r=this.rows,t=this.columns,n=e.columns,o=new D(r,n),u=new Float64Array(t);for(let c=0;c<n;c++){for(let p=0;p<t;p++)u[p]=e.get(p,c);for(let p=0;p<r;p++){let y=0;for(let k=0;k<t;k++)y+=this.get(p,k)*u[k];o.set(p,c,y)}}return o}strassen2x2(e){e=D.checkMatrix(e);let r=new D(2,2);const t=this.get(0,0),n=e.get(0,0),o=this.get(0,1),u=e.get(0,1),c=this.get(1,0),p=e.get(1,0),y=this.get(1,1),k=e.get(1,1),I=(t+y)*(n+k),v=(c+y)*n,F=t*(u-k),E=y*(p-n),b=(t+o)*k,N=(c-t)*(n+u),z=(o-y)*(p+k),M=I+E-b+z,d=F+b,a=v+E,g=I-v+F+N;return r.set(0,0,M),r.set(0,1,d),r.set(1,0,a),r.set(1,1,g),r}strassen3x3(e){e=D.checkMatrix(e);let r=new D(3,3);const t=this.get(0,0),n=this.get(0,1),o=this.get(0,2),u=this.get(1,0),c=this.get(1,1),p=this.get(1,2),y=this.get(2,0),k=this.get(2,1),I=this.get(2,2),v=e.get(0,0),F=e.get(0,1),E=e.get(0,2),b=e.get(1,0),N=e.get(1,1),z=e.get(1,2),M=e.get(2,0),d=e.get(2,1),a=e.get(2,2),g=(t+n+o-u-c-k-I)*N,m=(t-u)*(-F+N),w=c*(-v+F+b-N-z-M+a),j=(-t+u+c)*(v-F+N),V=(u+c)*(-v+F),i=t*v,l=(-t+y+k)*(v-E+z),f=(-t+y)*(E-z),h=(y+k)*(-v+E),_=(t+n+o-c-p-y-k)*z,S=k*(-v+E+b-N-z-M+d),R=(-o+k+I)*(N+M-d),T=(o-I)*(N-d),O=o*M,P=(k+I)*(-M+d),L=(-o+c+p)*(z+M-a),C=(o-p)*(z-a),U=(c+p)*(-M+a),$=n*b,q=p*d,W=u*E,G=y*F,Q=I*a,J=i+O+$,Y=g+j+V+i+R+O+P,H=i+l+h+_+O+L+U,X=m+w+j+i+O+L+C,A=m+j+V+i+q,nt=O+L+C+U+W,x=i+l+f+S+R+T+O,st=R+T+O+P+G,ot=i+l+f+h+Q;return r.set(0,0,J),r.set(0,1,Y),r.set(0,2,H),r.set(1,0,X),r.set(1,1,A),r.set(1,2,nt),r.set(2,0,x),r.set(2,1,st),r.set(2,2,ot),r}mmulStrassen(e){e=D.checkMatrix(e);let r=this.clone(),t=r.rows,n=r.columns,o=e.rows,u=e.columns;n!==o&&console.warn(`Multiplying ${t} x ${n} and ${o} x ${u} matrix: dimensions do not match.`);function c(I,v,F){let E=I.rows,b=I.columns;if(E===v&&b===F)return I;{let N=B.zeros(v,F);return N=N.setSubMatrix(I,0,0),N}}let p=Math.max(t,o),y=Math.max(n,u);r=c(r,p,y),e=c(e,p,y);function k(I,v,F,E){if(F<=512||E<=512)return I.mmul(v);F%2===1&&E%2===1?(I=c(I,F+1,E+1),v=c(v,F+1,E+1)):F%2===1?(I=c(I,F+1,E),v=c(v,F+1,E)):E%2===1&&(I=c(I,F,E+1),v=c(v,F,E+1));let b=parseInt(I.rows/2,10),N=parseInt(I.columns/2,10),z=I.subMatrix(0,b-1,0,N-1),M=v.subMatrix(0,b-1,0,N-1),d=I.subMatrix(0,b-1,N,I.columns-1),a=v.subMatrix(0,b-1,N,v.columns-1),g=I.subMatrix(b,I.rows-1,0,N-1),m=v.subMatrix(b,v.rows-1,0,N-1),w=I.subMatrix(b,I.rows-1,N,I.columns-1),j=v.subMatrix(b,v.rows-1,N,v.columns-1),V=k(B.add(z,w),B.add(M,j),b,N),i=k(B.add(g,w),M,b,N),l=k(z,B.sub(a,j),b,N),f=k(w,B.sub(m,M),b,N),h=k(B.add(z,d),j,b,N),_=k(B.sub(g,z),B.add(M,a),b,N),S=k(B.sub(d,w),B.add(m,j),b,N),R=B.add(V,f);R.sub(h),R.add(S);let T=B.add(l,h),O=B.add(i,f),P=B.sub(V,i);P.add(l),P.add(_);let L=B.zeros(2*R.rows,2*R.columns);return L=L.setSubMatrix(R,0,0),L=L.setSubMatrix(T,R.rows,0),L=L.setSubMatrix(O,0,R.columns),L=L.setSubMatrix(P,R.rows,R.columns),L.subMatrix(0,F-1,0,E-1)}return k(r,e,p,y)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let n=new D(this.rows,this.columns);for(let o=0;o<this.rows;o++){const u=this.getRow(o);_t(u,{min:r,max:t,output:u}),n.setRow(o,u)}return n}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let n=new D(this.rows,this.columns);for(let o=0;o<this.columns;o++){const u=this.getColumn(o);_t(u,{min:r,max:t,output:u}),n.setColumn(o,u)}return n}flipRows(){const e=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let t=0;t<e;t++){let n=this.get(r,t),o=this.get(r,this.columns-1-t);this.set(r,t,o),this.set(r,this.columns-1-t,n)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let t=0;t<e;t++){let n=this.get(t,r),o=this.get(this.rows-1-t,r);this.set(t,r,o),this.set(this.rows-1-t,r,n)}return this}kroneckerProduct(e){e=D.checkMatrix(e);let r=this.rows,t=this.columns,n=e.rows,o=e.columns,u=new D(r*n,t*o);for(let c=0;c<r;c++)for(let p=0;p<t;p++)for(let y=0;y<n;y++)for(let k=0;k<o;k++)u.set(n*c+y,o*p+k,this.get(c,p)*e.get(y,k));return u}transpose(){let e=new D(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(t,r,this.get(r,t));return e}sortRows(e=It){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(e));return this}sortColumns(e=It){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(e));return this}subMatrix(e,r,t,n){Pt(this,e,r,t,n);let o=new D(r-e+1,n-t+1);for(let u=e;u<=r;u++)for(let c=t;c<=n;c++)o.set(u-e,c-t,this.get(u,c));return o}subMatrixRow(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.columns-1),r>t||r<0||r>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let n=new D(e.length,t-r+1);for(let o=0;o<e.length;o++)for(let u=r;u<=t;u++){if(e[o]<0||e[o]>=this.rows)throw new RangeError(`Row index out of range: ${e[o]}`);n.set(o,u-r,this.get(e[o],u))}return n}subMatrixColumn(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.rows-1),r>t||r<0||r>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let n=new D(t-r+1,e.length);for(let o=0;o<e.length;o++)for(let u=r;u<=t;u++){if(e[o]<0||e[o]>=this.columns)throw new RangeError(`Column index out of range: ${e[o]}`);n.set(u-r,o,this.get(u,e[o]))}return n}setSubMatrix(e,r,t){e=D.checkMatrix(e);let n=r+e.rows-1,o=t+e.columns-1;Pt(this,r,n,t,o);for(let u=0;u<e.rows;u++)for(let c=0;c<e.columns;c++)this.set(r+u,t+c,e.get(u,c));return this}selection(e,r){let t=Ut(this,e,r),n=new D(e.length,r.length);for(let o=0;o<t.row.length;o++){let u=t.row[o];for(let c=0;c<t.column.length;c++){let p=t.column[c];n.set(o,c,this.get(u,p))}}return n}trace(){let e=Math.min(this.rows,this.columns),r=0;for(let t=0;t<e;t++)r+=this.get(t,t);return r}clone(){let e=new D(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(r,t,this.get(r,t));return e}sum(e){switch(e){case"row":return Kt(this);case"column":return Gt(this);case void 0:return Qt(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return Yt(this);case"column":return Xt(this);case void 0:return Jt(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const r=this.sum(e);switch(e){case"row":{for(let t=0;t<this.rows;t++)r[t]/=this.columns;return r}case"column":{for(let t=0;t<this.columns;t++)r[t]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:n=this.mean(e)}=r;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!Array.isArray(n))throw new TypeError("mean must be an array");return Zt(this,t,n)}case"column":{if(!Array.isArray(n))throw new TypeError("mean must be an array");return Ht(this,t,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return At(this,t,n)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,r){typeof e=="object"&&(r=e,e=void 0);const t=this.variance(e,r);if(e===void 0)return Math.sqrt(t);for(let n=0;n<t.length;n++)t[n]=Math.sqrt(t[n]);return t}center(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:t=this.mean(e)}=r;switch(e){case"row":{if(!Array.isArray(t))throw new TypeError("center must be an array");return xt(this,t),this}case"column":{if(!Array.isArray(t))throw new TypeError("center must be an array");return te(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return ee(this,t),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let t=r.scale;switch(e){case"row":{if(t===void 0)t=re(this);else if(!Array.isArray(t))throw new TypeError("scale must be an array");return ne(this,t),this}case"column":{if(t===void 0)t=oe(this);else if(!Array.isArray(t))throw new TypeError("scale must be an array");return se(this,t),this}case void 0:{if(t===void 0)t=ie(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return le(this,t),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return zt(this,e)}}B.prototype.klass="Matrix",typeof Symbol!="undefined"&&(B.prototype[Symbol.for("nodejs.util.inspect.custom")]=$t);function It(s,e){return s-e}B.random=B.rand,B.randomInt=B.randInt,B.diagonal=B.diag,B.prototype.diagonal=B.prototype.diag,B.identity=B.eye,B.prototype.negate=B.prototype.neg,B.prototype.tensorProduct=B.prototype.kroneckerProduct;class D extends B{constructor(e,r){super();if(D.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>0)if(this.data=[],Number.isInteger(r)&&r>0)for(let t=0;t<e;t++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(Array.isArray(e)){const t=e;if(e=t.length,r=t[0].length,typeof r!="number"||r===0)throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(t[n].length!==r)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(t[n]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=e,this.columns=r}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}removeRow(e){if(et(this,e),this.rows===1)throw new RangeError("A matrix cannot have less than one row");return this.data.splice(e,1),this.rows-=1,this}addRow(e,r){return r===void 0&&(r=e,e=this.rows),et(this,e,!0),r=Float64Array.from(at(this,r)),this.data.splice(e,0,r),this.rows+=1,this}removeColumn(e){if(rt(this,e),this.columns===1)throw new RangeError("A matrix cannot have less than one column");for(let r=0;r<this.rows;r++){const t=new Float64Array(this.columns-1);for(let n=0;n<e;n++)t[n]=this.data[r][n];for(let n=e+1;n<this.columns;n++)t[n-1]=this.data[r][n];this.data[r]=t}return this.columns-=1,this}addColumn(e,r){typeof r=="undefined"&&(r=e,e=this.columns),rt(this,e,!0),r=ft(this,r);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns+1);let o=0;for(;o<e;o++)n[o]=this.data[t][o];for(n[o++]=r[t];o<this.columns+1;o++)n[o]=this.data[t][o-1];this.data[t]=n}return this.columns+=1,this}}qt(B,D);class ct extends B{constructor(e){super();this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}}class he{constructor(e){e=ct.checkMatrix(e);let r=e.clone(),t=r.rows,n=r.columns,o=new Float64Array(t),u=1,c,p,y,k,I,v,F,E,b;for(c=0;c<t;c++)o[c]=c;for(E=new Float64Array(t),p=0;p<n;p++){for(c=0;c<t;c++)E[c]=r.get(c,p);for(c=0;c<t;c++){for(b=Math.min(c,p),I=0,y=0;y<b;y++)I+=r.get(c,y)*E[y];E[c]-=I,r.set(c,p,E[c])}for(k=p,c=p+1;c<t;c++)Math.abs(E[c])>Math.abs(E[k])&&(k=c);if(k!==p){for(y=0;y<n;y++)v=r.get(k,y),r.set(k,y,r.get(p,y)),r.set(p,y,v);F=o[k],o[k]=o[p],o[p]=F,u=-u}if(p<t&&r.get(p,p)!==0)for(c=p+1;c<t;c++)r.set(c,p,r.get(c,p)/r.get(p,p))}this.LU=r,this.pivotVector=o,this.pivotSign=u}isSingular(){let e=this.LU,r=e.columns;for(let t=0;t<r;t++)if(e.get(t,t)===0)return!0;return!1}solve(e){e=D.checkMatrix(e);let r=this.LU,t=r.rows;if(t!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=e.columns,o=e.subMatrixRow(this.pivotVector,0,n-1),u=r.columns,c,p,y;for(y=0;y<u;y++)for(c=y+1;c<u;c++)for(p=0;p<n;p++)o.set(c,p,o.get(c,p)-o.get(y,p)*r.get(c,y));for(y=u-1;y>=0;y--){for(p=0;p<n;p++)o.set(y,p,o.get(y,p)/r.get(y,y));for(c=0;c<y;c++)for(p=0;p<n;p++)o.set(c,p,o.get(c,p)-o.get(y,p)*r.get(c,y))}return o}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,t=e.columns;for(let n=0;n<t;n++)r*=e.get(n,n);return r}get lowerTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,n=new D(r,t);for(let o=0;o<r;o++)for(let u=0;u<t;u++)o>u?n.set(o,u,e.get(o,u)):o===u?n.set(o,u,1):n.set(o,u,0);return n}get upperTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,n=new D(r,t);for(let o=0;o<r;o++)for(let u=0;u<t;u++)o<=u?n.set(o,u,e.get(o,u)):n.set(o,u,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ut(s,e){let r=0;return Math.abs(s)>Math.abs(e)?(r=e/s,Math.abs(s)*Math.sqrt(1+r*r)):e!==0?(r=s/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class ue{constructor(e){e=ct.checkMatrix(e);let r=e.clone(),t=e.rows,n=e.columns,o=new Float64Array(n),u,c,p,y;for(p=0;p<n;p++){let k=0;for(u=p;u<t;u++)k=ut(k,r.get(u,p));if(k!==0){for(r.get(p,p)<0&&(k=-k),u=p;u<t;u++)r.set(u,p,r.get(u,p)/k);for(r.set(p,p,r.get(p,p)+1),c=p+1;c<n;c++){for(y=0,u=p;u<t;u++)y+=r.get(u,p)*r.get(u,c);for(y=-y/r.get(p,p),u=p;u<t;u++)r.set(u,c,r.get(u,c)+y*r.get(u,p))}}o[p]=-k}this.QR=r,this.Rdiag=o}solve(e){e=D.checkMatrix(e);let r=this.QR,t=r.rows;if(e.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=e.columns,o=e.clone(),u=r.columns,c,p,y,k;for(y=0;y<u;y++)for(p=0;p<n;p++){for(k=0,c=y;c<t;c++)k+=r.get(c,y)*o.get(c,p);for(k=-k/r.get(y,y),c=y;c<t;c++)o.set(c,p,o.get(c,p)+k*r.get(c,y))}for(y=u-1;y>=0;y--){for(p=0;p<n;p++)o.set(y,p,o.get(y,p)/this.Rdiag[y]);for(c=0;c<y;c++)for(p=0;p<n;p++)o.set(c,p,o.get(c,p)-o.get(y,p)*r.get(c,y))}return o.subMatrix(0,u-1,0,n-1)}isFullRank(){let e=this.QR.columns;for(let r=0;r<e;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,r=e.columns,t=new D(r,r),n,o;for(n=0;n<r;n++)for(o=0;o<r;o++)n<o?t.set(n,o,e.get(n,o)):n===o?t.set(n,o,this.Rdiag[n]):t.set(n,o,0);return t}get orthogonalMatrix(){let e=this.QR,r=e.rows,t=e.columns,n=new D(r,t),o,u,c,p;for(c=t-1;c>=0;c--){for(o=0;o<r;o++)n.set(o,c,0);for(n.set(c,c,1),u=c;u<t;u++)if(e.get(c,c)!==0){for(p=0,o=c;o<r;o++)p+=e.get(o,c)*n.get(o,u);for(p=-p/e.get(c,c),o=c;o<r;o++)n.set(o,u,n.get(o,u)+p*e.get(o,c))}}return n}}class Ft{constructor(e,r={}){e=ct.checkMatrix(e);let t=e.rows,n=e.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:u=!0,autoTranspose:c=!1}=r;let p=Boolean(o),y=Boolean(u),k=!1,I;if(t<n)if(!c)I=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{I=e.transpose(),t=I.rows,n=I.columns,k=!0;let i=p;p=y,y=i}else I=e.clone();let v=Math.min(t,n),F=Math.min(t+1,n),E=new Float64Array(F),b=new D(t,v),N=new D(n,n),z=new Float64Array(n),M=new Float64Array(t),d=new Float64Array(F);for(let i=0;i<F;i++)d[i]=i;let a=Math.min(t-1,n),g=Math.max(0,Math.min(n-2,t)),m=Math.max(a,g);for(let i=0;i<m;i++){if(i<a){E[i]=0;for(let l=i;l<t;l++)E[i]=ut(E[i],I.get(l,i));if(E[i]!==0){I.get(i,i)<0&&(E[i]=-E[i]);for(let l=i;l<t;l++)I.set(l,i,I.get(l,i)/E[i]);I.set(i,i,I.get(i,i)+1)}E[i]=-E[i]}for(let l=i+1;l<n;l++){if(i<a&&E[i]!==0){let f=0;for(let h=i;h<t;h++)f+=I.get(h,i)*I.get(h,l);f=-f/I.get(i,i);for(let h=i;h<t;h++)I.set(h,l,I.get(h,l)+f*I.get(h,i))}z[l]=I.get(i,l)}if(p&&i<a)for(let l=i;l<t;l++)b.set(l,i,I.get(l,i));if(i<g){z[i]=0;for(let l=i+1;l<n;l++)z[i]=ut(z[i],z[l]);if(z[i]!==0){z[i+1]<0&&(z[i]=0-z[i]);for(let l=i+1;l<n;l++)z[l]/=z[i];z[i+1]+=1}if(z[i]=-z[i],i+1<t&&z[i]!==0){for(let l=i+1;l<t;l++)M[l]=0;for(let l=i+1;l<t;l++)for(let f=i+1;f<n;f++)M[l]+=z[f]*I.get(l,f);for(let l=i+1;l<n;l++){let f=-z[l]/z[i+1];for(let h=i+1;h<t;h++)I.set(h,l,I.get(h,l)+f*M[h])}}if(y)for(let l=i+1;l<n;l++)N.set(l,i,z[l])}}let w=Math.min(n,t+1);if(a<n&&(E[a]=I.get(a,a)),t<w&&(E[w-1]=0),g+1<w&&(z[g]=I.get(g,w-1)),z[w-1]=0,p){for(let i=a;i<v;i++){for(let l=0;l<t;l++)b.set(l,i,0);b.set(i,i,1)}for(let i=a-1;i>=0;i--)if(E[i]!==0){for(let l=i+1;l<v;l++){let f=0;for(let h=i;h<t;h++)f+=b.get(h,i)*b.get(h,l);f=-f/b.get(i,i);for(let h=i;h<t;h++)b.set(h,l,b.get(h,l)+f*b.get(h,i))}for(let l=i;l<t;l++)b.set(l,i,-b.get(l,i));b.set(i,i,1+b.get(i,i));for(let l=0;l<i-1;l++)b.set(l,i,0)}else{for(let l=0;l<t;l++)b.set(l,i,0);b.set(i,i,1)}}if(y)for(let i=n-1;i>=0;i--){if(i<g&&z[i]!==0)for(let l=i+1;l<n;l++){let f=0;for(let h=i+1;h<n;h++)f+=N.get(h,i)*N.get(h,l);f=-f/N.get(i+1,i);for(let h=i+1;h<n;h++)N.set(h,l,N.get(h,l)+f*N.get(h,i))}for(let l=0;l<n;l++)N.set(l,i,0);N.set(i,i,1)}let j=w-1,V=Number.EPSILON;for(;w>0;){let i,l;for(i=w-2;i>=-1&&!(i===-1);i--){const f=Number.MIN_VALUE+V*Math.abs(E[i]+Math.abs(E[i+1]));if(Math.abs(z[i])<=f||Number.isNaN(z[i])){z[i]=0;break}}if(i===w-2)l=4;else{let f;for(f=w-1;f>=i&&!(f===i);f--){let h=(f!==w?Math.abs(z[f]):0)+(f!==i+1?Math.abs(z[f-1]):0);if(Math.abs(E[f])<=V*h){E[f]=0;break}}f===i?l=3:f===w-1?l=1:(l=2,i=f)}i++;switch(l){case 1:{let f=z[w-2];z[w-2]=0;for(let h=w-2;h>=i;h--){let _=ut(E[h],f),S=E[h]/_,R=f/_;if(E[h]=_,h!==i&&(f=-R*z[h-1],z[h-1]=S*z[h-1]),y)for(let T=0;T<n;T++)_=S*N.get(T,h)+R*N.get(T,w-1),N.set(T,w-1,-R*N.get(T,h)+S*N.get(T,w-1)),N.set(T,h,_)}break}case 2:{let f=z[i-1];z[i-1]=0;for(let h=i;h<w;h++){let _=ut(E[h],f),S=E[h]/_,R=f/_;if(E[h]=_,f=-R*z[h],z[h]=S*z[h],p)for(let T=0;T<t;T++)_=S*b.get(T,h)+R*b.get(T,i-1),b.set(T,i-1,-R*b.get(T,h)+S*b.get(T,i-1)),b.set(T,h,_)}break}case 3:{const f=Math.max(Math.abs(E[w-1]),Math.abs(E[w-2]),Math.abs(z[w-2]),Math.abs(E[i]),Math.abs(z[i])),h=E[w-1]/f,_=E[w-2]/f,S=z[w-2]/f,R=E[i]/f,T=z[i]/f,O=((_+h)*(_-h)+S*S)/2,P=h*S*(h*S);let L=0;(O!==0||P!==0)&&(O<0?L=0-Math.sqrt(O*O+P):L=Math.sqrt(O*O+P),L=P/(O+L));let C=(R+h)*(R-h)+L,U=R*T;for(let $=i;$<w-1;$++){let q=ut(C,U);q===0&&(q=Number.MIN_VALUE);let W=C/q,G=U/q;if($!==i&&(z[$-1]=q),C=W*E[$]+G*z[$],z[$]=W*z[$]-G*E[$],U=G*E[$+1],E[$+1]=W*E[$+1],y)for(let Q=0;Q<n;Q++)q=W*N.get(Q,$)+G*N.get(Q,$+1),N.set(Q,$+1,-G*N.get(Q,$)+W*N.get(Q,$+1)),N.set(Q,$,q);if(q=ut(C,U),q===0&&(q=Number.MIN_VALUE),W=C/q,G=U/q,E[$]=q,C=W*z[$]+G*E[$+1],E[$+1]=-G*z[$]+W*E[$+1],U=G*z[$+1],z[$+1]=W*z[$+1],p&&$<t-1)for(let Q=0;Q<t;Q++)q=W*b.get(Q,$)+G*b.get(Q,$+1),b.set(Q,$+1,-G*b.get(Q,$)+W*b.get(Q,$+1)),b.set(Q,$,q)}z[w-2]=C;break}case 4:{if(E[i]<=0&&(E[i]=E[i]<0?-E[i]:0,y))for(let f=0;f<=j;f++)N.set(f,i,-N.get(f,i));for(;i<j&&!(E[i]>=E[i+1]);){let f=E[i];if(E[i]=E[i+1],E[i+1]=f,y&&i<n-1)for(let h=0;h<n;h++)f=N.get(h,i+1),N.set(h,i+1,N.get(h,i)),N.set(h,i,f);if(p&&i<t-1)for(let h=0;h<t;h++)f=b.get(h,i+1),b.set(h,i+1,b.get(h,i)),b.set(h,i,f);i++}w--;break}}}if(k){let i=N;N=b,b=i}this.m=t,this.n=n,this.s=E,this.U=b,this.V=N}solve(e){let r=e,t=this.threshold,n=this.s.length,o=D.zeros(n,n);for(let v=0;v<n;v++)Math.abs(this.s[v])<=t?o.set(v,v,0):o.set(v,v,1/this.s[v]);let u=this.U,c=this.rightSingularVectors,p=c.mmul(o),y=c.rows,k=u.rows,I=D.zeros(y,k);for(let v=0;v<y;v++)for(let F=0;F<k;F++){let E=0;for(let b=0;b<n;b++)E+=p.get(v,b)*u.get(F,b);I.set(v,F,E)}return I.mmul(r)}solveForDiagonal(e){return this.solve(D.diag(e))}inverse(){let e=this.V,r=this.threshold,t=e.rows,n=e.columns,o=new D(t,this.s.length);for(let k=0;k<t;k++)for(let I=0;I<n;I++)Math.abs(this.s[I])>r&&o.set(k,I,e.get(k,I)/this.s[I]);let u=this.U,c=u.rows,p=u.columns,y=new D(t,c);for(let k=0;k<t;k++)for(let I=0;I<c;I++){let v=0;for(let F=0;F<p;F++)v+=o.get(k,F)*u.get(I,F);y.set(k,I,v)}return y}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,t=this.s;for(let n=0,o=t.length;n<o;n++)t[n]>e&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return D.diag(this.s)}}function ae(s,e=!1){return s=ct.checkMatrix(s),e?new Ft(s).inverse():fe(s,D.eye(s.rows))}function fe(s,e,r=!1){return s=ct.checkMatrix(s),e=ct.checkMatrix(e),r?new Ft(s).solve(e):s.isSquare()?new he(s).solve(e):new ue(s).solve(e)}function ce(s,e,r,t,n){const o=r.length,u=s.x.length;let c=new Array(o);for(let p=0;p<o;p++){c[p]=new Array(u);let y=r.slice();y[p]+=t;let k=n(y);for(let I=0;I<u;I++)c[p][I]=e[I]-k(s.x[I])}return new D(c)}function ge(s,e){const r=s.x.length;let t=new Array(r);for(let n=0;n<r;n++)t[n]=[s.y[n]-e[n]];return new D(t)}function me(s,e,r,t,n){let o=r*t*t,u=D.eye(e.length,e.length,o);const c=n(e);let p=new Float64Array(s.x.length);for(let v=0;v<s.x.length;v++)p[v]=c(s.x[v]);let y=ce(s,p,e,t,n),k=ge(s,p),I=ae(u.add(y.mmul(y.transpose())));return e=new D([e]),e=e.sub(I.mmul(y).mmul(k).mul(t).transpose()),e.to1DArray()}function pe(s,e,r={}){let{maxIterations:t=100,gradientDifference:n=.1,damping:o=0,errorTolerance:u=.01,minValues:c,maxValues:p,initialValues:y}=r;if(o<=0)throw new Error("The damping option must be a positive number");if(!s.x||!s.y)throw new Error("The data parameter must have x and y elements");if(!ht(s.x)||s.x.length<2||!ht(s.y)||s.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(s.x.length!==s.y.length)throw new Error("The data parameter elements must have the same size");let k=y||new Array(e.length).fill(1),I=k.length;if(p=p||new Array(I).fill(Number.MAX_SAFE_INTEGER),c=c||new Array(I).fill(Number.MIN_SAFE_INTEGER),p.length!==c.length)throw new Error("minValues and maxValues must be the same size");if(!ht(k))throw new Error("initialValues must be an array");let v=Rt(s,k,e),F=v<=u,E;for(E=0;E<t&&!F;E++){k=me(s,k,o,n,e);for(let b=0;b<I;b++)k[b]=Math.min(Math.max(c[b],k[b]),p[b]);if(v=Rt(s,k,e),isNaN(v))break;F=v<=u}return{parameterValues:k,parameterError:v,iterations:E}}var we=lt(function(s,e){var r=K&&K.__awaiter||function(i,l,f,h){return new(f||(f=Promise))(function(_,S){function R(P){try{O(h.next(P))}catch(L){S(L)}}function T(P){try{O(h.throw(P))}catch(L){S(L)}}function O(P){P.done?_(P.value):new f(function(L){L(P.value)}).then(R,T)}O((h=h.apply(i,l||[])).next())})},t=K&&K.__generator||function(i,l){var f={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},h,_,S,R;return R={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function T(P){return function(L){return O([P,L])}}function O(P){if(h)throw new TypeError("Generator is already executing.");for(;f;)try{if(h=1,_&&(S=P[0]&2?_.return:P[0]?_.throw||((S=_.return)&&S.call(_),0):_.next)&&!(S=S.call(_,P[1])).done)return S;(_=0,S)&&(P=[P[0]&2,S.value]);switch(P[0]){case 0:case 1:S=P;break;case 4:return f.label++,{value:P[1],done:!1};case 5:f.label++,_=P[1],P=[0];continue;case 7:P=f.ops.pop(),f.trys.pop();continue;default:if(!(S=f.trys,S=S.length>0&&S[S.length-1])&&(P[0]===6||P[0]===2)){f=0;continue}if(P[0]===3&&(!S||P[1]>S[0]&&P[1]<S[3])){f.label=P[1];break}if(P[0]===6&&f.label<S[1]){f.label=S[1],S=P;break}if(S&&f.label<S[2]){f.label=S[2],f.ops.push(P);break}S[2]&&f.ops.pop(),f.trys.pop();continue}P=l.call(i,f)}catch(L){P=[6,L],_=0}finally{h=S=0}if(P[0]&5)throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}},n=K&&K.__read||function(i,l){var f=typeof Symbol=="function"&&i[Symbol.iterator];if(!f)return i;var h=f.call(i),_,S=[],R;try{for(;(l===void 0||l-- >0)&&!(_=h.next()).done;)S.push(_.value)}catch(T){R={error:T}}finally{try{_&&!_.done&&(f=h.return)&&f.call(h)}finally{if(R)throw R.error}}return S},o=K&&K.__spread||function(){for(var i=[],l=0;l<arguments.length;l++)i=i.concat(n(arguments[l]));return i},u=K&&K.__importStar||function(i){if(i&&i.__esModule)return i;var l={};if(i!=null)for(var f in i)Object.hasOwnProperty.call(i,f)&&(l[f]=i[f]);return l.default=i,l},c=K&&K.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(e,"__esModule",{value:!0});var p=u(Mt),y=u(jt),k=u(Vt),I=u(kt),v=u(pt),F=c(pe),E=1e-5,b=.001,N=function(){function i(l){l===void 0&&(l={});var f=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=z,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new d;var h=function(_){l[_]!==void 0&&(f[_]=l[_])};h("distanceFn"),h("learningRate"),h("localConnectivity"),h("minDist"),h("nComponents"),h("nEpochs"),h("nNeighbors"),h("negativeSampleRate"),h("random"),h("repulsionStrength"),h("setOpMixRatio"),h("spread"),h("transformQueueSize")}return i.prototype.fit=function(l){return this.initializeFit(l),this.optimizeLayout(),this.embedding},i.prototype.fitAsync=function(l,f){return f===void 0&&(f=function(){return!0}),r(this,void 0,void 0,function(){return t(this,function(h){switch(h.label){case 0:return this.initializeFit(l),[4,this.optimizeLayoutAsync(f)];case 1:return h.sent(),[2,this.embedding]}})})},i.prototype.setSupervisedProjection=function(l,f){f===void 0&&(f={}),this.Y=l,this.targetMetric=f.targetMetric||this.targetMetric,this.targetWeight=f.targetWeight||this.targetWeight,this.targetNNeighbors=f.targetNNeighbors||this.targetNNeighbors},i.prototype.setPrecomputedKNN=function(l,f){this.knnIndices=l,this.knnDistances=f},i.prototype.initializeFit=function(l){if(l.length<=this.nNeighbors)throw new Error("Not enough data points ("+l.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===l&&this.isInitialized)return this.getNEpochs();if(this.X=l,!this.knnIndices&&!this.knnDistances){var f=this.nearestNeighbors(l);this.knnIndices=f.knnIndices,this.knnDistances=f.knnDistances}this.graph=this.fuzzySimplicialSet(l,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(l),this.processGraphForSupervisedProjection();var h=this.initializeSimplicialSetEmbedding(),_=h.head,S=h.tail,R=h.epochsPerSample;return this.optimizationState.head=_,this.optimizationState.tail=S,this.optimizationState.epochsPerSample=R,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},i.prototype.makeSearchFns=function(){var l=k.makeInitializations(this.distanceFn),f=l.initFromTree,h=l.initFromRandom;this.initFromTree=f,this.initFromRandom=h,this.search=k.makeInitializedNNSearch(this.distanceFn)},i.prototype.makeSearchGraph=function(l){for(var f=this.knnIndices,h=this.knnDistances,_=[l.length,l.length],S=new y.SparseMatrix([],[],[],_),R=0;R<f.length;R++)for(var T=f[R],O=h[R],P=0;P<T.length;P++){var L=T[P],C=O[P];C>0&&S.set(R,L,C)}var U=y.transpose(S);return y.maximum(S,U)},i.prototype.transform=function(l){var f=this,h=this.X;if(h===void 0||h.length===0)throw new Error("No data has been fit.");var _=Math.floor(this.nNeighbors*this.transformQueueSize);_=Math.min(h.length,_);var S=k.initializeSearch(this.rpForest,h,l,_,this.initFromRandom,this.initFromTree,this.random),R=this.search(h,this.searchGraph,S,l),T=p.deheapSort(R),O=T.indices,P=T.weights;O=O.map(function(tt){return tt.slice(0,f.nNeighbors)}),P=P.map(function(tt){return tt.slice(0,f.nNeighbors)});var L=Math.max(0,this.localConnectivity-1),C=this.smoothKNNDistance(P,this.nNeighbors,L),U=C.sigmas,$=C.rhos,q=this.computeMembershipStrengths(O,P,U,$),W=q.rows,G=q.cols,Q=q.vals,J=[l.length,h.length],Y=new y.SparseMatrix(W,G,Q,J),H=y.normalize(Y,"l1"),X=y.getCSR(H),A=l.length,nt=v.reshape2d(X.indices,A,this.nNeighbors),x=v.reshape2d(X.values,A,this.nNeighbors),st=V(nt,x,this.embedding),ot=this.nEpochs?this.nEpochs/3:Y.nRows<=1e4?100:30,gt=Y.getValues().reduce(function(tt,mt){return mt>tt?mt:tt},0);Y=Y.map(function(tt){return tt<gt/ot?0:tt}),Y=y.eliminateZeros(Y);var Z=this.makeEpochsPerSample(Y.getValues(),ot),it=Y.getRows(),wt=Y.getCols();return this.assignOptimizationStateParameters({headEmbedding:st,tailEmbedding:this.embedding,head:it,tail:wt,currentEpoch:0,nEpochs:ot,nVertices:Y.getDims()[1],epochsPerSample:Z}),this.prepareForOptimizationLoop(),this.optimizeLayout()},i.prototype.processGraphForSupervisedProjection=function(){var l=this,f=l.Y,h=l.X;if(f){if(f.length!==h.length)throw new Error("Length of X and y must be equal");if(this.targetMetric==="categorical"){var _=this.targetWeight<1,S=_?2.5*(1/(1-this.targetWeight)):1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,f,S)}}},i.prototype.step=function(){var l=this.optimizationState.currentEpoch;return l<this.getNEpochs()&&this.optimizeLayoutStep(l),this.optimizationState.currentEpoch},i.prototype.getEmbedding=function(){return this.embedding},i.prototype.nearestNeighbors=function(l){var f=this,h=f.distanceFn,_=f.nNeighbors,S=function(q){return Math.log(q)/Math.log(2)},R=k.makeNNDescent(h,this.random),T=function(q){return q===.5?0:Math.round(q)},O=5+Math.floor(T(Math.pow(l.length,.5)/20)),P=Math.max(5,Math.floor(Math.round(S(l.length))));this.rpForest=I.makeForest(l,_,O,this.random);var L=I.makeLeafArray(this.rpForest),C=R(l,L,_,P),U=C.indices,$=C.weights;return{knnIndices:U,knnDistances:$}},i.prototype.fuzzySimplicialSet=function(l,f,h){h===void 0&&(h=1);var _=this,S=_.knnIndices,R=S===void 0?[]:S,T=_.knnDistances,O=T===void 0?[]:T,P=_.localConnectivity,L=this.smoothKNNDistance(O,f,P),C=L.sigmas,U=L.rhos,$=this.computeMembershipStrengths(R,O,C,U),q=$.rows,W=$.cols,G=$.vals,Q=[l.length,l.length],J=new y.SparseMatrix(q,W,G,Q),Y=y.transpose(J),H=y.pairwiseMultiply(J,Y),X=y.subtract(y.add(J,Y),H),A=y.multiplyScalar(X,h),nt=y.multiplyScalar(H,1-h),x=y.add(A,nt);return x},i.prototype.categoricalSimplicialSetIntersection=function(l,f,h,_){_===void 0&&(_=1);var S=w(l,f,_,h);return S=y.eliminateZeros(S),j(S)},i.prototype.smoothKNNDistance=function(l,f,h,_,S){h===void 0&&(h=1),_===void 0&&(_=64),S===void 0&&(S=1);for(var R=Math.log(f)/Math.log(2)*S,T=v.zeros(l.length),O=v.zeros(l.length),P=0;P<l.length;P++){var L=0,C=Infinity,U=1,$=l[P],q=$.filter(function(nt){return nt>0});if(q.length>=h){var W=Math.floor(h),G=h-W;W>0?(T[P]=q[W-1],G>E&&(T[P]+=G*(q[W]-q[W-1]))):T[P]=G*q[0]}else q.length>0&&(T[P]=v.max(q));for(var Q=0;Q<_;Q++){for(var J=0,Y=1;Y<l[P].length;Y++){var H=l[P][Y]-T[P];H>0?J+=Math.exp(-(H/U)):J+=1}if(Math.abs(J-R)<E)break;J>R?(C=U,U=(L+C)/2):(L=U,C===Infinity?U*=2:U=(L+C)/2)}if(O[P]=U,T[P]>0){var X=v.mean($);O[P]<b*X&&(O[P]=b*X)}else{var A=v.mean(l.map(v.mean));O[P]<b*A&&(O[P]=b*A)}}return{sigmas:O,rhos:T}},i.prototype.computeMembershipStrengths=function(l,f,h,_){for(var S=l.length,R=l[0].length,T=v.zeros(S*R),O=v.zeros(S*R),P=v.zeros(S*R),L=0;L<S;L++)for(var C=0;C<R;C++){var U=0;if(l[L][C]===-1)continue;l[L][C]===L?U=0:f[L][C]-_[L]<=0?U=1:U=Math.exp(-((f[L][C]-_[L])/h[L])),T[L*R+C]=L,O[L*R+C]=l[L][C],P[L*R+C]=U}return{rows:T,cols:O,vals:P}},i.prototype.initializeSimplicialSetEmbedding=function(){for(var l=this,f=this.getNEpochs(),h=this.nComponents,_=this.graph.getValues(),S=0,R=0;R<_.length;R++){var T=_[R];S<_[R]&&(S=T)}var O=this.graph.map(function(W){return W<S/f?0:W});this.embedding=v.zeros(O.nRows).map(function(){return v.zeros(h).map(function(){return v.tauRand(l.random)*20+-10})});for(var P=[],L=[],C=[],U=O.getAll(),R=0;R<U.length;R++){var $=U[R];$.value&&(P.push($.value),C.push($.row),L.push($.col))}var q=this.makeEpochsPerSample(P,f);return{head:L,tail:C,epochsPerSample:q}},i.prototype.makeEpochsPerSample=function(l,f){var h=v.filled(l.length,-1),_=v.max(l),S=l.map(function(R){return R/_*f});return S.forEach(function(R,T){R>0&&(h[T]=f/S[T])}),h},i.prototype.assignOptimizationStateParameters=function(l){Object.assign(this.optimizationState,l)},i.prototype.prepareForOptimizationLoop=function(){var l=this,f=l.repulsionStrength,h=l.learningRate,_=l.negativeSampleRate,S=this.optimizationState,R=S.epochsPerSample,T=S.headEmbedding,O=S.tailEmbedding,P=T[0].length,L=T.length===O.length,C=R.map(function(q){return q/_}),U=o(C),$=o(R);this.assignOptimizationStateParameters({epochOfNextSample:$,epochOfNextNegativeSample:U,epochsPerNegativeSample:C,moveOther:L,initialAlpha:h,alpha:h,gamma:f,dim:P})},i.prototype.initializeOptimization=function(){var l=this.embedding,f=this.embedding,h=this.optimizationState,_=h.head,S=h.tail,R=h.epochsPerSample,T=this.getNEpochs(),O=this.graph.nCols,P=m(this.spread,this.minDist),L=P.a,C=P.b;this.assignOptimizationStateParameters({headEmbedding:l,tailEmbedding:f,head:_,tail:S,epochsPerSample:R,a:L,b:C,nEpochs:T,nVertices:O})},i.prototype.optimizeLayoutStep=function(l){for(var f=this.optimizationState,h=f.head,_=f.tail,S=f.headEmbedding,R=f.tailEmbedding,T=f.epochsPerSample,O=f.epochOfNextSample,P=f.epochOfNextNegativeSample,L=f.epochsPerNegativeSample,C=f.moveOther,U=f.initialAlpha,$=f.alpha,q=f.gamma,W=f.a,G=f.b,Q=f.dim,J=f.nEpochs,Y=f.nVertices,H=4,X=0;X<T.length;X++){if(O[X]>l)continue;var A=h[X],nt=_[X],x=S[A],st=R[nt],ot=g(x,st),gt=0;ot>0&&(gt=-2*W*G*Math.pow(ot,G-1),gt/=W*Math.pow(ot,G)+1);for(var Z=0;Z<Q;Z++){var it=a(gt*(x[Z]-st[Z]),H);x[Z]+=it*$,C&&(st[Z]+=-it*$)}O[X]+=T[X];for(var wt=Math.floor((l-P[X])/L[X]),tt=0;tt<wt;tt++){var mt=v.tauRandInt(Y,this.random),bt=R[mt],Et=g(x,bt),vt=0;if(Et>0)vt=2*q*G,vt/=(.001+Et)*(W*Math.pow(Et,G)+1);else if(A===mt)continue;for(var Z=0;Z<Q;Z++){var it=4;vt>0&&(it=a(vt*(x[Z]-bt[Z]),H)),x[Z]+=it*$}}P[X]+=wt*L[X]}return f.alpha=U*(1-l/J),f.currentEpoch+=1,S},i.prototype.optimizeLayoutAsync=function(l){var f=this;return l===void 0&&(l=function(){return!0}),new Promise(function(h,_){var S=function(){return r(f,void 0,void 0,function(){var R,T,O,P,L,C;return t(this,function(U){try{if(R=this.optimizationState,T=R.nEpochs,O=R.currentEpoch,this.embedding=this.optimizeLayoutStep(O),P=this.optimizationState.currentEpoch,L=l(P)===!1,C=P===T,!L&&!C)setTimeout(function(){return S()},0);else return[2,h(C)]}catch($){_($)}return[2]})})};setTimeout(function(){return S()},0)})},i.prototype.optimizeLayout=function(l){l===void 0&&(l=function(){return!0});for(var f=!1,h=[];!f;){var _=this.optimizationState,S=_.nEpochs,R=_.currentEpoch;h=this.optimizeLayoutStep(R);var T=this.optimizationState.currentEpoch,O=l(T)===!1;f=T===S||O}return h},i.prototype.getNEpochs=function(){var l=this.graph;if(this.nEpochs>0)return this.nEpochs;var f=l.nRows;return f<=2500?500:f<=5e3?400:f<=7500?300:200},i}();e.UMAP=N;function z(i,l){for(var f=0,h=0;h<i.length;h++)f+=Math.pow(i[h]-l[h],2);return Math.sqrt(f)}e.euclidean=z;function M(i,l){for(var f=0,h=0,_=0,S=0;S<i.length;S++)f+=i[S]*l[S],h+=Math.pow(i[S],2),_+=Math.pow(l[S],2);return h===0&&_===0?0:h===0||_===0?1:1-f/Math.sqrt(h*_)}e.cosine=M;var d=function(){function i(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}return i}();function a(i,l){return i>l?l:i<-l?-l:i}function g(i,l){for(var f=0,h=0;h<i.length;h++)f+=Math.pow(i[h]-l[h],2);return f}function m(i,l){var f=function(U){var $=n(U,2),q=$[0],W=$[1];return function(G){return 1/(1+q*Math.pow(G,2*W))}},h=v.linear(0,i*3,300).map(function(U){return U<l?1:U}),_=v.zeros(h.length).map(function(U,$){var q=h[$]>=l;return q?Math.exp(-(h[$]-l)/i):U}),S=[.5,.5],R={x:h,y:_},T={damping:1.5,initialValues:S,gradientDifference:.1,maxIterations:100,errorTolerance:.01},O=F.default(R,f,T).parameterValues,P=n(O,2),L=P[0],C=P[1];return{a:L,b:C}}e.findABParams=m;function w(i,l,f,h){return f===void 0&&(f=1),h===void 0&&(h=5),i.map(function(_,S,R){return l[S]===-1||l[R]===-1?_*Math.exp(-f):l[S]!==l[R]?_*Math.exp(-h):_})}e.fastIntersection=w;function j(i){i=y.normalize(i,"max");var l=y.transpose(i),f=y.pairwiseMultiply(l,i);return i=y.add(i,y.subtract(l,f)),y.eliminateZeros(i)}e.resetLocalConnectivity=j;function V(i,l,f){for(var h=v.zeros(i.length).map(function(O){return v.zeros(f[0].length)}),_=0;_<i.length;_++)for(var S=0;S<i[0].length;S++)for(var R=0;R<f[0].length;R++){var T=i[_][S];h[_][R]+=l[_][S]*f[T][R]}return h}e.initTransform=V}),ve=lt(function(s,e){Object.defineProperty(e,"__esModule",{value:!0}),e.UMAP=we.UMAP}),de=ve.UMAP;export{de as UMAP};
