const u={};import g from"../../__snowpack__/env.js";u.env=g;function h(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),o.push.apply(o,t)}return o}function O(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?h(Object(o),!0).forEach(function(t){_(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function _(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function P(e,n){if(e==null)return{};var o=b(e,n),t,a;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++){if(t=r[a],n.indexOf(t)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,t))continue;o[t]=e[t]}}return o}function b(e,n){if(e==null)return{};var o={},t=Object.keys(e),a,r;for(r=0;r<t.length;r++){if(a=t[r],n.indexOf(a)>=0)continue;o[a]=e[a]}return o}import E from"../../web_modules/i18next.js";import v from"../../web_modules/query-string.js";const l=u.env.SNOWPACK_PUBLIC_API_TOKEN_KEY,j=u.env.SNOWPACK_PUBLIC_API_URL,m="X-VisualDL-Instance-ID",w=l?v.parse(window.location.search)[l]:"";export function getApiToken(){return w!=null?w:null}function A(e){const n=getApiToken();if(!l||!n)return e;const o=e||{},{headers:t}=o,a=P(o,["headers"]),r=new Headers(t);return Array.isArray(n)?n.forEach(i=>r.append(m,i)):r.append(m,n),O(O({},a),{},{headers:r})}function I(){return new Promise(e=>{E.changeLanguage(void 0).then(n=>e(n))})}function f(e){return u.env.MODE==="development"&&console.error(e),I()}export async function fetcher(e,n){var o;let t;try{t=await fetch(j+e,A(n))}catch(r){const i=await f(r);throw new Error(i("errors:network-error"))}if(!t.ok){const r=await f(t);throw new Error(r([`errors:response-error.${t.status}`,"errors:response-error.unknown"]))}const a=(o=t.headers.get("content-type"))!==null&&o!==void 0?o:"";if(a.includes("application/json")){let r;try{r=await t.json()}catch(i){const c=await f(i);throw new Error(c("errors:parse-error"))}if(r&&"status"in r)if(r.status!==0){const i=await f(r);throw new Error(r.msg||i("errors:error"))}else return r.data;return r}else if(a.startsWith("text/")){let r;try{r=await t.text()}catch(i){const c=await f(i);throw new Error(c("errors:parse-error"))}return r}else{let r;try{r=await t.blob()}catch(s){const p=await f(s);throw new Error(p("errors:parse-error"))}const i=t.headers.get("Content-Disposition");r.arrayBuffer||(r.arrayBuffer=async()=>new Promise((s,p)=>{const d=new FileReader;d.addEventListener("load",y=>y.target?s(y.target.result):p()),d.readAsArrayBuffer(r)}));let c=null;if(i&&i.indexOf("attachment")!==-1){const s=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(i);s!=null&&s[1]&&(c=s[1].replace(/['"]/g,""))}return{data:r,type:t.headers.get("Content-Type"),filename:c}}}export const cycleFetcher=async(e,n)=>await Promise.all(e.map(o=>fetcher(o,n)));
