<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Customizing the comments framework &mdash; Django Comments 1.6 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Django Comments 1.6 documentation" href="index.html" />
    <link rel="next" title="Comment form classes" href="forms.html" />
    <link rel="prev" title="Signals sent by the comments app" href="signals.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="forms.html" title="Comment form classes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="signals.html" title="Signals sent by the comments app"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Django Comments 1.6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="customizing-the-comments-framework">
<h1>Customizing the comments framework<a class="headerlink" href="#customizing-the-comments-framework" title="Permalink to this headline">¶</a></h1>
<p>If the comment framework doesn&#8217;t quite fit your needs, you can extend
the comment app&#8217;s behavior to add custom data and logic. The comments framework
lets you extend the in comment model, the comment form, and the
various comment views.</p>
<p>The <a class="reference internal" href="settings.html#std:setting-COMMENTS_APP"><code class="xref std std-setting docutils literal"><span class="pre">COMMENTS_APP</span></code></a> setting is where this customization begins. Set
<a class="reference internal" href="settings.html#std:setting-COMMENTS_APP"><code class="xref std std-setting docutils literal"><span class="pre">COMMENTS_APP</span></code></a> to the name of the app you&#8217;d like to use to provide
custom behavior. You&#8217;ll use the same syntax as you&#8217;d use for
<a class="reference external" href="http://docs.djangoproject.com/en/stable/ref/settings/#std:setting-INSTALLED_APPS" title="(in Django v1.9)"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>, and the app given must also be in the
<a class="reference external" href="http://docs.djangoproject.com/en/stable/ref/settings/#std:setting-INSTALLED_APPS" title="(in Django v1.9)"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a> list.</p>
<p>For example, if you wanted to use an app named <code class="docutils literal"><span class="pre">my_comment_app</span></code>, your
settings file would contain:</p>
<div class="highlight-python"><div class="highlight"><pre>INSTALLED_APPS = [
    ...
    &#39;my_comment_app&#39;,
    ...
]

COMMENTS_APP = &#39;my_comment_app&#39;
</pre></div>
</div>
<p>The app named in <a class="reference internal" href="settings.html#std:setting-COMMENTS_APP"><code class="xref std std-setting docutils literal"><span class="pre">COMMENTS_APP</span></code></a> provides its custom behavior by
defining some module-level functions in the app&#8217;s <code class="docutils literal"><span class="pre">__init__.py</span></code>. The
<a class="reference internal" href="#custom-comment-app-api"><span>complete list of these functions</span></a> can be found
below, but first let&#8217;s look at a quick example.</p>
<div class="section" id="an-example-custom-comments-app">
<h2>An example custom comments app<a class="headerlink" href="#an-example-custom-comments-app" title="Permalink to this headline">¶</a></h2>
<p>One of the most common types of customization is modifying the set of fields
provided on the comment model. For example, some sites that allow
comments want the commentator to provide a title for their comment; the
comment model has no field for that title.</p>
<p>To make this kind of customization, we&#8217;ll need to do three things:</p>
<ol class="arabic simple">
<li>Create a custom comment <a class="reference external" href="http://docs.djangoproject.com/en/stable/ref/models/instances/#django.db.models.Model" title="(in Django v1.9)"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> that adds on the
&#8220;title&#8221; field.</li>
<li>Create a custom comment <a class="reference external" href="http://docs.djangoproject.com/en/stable/ref/forms/api/#django.forms.Form" title="(in Django v1.9)"><code class="xref py py-class docutils literal"><span class="pre">Form</span></code></a> that also adds this
&#8220;title&#8221; field.</li>
<li>Inform Django of these objects by defining a few functions in a
custom <a class="reference internal" href="settings.html#std:setting-COMMENTS_APP"><code class="xref std std-setting docutils literal"><span class="pre">COMMENTS_APP</span></code></a>.</li>
</ol>
<p>So, carrying on the example above, we&#8217;re dealing with a typical app structure in
the <code class="docutils literal"><span class="pre">my_comment_app</span></code> directory:</p>
<div class="highlight-python"><div class="highlight"><pre>my_comment_app/
    __init__.py
    models.py
    forms.py
</pre></div>
</div>
<p>In the <code class="docutils literal"><span class="pre">models.py</span></code> we&#8217;ll define a <code class="docutils literal"><span class="pre">CommentWithTitle</span></code> model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django_comments.models</span> <span class="kn">import</span> <span class="n">Comment</span>

<span class="k">class</span> <span class="nc">CommentWithTitle</span><span class="p">(</span><span class="n">Comment</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p>Most custom comment models will subclass the
<a class="reference internal" href="models.html#django_comments.models.Comment" title="django_comments.models.Comment"><code class="xref py py-class docutils literal"><span class="pre">Comment</span></code></a> model. However,
if you want to substantially remove or change the fields available in the
<a class="reference internal" href="models.html#django_comments.models.Comment" title="django_comments.models.Comment"><code class="xref py py-class docutils literal"><span class="pre">Comment</span></code></a> model, but don&#8217;t want to
rewrite the templates, you could try subclassing from
<code class="docutils literal"><span class="pre">BaseCommentAbstractModel</span></code>.</p>
<p>Next, we&#8217;ll define a custom comment form in <code class="docutils literal"><span class="pre">forms.py</span></code>. This is a little more
tricky: we have to both create a form and override
<code class="docutils literal"><span class="pre">CommentForm.get_comment_model()</span></code> and
<code class="docutils literal"><span class="pre">CommentForm.get_comment_create_data()</span></code> to return deal with our custom title
field:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django_comments.forms</span> <span class="kn">import</span> <span class="n">CommentForm</span>
<span class="kn">from</span> <span class="nn">my_comment_app.models</span> <span class="kn">import</span> <span class="n">CommentWithTitle</span>

<span class="k">class</span> <span class="nc">CommentFormWithTitle</span><span class="p">(</span><span class="n">CommentForm</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_comment_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use our custom comment model instead of the default one.</span>
        <span class="k">return</span> <span class="n">CommentWithTitle</span>

    <span class="k">def</span> <span class="nf">get_comment_create_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use the data of the superclass, and add in the title field</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CommentFormWithTitle</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_comment_create_data</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p>Django provides a couple of &#8220;helper&#8221; classes to make writing certain types of
custom comment forms easier; see <a class="reference internal" href="forms.html#module-django_comments.forms" title="django_comments.forms: Forms for dealing with the comment model."><code class="xref py py-mod docutils literal"><span class="pre">django_comments.forms</span></code></a> for
more.</p>
<p>Finally, we&#8217;ll define a couple of methods in <code class="docutils literal"><span class="pre">my_comment_app/__init__.py</span></code> to
point Django at these classes we&#8217;ve created:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">my_comment_app.models</span> <span class="kn">import</span> <span class="n">CommentWithTitle</span>
<span class="kn">from</span> <span class="nn">my_comment_app.forms</span> <span class="kn">import</span> <span class="n">CommentFormWithTitle</span>

<span class="k">def</span> <span class="nf">get_model</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">CommentWithTitle</span>

<span class="k">def</span> <span class="nf">get_form</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">CommentFormWithTitle</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Be careful not to create cyclic imports in your custom comments app.
If you feel your comment configuration isn&#8217;t being used as defined &#8211;
for example, if your comment moderation policy isn&#8217;t being applied &#8211;
you may have a cyclic import problem.</p>
<p class="last">If you are having unexplained problems with comments behavior, check
if your custom comments application imports (even indirectly)
any module that itself imports Django&#8217;s comments module.</p>
</div>
<p>The above process should take care of most common situations. For more
advanced usage, there are additional methods you can define. Those are
explained in the next section.</p>
</div>
<div class="section" id="custom-comment-app-api">
<span id="id1"></span><h2>Custom comment app API<a class="headerlink" href="#custom-comment-app-api" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="index.html#module-django_comments" title="django_comments: The package formerly known as &quot;django.contrib.comments&quot;."><code class="xref py py-mod docutils literal"><span class="pre">django_comments</span></code></a> app defines the following methods; any
custom comment app must define at least one of them. All are optional,
however.</p>
<dl class="function">
<dt id="django_comments.get_model">
<code class="descclassname">django_comments.</code><code class="descname">get_model</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django_comments.get_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the <a class="reference external" href="http://docs.djangoproject.com/en/stable/ref/models/instances/#django.db.models.Model" title="(in Django v1.9)"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> class to use for comments. This
model should inherit from
<code class="docutils literal"><span class="pre">django_comments.models.BaseCommentAbstractModel</span></code>, which
defines necessary core fields.</p>
<p>The default implementation returns
<a class="reference internal" href="models.html#django_comments.models.Comment" title="django_comments.models.Comment"><code class="xref py py-class docutils literal"><span class="pre">django_comments.models.Comment</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="django_comments.get_form">
<code class="descclassname">django_comments.</code><code class="descname">get_form</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django_comments.get_form" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the <a class="reference external" href="http://docs.djangoproject.com/en/stable/ref/forms/api/#django.forms.Form" title="(in Django v1.9)"><code class="xref py py-class docutils literal"><span class="pre">Form</span></code></a> class you want to use for
creating, validating, and saving your comment model.  Your custom
comment form should accept an additional first argument,
<code class="docutils literal"><span class="pre">target_object</span></code>, which is the object the comment will be
attached to.</p>
<p>The default implementation returns
<a class="reference internal" href="forms.html#django_comments.forms.CommentForm" title="django_comments.forms.CommentForm"><code class="xref py py-class docutils literal"><span class="pre">django_comments.forms.CommentForm</span></code></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The default comment form also includes a number of unobtrusive
spam-prevention features (see
<a class="reference internal" href="quickstart.html#notes-on-the-comment-form"><span>Notes on the comment form</span></a>).  If replacing it with your
own form, you may want to look at the source code for the
default form and consider incorporating similar features.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="django_comments.get_form_target">
<code class="descclassname">django_comments.</code><code class="descname">get_form_target</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django_comments.get_form_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the URL for POSTing comments. This will be the <code class="docutils literal"><span class="pre">&lt;form</span> <span class="pre">action&gt;</span></code>
attribute when rendering your comment form.</p>
<p>The default implementation returns a reverse-resolved URL pointing
to the <code class="docutils literal"><span class="pre">post_comment()</span></code> view.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you provide a custom comment model and/or form, but you
want to use the default <code class="docutils literal"><span class="pre">post_comment()</span></code> view, you will
need to be aware that it requires the model and form to have
certain additional attributes and methods: see the
<code class="docutils literal"><span class="pre">django_comments.views.post_comment()</span></code> view for details.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="django_comments.get_flag_url">
<code class="descclassname">django_comments.</code><code class="descname">get_flag_url</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django_comments.get_flag_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the URL for the &#8220;flag this comment&#8221; view.</p>
<p>The default implementation returns a reverse-resolved URL pointing
to the <code class="docutils literal"><span class="pre">django_comments.views.moderation.flag()</span></code> view.</p>
</dd></dl>

<dl class="function">
<dt id="django_comments.get_delete_url">
<code class="descclassname">django_comments.</code><code class="descname">get_delete_url</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django_comments.get_delete_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the URL for the &#8220;delete this comment&#8221; view.</p>
<p>The default implementation returns a reverse-resolved URL pointing
to the <code class="docutils literal"><span class="pre">django_comments.views.moderation.delete()</span></code> view.</p>
</dd></dl>

<dl class="function">
<dt id="django_comments.get_approve_url">
<code class="descclassname">django_comments.</code><code class="descname">get_approve_url</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django_comments.get_approve_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the URL for the &#8220;approve this comment from moderation&#8221; view.</p>
<p>The default implementation returns a reverse-resolved URL pointing
to the <code class="docutils literal"><span class="pre">django_comments.views.moderation.approve()</span></code> view.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Customizing the comments framework</a><ul>
<li><a class="reference internal" href="#an-example-custom-comments-app">An example custom comments app</a></li>
<li><a class="reference internal" href="#custom-comment-app-api">Custom comment app API</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="signals.html"
                        title="previous chapter">Signals sent by the comments app</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="forms.html"
                        title="next chapter">Comment form classes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/custom.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="forms.html" title="Comment form classes"
             >next</a> |</li>
        <li class="right" >
          <a href="signals.html" title="Signals sent by the comments app"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Django Comments 1.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, Django Software Foundation and contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>