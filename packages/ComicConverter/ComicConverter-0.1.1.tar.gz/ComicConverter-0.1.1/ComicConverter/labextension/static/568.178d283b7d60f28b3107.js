(self.webpackChunkComicConverter=self.webpackChunkComicConverter||[]).push([[568],{568:(e,t,o)=>{"use strict";o.r(t),o.d(t,{ToggleInputCodeButton:()=>R,ResetButton:()=>W,CaptureEventsButtonExtension:()=>q,SaveCSVButtonExtension:()=>Q,default:()=>Z});var n=o(82),i=o(840),l=o(850),r=o(635),a=o(129),s=o(173);const d="intermediate",u="full",c="half",m="third",p="twothird",f="1100px";var h,v,y,g,b,E,w;let C=!1;class A{constructor(e){this.reset=function(){this.mouseEventType=new Array,this.relativeMousePosXArray=new Array,this.relativeMousePosYArray=new Array,this.childIndexArray=new Array,this.mouseClickTrails=new Array},this.updateMetadata=function(){let e=y.activeNotebookPanel.content.model.cells;for(let t=0;t<e.length;++t)if(e.get(t).id==this.id)return e.get(t).metadata.set("mouseEventType",this.mouseEventType),e.get(t).metadata.set("relativeMousePosXArray",this.relativeMousePosXArray),e.get(t).metadata.set("relativeMousePosYArray",this.relativeMousePosYArray),e.get(t).metadata.set("childIndexArray",this.childIndexArray),void e.get(t).metadata.set("mouseClickTrails",this.mouseClickTrails)},this.updateFromMetadata=function(){let e=y.activeNotebookPanel.content.model.cells;for(let t=0;t<e.length;++t)if(e.get(t).id==this.id&&e.get(t).metadata.has("mouseEventType"))return this.mouseEventType=e.get(t).metadata.get("mouseEventType"),this.relativeMousePosXArray=e.get(t).metadata.get("relativeMousePosXArray"),this.relativeMousePosYArray=e.get(t).metadata.get("relativeMousePosYArray"),this.childIndexArray=e.get(t).metadata.get("childIndexArray"),this.mouseClickTrails=e.get(t).metadata.get("mouseClickTrails"),!0;return!1},this.id=e,this.reset()}}const k={id:"ComicConverter",optional:[n.IMainMenu,i.INotebookTools,i.INotebookTracker],autoStart:!0,activate:(e,t,o,n)=>{const{commands:l}=e,r="viewmenu:command",a="viewmenu:intermediatecommand";y=o,v=n,g=Date.now(),b="";var s=new R;e.docRegistry.addWidgetExtension("Notebook",s);var d=new W;e.docRegistry.addWidgetExtension("Notebook",d);var u=new q;e.docRegistry.addWidgetExtension("Notebook",u);var c=new Q;e.docRegistry.addWidgetExtension("Notebook",c),h=new Array,E=new Array,w=new Array,i.NotebookActions.executed.connect(x),v.currentChanged.connect((()=>{setTimeout((()=>{let e=v.currentWidget.node.getElementsByClassName("jp-NotebookPanel-notebook").item(0);e.style.width=f,e.style.minWidth=f,e.style.maxWidth=f}),1e4)})),l.addCommand(r,{label:"Comic Command",isToggled:()=>C,execute:()=>{C=!C,J("View Comic:"+C);let e=o.activeNotebookPanel.content.widgets;for(let o=0;o<e.length;++o){var t=!1;N(n=e[o])&&(t=!0,"code"==n.model.type?Y(n,C):"markdown"==n.model.type&&(C?n.hide():n.show()),!C&&I(n)&&(m?n.show():n.hide())),t||(C?n.node.style.setProperty("display","none"):n.node.style.setProperty("display",""))}if(C)for(let t=0;t<e.length;++t){var n;N(n=e[t])&&"code"==n.model.type&&L(X(n.node).output_arr[0].item(0).parentElement,n)}o.activeCell.node.scrollIntoView(!0)}});let m=!1;l.addCommand(a,{label:"intermediate",isToggled:()=>m,execute:()=>{m=!m,J("View Intermediate:"+m);let e=o.activeNotebookPanel.content.widgets;for(let o=0;o<e.length;++o){var t=e[o];I(t)&&(m?t.show():t.hide())}o.activeCell.node.scrollIntoView(!0)}}),t&&(t.viewMenu.addGroup([{command:r}]),t.viewMenu.addGroup([{command:a}])),l.addKeyBinding({command:r,args:{},keys:["Accel Shift C"],selector:".jp-Notebook"}),l.addKeyBinding({command:a,args:{},keys:["Accel Shift I"],selector:".jp-Notebook"})}};function x(e,t){"code"==t.cell.model.type&&setTimeout((function(){var e=t.cell;if(w.push(e.model.id),E.push(e.outputArea.node),w.length>0&&!D){O();var o=function(){setTimeout((function(){D?o():T(e)}),500)};o()}else T(e)}),1e3)}function T(e){if(N(e)){var t=X(e.node);t.frame.setAttribute("style",""),t.frame.parentElement.parentElement.parentElement.setAttribute("style",""),Y(e,C),t.frame.scrollIntoView(!0)}}function N(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>"comic"==e||e==d)))return!0}return!1}function M(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t){if(t.find((e=>e==u)))return u;if(t.find((e=>e==c)))return c;if(t.find((e=>e==m)))return m;if(t.find((e=>e==p)))return p}}}function B(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t)for(let e=0;e<t.length;++e)if(t[e].startsWith("height"))return t[e].split(":")[1]}return""}function I(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>e==d)))return!0}return!1}function P(e,t,o){let n=e.parentElement.parentElement.parentElement;n.setAttribute("style","width:100%; position:relative; float:left; resize:both; overflow:hidden; height:auto;"),e.style.backgroundColor="white",e.style.border="solid 2px",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.style.position="relative",e.style.margin="0px !important",e.style.float="left",n.style.width=t==u?"100%":t==m?"33.3%":t==p?"66.6%":"50%",""!=o&&(n.style.height=o),e.firstElementChild.setAttribute("style","display:none;")}function L(e,t){let o=y.activeNotebookPanel.content.widgets,n=o.findIndex((e=>e==t)),i=e.offsetLeft,l=-1;for(let e=n-1;e>=0;--e)if(N(o[e])&&"code"==o[e].model.type&&o[e].node.offsetLeft<i){l=e;break}if(l<0)return;let r=e.offsetTop+e.clientHeight-(o[l].node.offsetTop+o[l].node.clientHeight);if(r>0)if(r>e.clientHeight/2){let e=-1;for(let t=n-1;t>l;--t)if(N(o[t])&&"code"==o[t].model.type&&o[t].node.offsetLeft==i){e=t;break}if(e>0){let t=o[e].node.getElementsByClassName("jp-Cell-outputWrapper").item(0).parentElement,n=o[l].node.offsetTop+o[l].node.clientHeight-(t.offsetTop+t.clientHeight)+.5;t.style.marginBottom=n+"px"}}else o[l].node.style.marginBottom=r+"px"}function j(e){let t=y.activeNotebookPanel.content.widgets;for(let o=0;o<t.length;++o)if(t[o]==e){let e=0,n=-1;for(let i=o-1;i>=0&&(n=i,"code"==t[i].model.type&&N(t[i]));--i)e++;for(let o=n;o>=0;--o)if("markdown"!=t[o].model.type||!N(t[o])){let i=o+1+e;if(i<=n)return t[i];break}break}return null}function X(e){var t=[e.getElementsByClassName("jp-Cell-inputWrapper")],o=[e.getElementsByClassName("jp-Cell-outputWrapper")],n=o[0].item(0).getElementsByClassName("jp-OutputArea-child").item(0),i=t[0].item(0);return{arr:t,output_arr:o,frame:n,codecell:i}}function Y(e,t){var o=X(e.node),n=o.arr,i=o.frame,l=o.codecell;if(t){e.show(),P(i,M(e),B(e)),function(e){let t=e.parentElement.getElementsByClassName("jp-OutputArea-executeResult"),o=e.parentElement.firstElementChild,n=e.parentElement.lastElementChild;if(t.length>0)for(let e of t)e!=o&&e==n&&e.setAttribute("style","display:none")}(i),function(e){e.firstElementChild.nextElementSibling.setAttribute("style","width:100%;overflow: hidden;")}(i),l.setAttribute("style","display: none;"),function(e,t){(function(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>"img"==e)))return!0}return!1})(t)&&e.getElementsByClassName("jp-OutputArea-output")[0].firstElementChild.setAttribute("style","width:100%; height:100%; object - fit: cover;")}(i,e);var r=j(e);if(null!=r){var a=r.node;let e=function(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>"bottom"==e)))return!0}return!1}(r),t=function(e,t){var o=e.firstChild.nextSibling.lastChild.childNodes[2].textContent;let n="top:0px;";t&&(n="bottom:0px;");var i=document.createElement("p");return i.innerText=o,i.style.cssText="color: black; border:1px solid black; z-index:1; background-color:white; width: auto; height:auto; position:absolute !important; margine:4px; font-size: large;"+n,i.setAttribute("class","annobox"),i}(a,e);i.firstChild.after(t),function(e){if(void 0!==e){let t=e.model.metadata.get("tags");if(t&&t.find((e=>"stack"==e)))return!0}return!1}(r)&&(e?i.getElementsByClassName("jp-OutputArea-output").item(0).setAttribute("style","width:100%;overflow: hidden; margin-bottom:"+t.clientHeight+"px;"):i.getElementsByClassName("jp-OutputArea-output").item(0).setAttribute("style","width:100%;overflow: hidden; margin-top:"+t.clientHeight+"px;")),r.hide()}}else{var s=document.getElementsByClassName("new_frame");if(null==s)return;var d=document.getElementsByClassName("annobox");if(n[0].item(0).setAttribute("style","display: ;"),i.setAttribute("style",""),i.firstElementChild.setAttribute("style","display:;"),i.parentElement.parentElement.parentElement.setAttribute("style",""),null!=d[0])for(var u=0;u<d.length;u++)d[u].remove();if(null!=s[0])for(u=0;u<s.length;u++)s[u].remove()}}class R{constructor(){this.previousMargin=""}createNew(e,t){let o=new r.ToolbarButton({className:"showCode",icon:s.searchIcon,onClick:()=>{if(C){var t=e.content.activeCell;if(null!=t&&"code"==t.model.type){var o=X(t.node),n=o.frame,i=o.codecell,l=!1;"display: ;"==i.getAttribute("style")&&(l=!0),J("ToggleInputCodeButton:"+l);var r=j(t);for(var a of(l?(P(n,M(t),B(t)),null==r||r.hide(),o.output_arr[0].item(0).parentElement.style.marginBottom=this.previousMargin):(this.previousMargin=o.output_arr[0].item(0).parentElement.style.marginBottom,n.setAttribute("style",""),n.parentElement.parentElement.parentElement.setAttribute("style",""),n.firstElementChild.setAttribute("style","display:;"),null==r||r.show()),l?i.setAttribute("style","display: none;"):i.setAttribute("style","display: ;"),n.children))if("annobox"==a.className){var s=a.getAttribute("style");s=l?s.replace("display: none;",""):s.concat("display: none;"),a.setAttribute("style",s)}n.scrollIntoView(!0)}}},tooltip:"Show Comic code"});return e.toolbar.insertItem(0,"showCC",o),new a.DisposableDelegate((()=>{o.dispose()}))}}function S(){i.NotebookActions.executed.disconnect(S),i.NotebookActions.executed.connect(x)}class W{createNew(e,t){let o=new r.ToolbarButton({className:"reset",icon:s.refreshIcon,onClick:()=>{J("ResetButton:");let t=e.content.activeCell.model.id,o=K(t);o.reset(),o.updateMetadata(),i.NotebookActions.executed.disconnect(x),i.NotebookActions.executed.connect(S),i.NotebookActions.run(e.content,e.sessionContext)},tooltip:"Reset cell"});return e.toolbar.insertItem(1,"reset",o),new a.DisposableDelegate((()=>{o.dispose()}))}}var D=!1;const O=function(){if(w.length>0){D=!0,U=!0;let t=w.shift(),o=K(t);if(null==o)return D=!1,void(U=!1);let n=0;o.updateFromMetadata();let i=E.shift(),l=0;var e=function(){setTimeout((function(){if(l>=o.mouseEventType.length)return void O();let t=i.children[o.childIndexArray[l]];t=t.getElementsByClassName("jp-OutputArea-output")[0],t.scrollIntoView(!0);let r=t.getBoundingClientRect(),a=r.width*o.relativeMousePosXArray[l]+r.left,s=r.height*o.relativeMousePosYArray[l]+r.top;if("click"==o.mouseEventType[l]||"dblclick"==o.mouseEventType[l]){for(let e=o.mouseClickTrails[n].length-1;e>=0;--e){let i=o.mouseClickTrails[n][e];t=t.children[i]}a=t.clientLeft+t.scrollLeft+1,s=t.clientTop+t.scrollTop+1}let d=new MouseEvent(o.mouseEventType[l],{bubbles:!0,clientX:a,clientY:s});if("click"==o.mouseEventType[l]||"dblclick"==o.mouseEventType[l])t.dispatchEvent(d),n++;else{let e=document.elementFromPoint(a,s);null!=e&&void 0!==e&&e.dispatchEvent(d)}l++,e()}),25)};e()}else D=!1,U=!1},V=function(e){let t=e.target;for(;null!=t&&!t.classList.contains("jp-OutputArea-child");)t=t.parentElement;if(null!=t)for(let e=0;e<t.parentElement.childElementCount;++e)if(t.parentElement.children[e]==t)return t=t.getElementsByClassName("jp-OutputArea-output")[0],{rect:t.getBoundingClientRect(),index:e};return{rect:null,index:-1}},H=function(e){if(U)return;let t=V(e);if(!(t.index<0)){var o=y.activeCell.model.id,n=K(o);n.childIndexArray.push(t.index),n.relativeMousePosXArray.push((e.clientX-t.rect.left)/t.rect.width),n.relativeMousePosYArray.push((e.clientY-t.rect.top)/t.rect.height),n.mouseEventType.push(e.type),n.mouseClickTrails.push(function(e,t){var o;o=new Array;let n=document.elementFromPoint(e,t);for(;null!=n&&!n.classList.contains("jp-OutputArea-output");){for(let e=0;e<n.parentElement.children.length;++e)if(n.parentElement.children[e]==n){o.push(e);break}n=n.parentElement}return o}(e.clientX,e.clientY))}};var _;const F=e=>{if(U)return;var t=V(e);let o=t.index;if(!(o<0)){var n=y.activeCell.model.id,i=K(n);i.childIndexArray.push(o),_=t.rect,i.relativeMousePosXArray.push((e.clientX-_.left)/_.width),i.relativeMousePosYArray.push((e.clientY-_.top)/_.height),i.mouseEventType.push(e.type),document.addEventListener("mousemove",z),document.addEventListener("mouseup",G)}},z=e=>{if(U)return;var t=y.activeCell.model.id,o=K(t);let n=o.childIndexArray;n.push(n[n.length-1]);var i=_;o.relativeMousePosXArray.push((e.clientX-i.left)/i.width),o.relativeMousePosYArray.push((e.clientY-i.top)/i.height),o.mouseEventType.push(e.type)},G=function(e){if(U)return;var t=y.activeCell.model.id,o=K(t);let n=o.childIndexArray;n.push(n[n.length-1]);var i=_;o.relativeMousePosXArray.push((e.clientX-i.left)/i.width),o.relativeMousePosYArray.push((e.clientY-i.top)/i.height),o.mouseEventType.push(e.type),document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",G),_=null},K=function(e){for(let t=0;t<h.length;++t)if(h[t].id==e)return h[t];let t=new A(e);return t.updateFromMetadata(),h.push(t),t};var U=!1;class q{createNew(e,t){let o=new r.ToolbarButton({className:"record",icon:s.editIcon,onClick:()=>{if(D=!1,U=!1,"code"==e.content.activeCell.model.type){J("CaptureEventsButtonExtension: Record");var t=e.content.activeCell;(function(e){let t=!1;for(let o=0;o<h.length;++o)if(h[o].id==e){t=!0;break}return t})(t.model.id)||h.push(new A(t.model.id)),K(t.model.id).reset(),t.outputArea.widgets.forEach((e=>{let t=(0,l.toArray)(e.children());for(var o=0;o<t.length;++o)t[o].node.classList.contains("jp-OutputArea-output")&&(t[o].node.removeEventListener("click",H),t[o].node.removeEventListener("dblclick",H),t[o].node.removeEventListener("mousedown",F),t[o].node.addEventListener("click",H),t[o].node.addEventListener("dblclick",H),t[o].node.addEventListener("mousedown",F))}))}},tooltip:"record actions"}),n=new r.ToolbarButton({className:"stop",icon:s.stopIcon,onClick:()=>{if("code"==e.content.activeCell.model.type){J("CaptureEventsButtonExtension: StopRecord");var t=e.content.activeCell;K(t.model.id).updateMetadata()}},tooltip:"stop recording"});return e.toolbar.insertItem(2,"record",o),e.toolbar.insertItem(3,"stop",n),new a.DisposableDelegate((()=>{o.dispose(),n.dispose()}))}}function J(e){let t=Math.floor((Date.now()-g)/1e3);console.log(e+" "+t),b+=e+","+t+",\n"}class Q{createNew(e,t){let o=new r.ToolbarButton({className:"saveCSV",icon:s.saveIcon,onClick:()=>{var e=document.createElement("a");e.href="data:text/csv;charset=utf-8,"+encodeURI(b),e.target="_blank",e.download="output.csv",e.click()},tooltip:"save csv"});return e.toolbar.insertItem(4,"saveCSV",o),new a.DisposableDelegate((()=>{o.dispose()}))}}const Z=k}}]);