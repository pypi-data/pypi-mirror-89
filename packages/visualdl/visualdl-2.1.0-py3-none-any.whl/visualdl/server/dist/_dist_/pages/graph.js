import N,{AsideSection as s}from"../components/Aside.js";import se from"../components/GraphPage/Graph.js";import e,{useCallback as c,useEffect as q,useMemo as D,useRef as O,useState as r}from"../../web_modules/react.js";import ce from"../components/Select.js";import{actions as ie,selectors as me}from"../store/index.js";import{primaryColor as pe,rem as i,size as ue}from"../utils/style.js";import{useDispatch as de,useSelector as he}from"../../web_modules/react-redux.js";import G from"../components/Button.js";import F from"../components/Checkbox.js";import ge from"../components/Content.js";import E from"../components/Field.js";import fe from"../../web_modules/react-spinners/HashLoader.js";import ve from"../components/GraphPage/ModelPropertiesDialog.js";import Ee from"../components/GraphPage/NodeDocumentationSidebar.js";import we from"../components/GraphPage/NodePropertiesSidebar.js";import J from"../components/RadioButton.js";import Se from"../components/RadioGroup.js";import Ce from"../components/GraphPage/Search.js";import be from"../components/Title.js";import je from"../components/GraphPage/Uploader.js";import m from"../../web_modules/styled-components.js";import xe from"../hooks/useRequest.js";import{useTranslation as _e}from"../../web_modules/react-i18next.js";const K=m(G).withConfig({displayName:"graph__FullWidthButton",componentId:"sc-1v5tw03-0"})(["width:100%;"]),ye=m(ce).withConfig({displayName:"graph__FullWidthSelect",componentId:"sc-1v5tw03-1"})(["width:100%;"]),Ne=m.div.withConfig({displayName:"graph__ExportButtonWrapper",componentId:"sc-1v5tw03-2"})(["display:flex;justify-content:space-between;> *{flex:1 1 auto;&:not(:last-child){margin-right:",";}}"],i(20)),De=m(s).withConfig({displayName:"graph__SearchSection",componentId:"sc-1v5tw03-3"})(["max-height:calc(100% - ",");display:flex;flex-direction:column;&:not(:last-child){padding-bottom:0;}"],i(40)),Ge=m.div.withConfig({displayName:"graph__Loading",componentId:"sc-1v5tw03-4"})([""," display:flex;flex-direction:column;justify-content:center;align-items:center;overscroll-behavior:none;cursor:progress;font-size:",";line-height:",";"],ue("100%","100%"),i(16),i(60)),Fe=()=>{const{t:n}=_e(["graph","common"]),P=de(),Q=he(me.graph.model),l=O(null),p=O(null),[w,S]=r(Q),u=c(()=>{p.current&&(p.current.value="",p.current.click())},[]),V=c(t=>{const o=t.target;o&&o.files&&o.files.length&&(P(ie.graph.setModel(o.files)),S(o.files))},[P]),{data:a,loading:C}=xe(w?null:"/graph/graph");q(()=>{a!=null&&a.data.size&&S([new File([a.data],a.filename||"unknown_model")])},[a]);const[b,X]=r([]),[k,z]=r(""),Y=c(t=>{X(t.graphs),z(t.selected||"")},[]),R=c(t=>{var o;z(t),(o=l.current)===null||o===void 0||o.changeGraph(t)},[]),[M,j]=r(""),[d,B]=r(!1),[I,A]=r({text:"",result:[]}),$=c(t=>{var o;j(t),(o=l.current)===null||o===void 0||o.search(t)},[]),W=c(t=>{var o;j(t.name),(o=l.current)===null||o===void 0||o.select(t)},[]),[h,Z]=r(!1),[g,ee]=r(!0),[f,te]=r(!1),[x,oe]=r(!1),[ne,L]=r(null),[v,H]=r(null),[_,y]=r(null);q(()=>{j(""),A({text:"",result:[]})},[w,h,g,f]);const T=D(()=>d?null:e.createElement(K,{type:"primary",rounded:!0,onClick:u},n("graph:change-model")),[n,u,d]),[U,re]=r(!1),le=D(()=>!U||C?null:_?e.createElement(N,{width:i(360)},e.createElement(Ee,{data:_,onClose:()=>y(null)})):v?e.createElement(N,{width:i(360)},e.createElement(we,{data:v,onClose:()=>H(null),showNodeDocumentation:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.showNodeDocumentation(v)}})):e.createElement(N,{bottom:T},e.createElement(De,null,e.createElement(Ce,{text:M,data:I,onChange:$,onSelect:W,onActive:()=>B(!0),onDeactive:()=>B(!1)})),!d&&e.createElement(e.Fragment,null,e.createElement(s,null,e.createElement(K,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.showModelProperties()}},n("graph:model-properties"))),b.length>1&&e.createElement(s,null,e.createElement(E,{label:n("graph:subgraph")},e.createElement(ye,{list:b,value:k,onChange:R}))),e.createElement(s,null,e.createElement(E,{label:n("graph:display-data")},e.createElement("div",null,e.createElement(F,{value:h,onChange:Z},n("graph:show-attributes"))),e.createElement("div",null,e.createElement(F,{value:g,onChange:ee},n("graph:show-initializers"))),e.createElement("div",null,e.createElement(F,{value:f,onChange:te},n("graph:show-node-names"))))),e.createElement(s,null,e.createElement(E,{label:n("graph:direction")},e.createElement(Se,{value:x,onChange:oe},e.createElement(J,{value:!1},n("graph:vertical")),e.createElement(J,{value:!0},n("graph:horizontal"))))),e.createElement(s,null,e.createElement(E,{label:n("graph:export-file")},e.createElement(Ne,null,e.createElement(G,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.export("png")}},n("graph:export-png")),e.createElement(G,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.export("svg")}},n("graph:export-svg"))))))),[n,T,M,d,I,b,k,R,$,W,h,g,f,x,U,C,v,_]),ae=D(()=>e.createElement(je,{onClickUpload:u,onDropFiles:S}),[u]);return e.createElement(e.Fragment,null,e.createElement(be,null,n("common:graph")),e.createElement(ve,{data:ne,onClose:()=>L(null)}),e.createElement(ge,{aside:le},C?e.createElement(Ge,null,e.createElement(fe,{size:"60px",color:pe})):e.createElement(se,{ref:l,files:w,uploader:ae,showAttributes:h,showInitializers:g,showNames:f,horizontal:x,onRendered:()=>re(!0),onOpened:Y,onSearch:t=>A(t),onShowModelProperties:t=>L(t),onShowNodeProperties:t=>{H(t),y(null)},onShowNodeDocumentation:t=>y(t)}),e.createElement("input",{ref:p,type:"file",multiple:!1,onChange:V,style:{display:"none"}})))};export default Fe;
