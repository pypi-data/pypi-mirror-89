(self.webpackChunk_jlab_enhanced_launcher=self.webpackChunk_jlab_enhanced_launcher||[]).push([[821],{821:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var s=a(242),n=a(635),c=a(927),r=a(67),o=a(362),i=a(262),l=a(173),h=a(850),d=a(810),m=a(129),u=a(562),g=a(510),p=a(271);const w=new l.LabIcon({name:"enhLauncher:most-used",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="#616161" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>'}),v=new l.LabIcon({name:"enhLauncher:list",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="#616161" d="M4 14h4v-4H4v4zm0 5h4v-4H4v4zM4 9h4V5H4v4zm5 5h12v-4H9v4zm0 5h12v-4H9v4zM9 5v4h12V5H9z"/></svg>'}),_=new l.LabIcon({name:"enhLauncher:module",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="#616161" d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z"/></svg>'}),b="@jlab-enhanced/launcher:plugin",N=["Notebook","Console"];class j extends n.VDomModel{constructor(e,t){super(),this._items=[],this._settings=null,this._state=null,this._usageData={},this._viewMode="cards",this._settings=e||null,this._state=t||null,this.dispose()}static getItemUID(e){return`${e.command}${JSON.stringify(e.args||{})}`}get categories(){return this._settings?this._settings.composite.categories:["Kernels","Other"]}get nRecentCards(){return this._settings?this._settings.composite.nRecentCards:4}get maxUsageAge(){let e=30;return this._settings&&(e=this._settings.composite.maxUsageAge),24*e*3600*1e3}get usage(){return this._usageData}get viewMode(){return this._viewMode}set viewMode(e){const t=this._viewMode!==e;this._viewMode=e,this._state&&t&&this._state.save(`${b}:viewMode`,e).catch((e=>{console.error("Fail to save view mode",e)}))}add(e){const t=C.createItem(e);return this._items.push(t),this.stateChanged.emit(void 0),new m.DisposableDelegate((()=>{h.ArrayExt.removeFirstOf(this._items,t),this.stateChanged.emit(void 0)}))}items(){return new h.ArrayIterator(this._items.map((e=>{const t=j.getItemUID(e),a=this._usageData[t]||{count:0,mostRecent:0};return Object.assign(Object.assign({},e),a)})))}useCard(e){const t=j.getItemUID(e),a=this._usageData[t],s=Date.now();let n=0;a&&s-a.mostRecent<this.maxUsageAge&&(n=a.count),this._usageData[t]={count:n+1,mostRecent:s},this._state&&this._state.save(`${b}:usageData`,this._usageData).catch((e=>{console.error(`Failed to save ${b}:usageData - ${e.message}`,e)}))}}class L extends n.VDomRenderer{constructor(e){super(e.model),this._cwd="",this._pending=!1,this._searchInput="",this._cwd=e.cwd,this.translator=e.translator||i.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._callback=e.callback,this._commands=e.commands,this.addClass("jp-NewLauncher")}get cwd(){return this._cwd}set cwd(e){this._cwd=e,this.update()}get pending(){return this._pending}set pending(e){this._pending=e}render(){if(!this.model)return null;const e="cards"===this.model.viewMode?"":"-Table",t=Object.create(null);(0,h.each)(this.model.items(),((e,a)=>{const s=e.category||"Other";s in t||(t[s]=[]),t[s].push([e])}));const a=t.Notebook;a&&delete t.Notebook;const s=t.Console;s&&delete t.Console;const n=a;s.forEach((e=>{const t=e[0].args.kernelPreference&&e[0].args.kernelPreference.name||"",a=this._commands.label(e[0].command,e[0].args),s=n.find((e=>{const s=e[0].args.kernelName||"";return this._commands.label(e[0].command,e[0].args)===a&&s===t}));s?s.push(e[0]):n.push(e)})),t.Kernels=n;for(const e in t)t[e]=t[e].sort(((e,t)=>C.sortCmp(e[0],t[0],this._cwd,this._commands)));const c=[],r=[];(0,h.each)(this.model.categories,((e,a)=>{e in t&&r.push(e)}));for(const e in t)-1===this.model.categories.indexOf(e)&&r.push(e);const o=(0,h.toArray)(this.model.items()).sort(((e,t)=>C.sortByUsage(e,t,this.model.maxUsageAge,this._cwd,this._commands)));if(""===this._searchInput){const t=p.createElement("div",{className:"jp-NewLauncher-section",key:"most-used"},p.createElement("div",{className:"jp-NewLauncher-sectionHeader"},p.createElement(w.react,{stylesheet:"launcherSection"}),p.createElement("h2",{className:"jp-NewLauncher-sectionTitle"},this._trans.__("Most Used"))),p.createElement("div",{className:`jp-NewLauncher${e}-cardContainer`},(0,h.toArray)((0,h.map)(o.slice(0,this.model.nRecentCards),(e=>f(N.indexOf(e.category||"Other")>-1,[e],this,this._commands,this._trans,this._callback))))));c.push(t)}return r.forEach((a=>{if(0===t[a].length)return;const s=t[a][0][0],n=Object.assign(Object.assign({},s.args),{cwd:this.cwd}),r="Kernels"===a,o=this._commands.iconClass(s.command,n),i=this._commands.icon(s.command,n),d=i===o?void 0:i,m=p.createElement("div",{className:"jp-NewLauncher-section",key:a},p.createElement("div",{className:"jp-NewLauncher-sectionHeader"},p.createElement(l.LabIcon.resolveReact,{icon:d,iconClass:(0,l.classes)(o,"jp-Icon-cover"),stylesheet:"launcherSection"}),p.createElement("h2",{className:"jp-NewLauncher-sectionTitle"},this._trans.__(a))),p.createElement("div",{className:`jp-NewLauncher${e}-cardContainer`},(0,h.toArray)((0,h.map)(t[a],(e=>{const t=e[0],a=t.command,s=Object.assign(Object.assign({},t.args),{cwd:this.cwd});return-1===this._commands.label(a,s).toLocaleLowerCase().indexOf(this._searchInput.toLocaleLowerCase())?null:f(r,e,this,this._commands,this._trans,this._callback)})))));c.push(m)})),p.createElement("div",{className:"jp-NewLauncher-body"},p.createElement("div",{className:"jp-NewLauncher-content"},p.createElement("div",{className:"jp-NewLauncher-toolbar"},p.createElement("div",{className:"jp-NewLauncher-search"},p.createElement("div",{className:"jp-NewLauncher-search-wrapper"},p.createElement("input",{className:"jp-NewLauncher-search-input",spellCheck:!1,placeholder:"SEARCH",onChange:e=>{this._searchInput=e.target.value||"",this.update()}}))),p.createElement("div",{className:"jp-NewLauncher-cwd"},p.createElement(l.folderIcon.react,{className:"jp-NewLauncher-home",tag:"span",title:d.PageConfig.getOption("serverRoot")||"Jupyter Server Root",margin:"0px 2px"}),p.createElement("h3",{title:this.cwd},`${this.cwd}/`)),p.createElement("div",{className:"jp-NewLauncher-view"},p.createElement("button",{disabled:"cards"===this.model.viewMode,onClick:()=>{this.model.viewMode="cards",this.update()}},p.createElement(_.react,{tag:"span",title:"Card view",elementPosition:"center"})),p.createElement("button",{disabled:"table"===this.model.viewMode,onClick:()=>{this.model.viewMode="table",this.update()}},p.createElement(v.react,{tag:"span",title:"Table view",elementPosition:"center"})))),p.createElement("div",{className:"jp-NewLauncher-content-main"},c)))}}function f(e,t,a,s,c,r){const o="cards"===a.model.viewMode?"":"-Table",i=t[0],h=i.command,d=Object.assign(Object.assign({},i.args),{cwd:a.cwd}),m=s.caption(h,d),u=s.label(h,d),w=e?u:m||u,v=e=>t=>{t.stopPropagation(),!0!==a.pending&&(a.pending=!0,s.execute(e.command,Object.assign(Object.assign({},e.args),{cwd:a.cwd})).then((t=>{a.model.useCard(e),a.pending=!1,t instanceof g.Widget&&(r(t),a.dispose())})).catch((e=>{a.pending=!1,(0,n.showErrorMessage)(c._p("Error","Launcher Error"),e)})))},_=v(i),b=s.iconClass(h,d),j=s.icon(h,d),L=j===b?void 0:j;return p.createElement("div",{className:`jp-NewLauncher-item${o}`,title:w,onClick:_,onKeyPress:e=>{"Enter"===e.key&&_(e)},tabIndex:100,"data-category":i.category||"Other",key:C.keyProperty.get(i)},p.createElement("div",{className:`jp-NewLauncherCard-icon jp-NewLauncher${o}-Cell`},e?i.kernelIconUrl?p.createElement("img",{src:i.kernelIconUrl,className:"jp-NewLauncher-kernelIcon"}):p.createElement("div",{className:"jp-NewLauncherCard-noKernelIcon"},u[0].toUpperCase()):p.createElement(l.LabIcon.resolveReact,{icon:L,iconClass:(0,l.classes)(b,"jp-Icon-cover"),stylesheet:"launcherCard"})),p.createElement("div",{className:`jp-NewLauncher-label jp-NewLauncher${o}-Cell`,title:u},u),p.createElement("div",{className:`jp-NewLauncher-options-wrapper jp-NewLauncher${o}-Cell`},p.createElement("div",{className:"jp-NewLauncher-options"},(e=>e.map((t=>{let a="Open";return t.category&&(e.length>1||N.indexOf(t.category)>-1)&&(a=t.category),p.createElement("div",{className:"jp-NewLauncher-option-button",onClick:v(t)},p.createElement("span",{className:"jp-NewLauncher-option-button-text"},a.toUpperCase()))})))(t))))}var C,E;!function(e){let t=0;function a(e,t,a,s){const n=e.rank,c=t.rank;if(n!==c&&void 0!==n&&void 0!==c)return n<c?-1:1;const r=s.label(e.command,Object.assign(Object.assign({},e.args),{cwd:a})),o=s.label(t.command,Object.assign(Object.assign({},t.args),{cwd:a}));return r.localeCompare(o)}e.keyProperty=new u.AttachedProperty({name:"key",create:()=>t++}),e.createItem=function(e){return Object.assign(Object.assign({},e),{category:e.category||"",rank:void 0!==e.rank?e.rank:1/0})},e.sortCmp=a,e.sortByUsage=function(e,t,s,n,c){const r=Date.now(),o=r-e.mostRecent<s?e.count:0,i=r-t.mostRecent<s?t.count:0;if(o===i){const s=t.mostRecent-e.mostRecent;return 0===s?a(e,t,n,c):s}return i-o}}(C||(C={})),function(e){e.create="launcher:create"}(E||(E={}));const y={activate:async function(e,t,a,s,c,r){const{commands:o,shell:i}=e,d=t.load("jupyterlab");let m=null;if(c)try{m=await c.load(b)}catch(e){console.log(`Failed to load settings for ${b}.`,e)}const u=new j(m,r);return r&&Promise.all([r.fetch(`${b}:usageData`),r.fetch(`${b}:viewMode`),e.restored]).then((([e,t])=>{u.viewMode=t||"cards";for(const t in e)u.usage[t]=e[t]})).catch((e=>{console.error("Fail to restore launcher usage data",e)})),o.addCommand(E.create,{label:d.__("New Launcher"),execute:e=>{const t=e.cwd?String(e.cwd):"",s="launcher-"+k.id++,c=new L({model:u,cwd:t,callback:e=>{i.add(e,"main",{ref:s})},commands:o});c.model=u,c.title.icon=l.launcherIcon,c.title.label=d.__("Launcher");const r=new n.MainAreaWidget({content:c});return r.title.closable=!!(0,h.toArray)(i.widgets("main")).length,r.id=s,i.add(r,"main",{activate:e.activate}),a&&a.layoutModified.connect((()=>{r.title.closable=(0,h.toArray)(a.widgets("main")).length>1}),r),r}}),s&&s.addItem({command:E.create,category:d.__("Launcher")}),u},id:b,requires:[i.ITranslator],optional:[s.ILabShell,n.ICommandPalette,r.ISettingRegistry,o.IStateDB],provides:c.ILauncher,autoStart:!0};var k;!function(e){e.id=0}(k||(k={}))}}]);