function z(r,o){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);o&&(i=i.filter(function(b){return Object.getOwnPropertyDescriptor(r,b).enumerable})),t.push.apply(t,i)}return t}function f(r){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?arguments[o]:{};o%2?z(Object(t),!0).forEach(function(i){K(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):z(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function K(r,o,t){return o in r?Object.defineProperty(r,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[o]=t,r}import B from"../LineChart.js";import u,{useCallback as P,useMemo as w,useRef as G,useState as H}from"../../../web_modules/react.js";import{options as T,nearestPoint as J}from"../../resource/curves/index.js";import{rem as C,size as S}from"../../utils/style.js";import Q from"../ChartToolbox.js";import U from"../TooltipTable.js";import{cycleFetcher as V}from"../../utils/fetch.js";import X from"../../utils/event.js";import{format as E}from"../../../web_modules/d3-format.js";import Y from"../../../web_modules/query-string.js";import{renderToStaticMarkup as Z}from"../../../web_modules/react-dom/server.js";import v from"../../../web_modules/styled-components.js";import{useRunningRequest as ee}from"../../hooks/useRequest.js";import{useTranslation as te}from"../../../web_modules/react-i18next.js";import re from"../../../web_modules/lodash/zip.js";const D=E(".4f"),oe=E(".2f"),ne=v.div.withConfig({displayName:"CurveChart__Wrapper",componentId:"sc-1ymmvrt-0"})([""," display:flex;flex-direction:column;align-items:stretch;justify-content:space-between;"],S("100%","100%")),ie=v(B).withConfig({displayName:"CurveChart__StyledLineChart",componentId:"sc-1ymmvrt-1"})(["flex-grow:1;"]),se=v(Q).withConfig({displayName:"CurveChart__Toolbox",componentId:"sc-1ymmvrt-2"})(["margin-left:",";margin-right:",";margin-bottom:",";"],C(20),C(20),C(18)),ae=v.div.withConfig({displayName:"CurveChart__Error",componentId:"sc-1ymmvrt-3"})([""," display:flex;justify-content:center;align-items:center;"],S("100%","100%")),le=({type:r,cid:o,runs:t,tag:i,running:b})=>{const{t:n}=te(["curves","common"]),y=G(null),{data:p,error:$,loading:I}=ee(t.map(e=>`/${r}-curve/list?${Y.stringify({run:e.label,tag:i})}`),!!b,(...e)=>V(e)),[_,R]=H(!1),k=P(()=>{X.emit("toggle-chart-size",o,!_),R(e=>!e)},[o,_]),d=w(()=>t.map((e,l)=>{var s,c;const[h,g,...a]=(s=p==null||((c=p[l])===null||c===void 0)?void 0:c.find(m=>m[1]===e.steps[e.index]))!==null&&s!==void 0?s:[0,0,[],[],[],[],[],[],[]];return[h,g,re(...a)]}),[p,t]),x=w(()=>d.map((e,l)=>{const s=t[l];return{name:s.label,z:l,itemStyle:{color:s.colors[0]},lineStyle:{color:s.colors[0]},data:e[2],encode:{x:[1],y:[0]}}}),[d,t]),O=P(e=>{const l=Array.isArray(e)?e[0].data:e.data,s=J(d.map(a=>a[2]),l[1]),c=[{label:n("curves:threshold")},{label:n("curves:precision")},{label:n("curves:recall")},{label:n("curves:true-positives")},{label:n("curves:false-positives")},{label:n("curves:true-negatives")},{label:n("curves:false-negatives")}],h=s.reduce((a,m,j)=>(a.push(...new Array(m.length).fill(t[j])),a),[]),g=s.reduce((a,m)=>(a.push(...m.map(([j,A,L,M,N,F,W])=>[oe(W),D(j),D(A),L,M,N,F])),a),[]);return Z(u.createElement(U,{run:n("common:runs"),runs:h,columns:c,data:g}))},[d,t,n]),q=w(()=>f(f({},T),{},{tooltip:f(f({},T.tooltip),{},{formatter:O,hideDelay:300,enterable:!0})}),[O]);return!x&&$?u.createElement(ae,null,n("common:error")):u.createElement(ne,null,u.createElement(ie,{ref:y,title:i,options:q,data:x,loading:I,zoom:!0}),u.createElement(se,{items:[{icon:"maximize",activeIcon:"minimize",tooltip:n("curves:maximize"),activeTooltip:n("curves:minimize"),toggle:!0,onClick:k},{icon:"restore-size",tooltip:n("curves:restore"),onClick:()=>{var e;return(e=y.current)===null||e===void 0?void 0:e.restore()}},{icon:"download",tooltip:n("curves:download-image"),onClick:()=>{var e;return(e=y.current)===null||e===void 0?void 0:e.saveAsImage()}}]}))};export default le;
