<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Example of using the comments app &mdash; Django Comments 1.6 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Django Comments 1.6 documentation" href="index.html" />
    <link rel="next" title="Settings that django_comments understands" href="settings.html" />
    <link rel="prev" title="Generic comment moderation" href="moderation.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="settings.html" title="Settings that django_comments understands"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="moderation.html" title="Generic comment moderation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Django Comments 1.6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="example-of-using-the-comments-app">
<h1>Example of using the comments app<a class="headerlink" href="#example-of-using-the-comments-app" title="Permalink to this headline">¶</a></h1>
<p>Follow the first three steps of the <a class="reference internal" href="quickstart.html"><em>quick start guide</em></a>.</p>
<p>Now suppose, you have an app (<code class="docutils literal"><span class="pre">blog</span></code>) with a model (<code class="docutils literal"><span class="pre">Post</span></code>)
to which you want to attach comments. Let&#8217;s also suppose that
you have a template called <code class="docutils literal"><span class="pre">blog_detail.html</span></code> where you want
to display the comments list and comment form.</p>
<div class="section" id="template">
<h2>Template<a class="headerlink" href="#template" title="Permalink to this headline">¶</a></h2>
<p>First, we should load the <code class="docutils literal"><span class="pre">comment</span></code> template tags in the
<code class="docutils literal"><span class="pre">blog_detail.html</span></code> so that we can use its functionality. So
just like all other custom template tag libraries:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">load</span> <span class="nv">comments</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Next, let&#8217;s add the number of comments attached to the particular
model instance of <code class="docutils literal"><span class="pre">Post</span></code>. For this we assume that a context
variable <code class="docutils literal"><span class="pre">object_pk</span></code> is present which gives the <code class="docutils literal"><span class="pre">id</span></code> of the
instance of <code class="docutils literal"><span class="pre">Post</span></code>.</p>
<p>The usage of the <a class="reference internal" href="quickstart.html#std:templatetag-get_comment_count"><code class="xref std std-ttag docutils literal"><span class="pre">get_comment_count</span></code></a> tag is like below:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">get_comment_count</span> <span class="nv">for</span> <span class="nv">blog.post</span> <span class="nv">object_pk</span> <span class="k">as</span> <span class="nv">comment_count</span> <span class="cp">%}</span>
<span class="nt">&lt;p&gt;</span><span class="cp">{{</span> <span class="nv">comment_count</span> <span class="cp">}}</span> comments have been posted.<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
<p>If you have the instance (say <code class="docutils literal"><span class="pre">entry</span></code>) of the model (<code class="docutils literal"><span class="pre">Post</span></code>)
available in the context, then you can refer to it directly:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">get_comment_count</span> <span class="nv">for</span> <span class="nv">entry</span> <span class="k">as</span> <span class="nv">comment_count</span> <span class="cp">%}</span>
<span class="nt">&lt;p&gt;</span><span class="cp">{{</span> <span class="nv">comment_count</span> <span class="cp">}}</span> comments have been posted.<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
<p>Next, we can use the <a class="reference internal" href="quickstart.html#std:templatetag-render_comment_list"><code class="xref std std-ttag docutils literal"><span class="pre">render_comment_list</span></code></a> tag, to render all comments
to the given instance (<code class="docutils literal"><span class="pre">entry</span></code>) by using the <code class="docutils literal"><span class="pre">comments/list.html</span></code> template:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">render_comment_list</span> <span class="nv">for</span> <span class="nv">entry</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Django will will look for the <code class="docutils literal"><span class="pre">list.html</span></code> under the following directories
(for our example):</p>
<div class="highlight-html+django"><div class="highlight"><pre>comments/blog/post/list.html
comments/blog/list.html
comments/list.html
</pre></div>
</div>
<p>To get a list of comments, we make use of the <a class="reference internal" href="quickstart.html#std:templatetag-get_comment_list"><code class="xref std std-ttag docutils literal"><span class="pre">get_comment_list</span></code></a> tag.
Using this tag is very similar to the <a class="reference internal" href="quickstart.html#std:templatetag-get_comment_count"><code class="xref std std-ttag docutils literal"><span class="pre">get_comment_count</span></code></a> tag. We
need to remember that <a class="reference internal" href="quickstart.html#std:templatetag-get_comment_list"><code class="xref std std-ttag docutils literal"><span class="pre">get_comment_list</span></code></a> returns a list of comments
and hence we have to iterate through them to display them:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">get_comment_list</span> <span class="nv">for</span> <span class="nv">blog.post</span> <span class="nv">object_pk</span> <span class="k">as</span> <span class="nv">comment_list</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">comment</span> <span class="k">in</span> <span class="nv">comment_list</span> <span class="cp">%}</span>
<span class="nt">&lt;p&gt;</span>Posted by: <span class="cp">{{</span> <span class="nv">comment.user_name</span> <span class="cp">}}</span> on <span class="cp">{{</span> <span class="nv">comment.submit_date</span> <span class="cp">}}</span><span class="nt">&lt;/p&gt;</span>
...
<span class="nt">&lt;p&gt;</span>Comment: <span class="cp">{{</span> <span class="nv">comment.comment</span> <span class="cp">}}</span><span class="nt">&lt;/p&gt;</span>
...
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Finally, we display the comment form, enabling users to enter their
comments. There are two ways of doing so. The first is when you want to
display the comments template available under your <code class="docutils literal"><span class="pre">comments/form.html</span></code>.
The other method gives you a chance to customize the form.</p>
<p>The first method makes use of the <a class="reference internal" href="quickstart.html#std:templatetag-render_comment_form"><code class="xref std std-ttag docutils literal"><span class="pre">render_comment_form</span></code></a> tag. Its usage
too is similar to the other three tags we have discussed above:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">render_comment_form</span> <span class="nv">for</span> <span class="nv">entry</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>It looks for the <code class="docutils literal"><span class="pre">form.html</span></code> under the following directories
(for our example):</p>
<div class="highlight-html+django"><div class="highlight"><pre>comments/blog/post/form.html
comments/blog/form.html
comments/form.html
</pre></div>
</div>
<p>Since we customize the form in the second method, we make use of another
tag called <a class="reference internal" href="quickstart.html#std:templatetag-comment_form_target"><code class="xref std std-ttag docutils literal"><span class="pre">comment_form_target</span></code></a>. This tag on rendering gives the URL
where the comment form is posted. Without any <a class="reference internal" href="custom.html"><em>customization</em></a>, <a class="reference internal" href="quickstart.html#std:templatetag-comment_form_target"><code class="xref std std-ttag docutils literal"><span class="pre">comment_form_target</span></code></a> evaluates to
<code class="docutils literal"><span class="pre">/comments/post/</span></code>. We use this tag in the form&#8217;s <code class="docutils literal"><span class="pre">action</span></code> attribute.</p>
<p>The <a class="reference internal" href="quickstart.html#std:templatetag-get_comment_form"><code class="xref std std-ttag docutils literal"><span class="pre">get_comment_form</span></code></a> tag renders a <code class="docutils literal"><span class="pre">form</span></code> for a model instance by
creating a context variable. One can iterate over the <code class="docutils literal"><span class="pre">form</span></code> object to
get individual fields. This gives you fine-grain control over the form:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">ifequal</span> <span class="nv">field.name</span> <span class="s2">&quot;comment&quot;</span> <span class="cp">%}</span>
  <span class="c">&lt;!-- Customize the &quot;comment&quot; field, say, make CSS changes --&gt;</span>
...
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>But let&#8217;s look at a simple example:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">get_comment_form</span> <span class="nv">for</span> <span class="nv">entry</span> <span class="k">as</span> <span class="nv">form</span> <span class="cp">%}</span>
<span class="c">&lt;!-- A context variable called form is created with the necessary hidden</span>
<span class="c">fields, timestamps and security hashes --&gt;</span>
<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">comment_form_target</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
    <span class="cp">{{</span> <span class="nv">form</span> <span class="cp">}}</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Post&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;preview&quot;</span> <span class="na">value=</span><span class="s">&quot;Preview&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="flagging">
<h2>Flagging<a class="headerlink" href="#flagging" title="Permalink to this headline">¶</a></h2>
<p>If you want your users to be able to flag comments (say for profanity), you
can just direct them (by placing a link in your comment list) to <code class="docutils literal"><span class="pre">/flag/{{</span>
<span class="pre">comment.id</span> <span class="pre">}}/</span></code>. Similarly, a user with requisite permissions (<code class="docutils literal"><span class="pre">&quot;Can</span>
<span class="pre">moderate</span> <span class="pre">comments&quot;</span></code>) can approve and delete comments. This can also be
done through the <code class="docutils literal"><span class="pre">admin</span></code> as you&#8217;ll see later. You might also want to
customize the following templates:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">flag.html</span></code></li>
<li><code class="docutils literal"><span class="pre">flagged.html</span></code></li>
<li><code class="docutils literal"><span class="pre">approve.html</span></code></li>
<li><code class="docutils literal"><span class="pre">approved.html</span></code></li>
<li><code class="docutils literal"><span class="pre">delete.html</span></code></li>
<li><code class="docutils literal"><span class="pre">deleted.html</span></code></li>
</ul>
<p>found under the directory structure we saw for <code class="docutils literal"><span class="pre">form.html</span></code>.</p>
</div>
<div class="section" id="feeds">
<h2>Feeds<a class="headerlink" href="#feeds" title="Permalink to this headline">¶</a></h2>
<p>Suppose you want to export a <a class="reference external" href="https://docs.djangoproject.com/en/stable/ref/contrib/syndication/">feed</a> of the
latest comments, you can use the built-in <code class="docutils literal"><span class="pre">LatestCommentFeed</span></code>. Just
enable it in your project&#8217;s <code class="docutils literal"><span class="pre">urls.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django_comments.feeds</span> <span class="kn">import</span> <span class="n">LatestCommentFeed</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<span class="c"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^feeds/latest/$&#39;</span><span class="p">,</span> <span class="n">LatestCommentFeed</span><span class="p">()),</span>
<span class="c"># ...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Now you should have the latest comment feeds being served off <code class="docutils literal"><span class="pre">/feeds/latest/</span></code>.</p>
</div>
<div class="section" id="moderation">
<h2>Moderation<a class="headerlink" href="#moderation" title="Permalink to this headline">¶</a></h2>
<p>Now that we have the comments framework working, we might want to have some
moderation setup to administer the comments. The comments framework comes
with <a class="reference internal" href="moderation.html"><em>generic comment moderation</em></a>. The comment moderation has the following
features (all of which or only certain can be enabled):</p>
<ul class="simple">
<li>Enable comments for a particular model instance.</li>
<li>Close comments after a particular (user-defined) number of days.</li>
<li>Email new comments to the site-staff.</li>
</ul>
<p>To enable comment moderation, we subclass the <code class="docutils literal"><span class="pre">CommentModerator</span></code> and
register it with the moderation features we want. Let&#8217;s suppose we want to
close comments after 7 days of posting and also send out an email to the
site staff. In <code class="docutils literal"><span class="pre">blog/models.py</span></code>, we register a comment moderator in the
following way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django_comments.moderation</span> <span class="kn">import</span> <span class="n">CommentModerator</span><span class="p">,</span> <span class="n">moderator</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span>   <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">255</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">posted_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">PostModerator</span><span class="p">(</span><span class="n">CommentModerator</span><span class="p">):</span>
    <span class="n">email_notification</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">auto_close_field</span>   <span class="o">=</span> <span class="s">&#39;posted_date&#39;</span>
    <span class="c"># Close the comments after 7 days.</span>
    <span class="n">close_after</span>        <span class="o">=</span> <span class="mi">7</span>

<span class="n">moderator</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostModerator</span><span class="p">)</span>
</pre></div>
</div>
<p>The generic comment moderation also has the facility to remove comments.
These comments can then be moderated by any user who has access to the
<code class="docutils literal"><span class="pre">admin</span></code> site and the <code class="docutils literal"><span class="pre">Can</span> <span class="pre">moderate</span> <span class="pre">comments</span></code> permission (can be set
under the <code class="docutils literal"><span class="pre">Users</span></code> page in the <code class="docutils literal"><span class="pre">admin</span></code>).</p>
<p>The moderator can <code class="docutils literal"><span class="pre">Flag</span></code>, <code class="docutils literal"><span class="pre">Approve</span></code> or <code class="docutils literal"><span class="pre">Remove</span></code> comments using the
<code class="docutils literal"><span class="pre">Action</span></code> drop-down in the <code class="docutils literal"><span class="pre">admin</span></code> under the <code class="docutils literal"><span class="pre">Comments</span></code> page.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only a super-user will be able to delete comments from the database.
<code class="docutils literal"><span class="pre">Remove</span> <span class="pre">Comments</span></code> only sets the <code class="docutils literal"><span class="pre">is_public</span></code> attribute to
<code class="docutils literal"><span class="pre">False</span></code>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Example of using the comments app</a><ul>
<li><a class="reference internal" href="#template">Template</a></li>
<li><a class="reference internal" href="#flagging">Flagging</a></li>
<li><a class="reference internal" href="#feeds">Feeds</a></li>
<li><a class="reference internal" href="#moderation">Moderation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="moderation.html"
                        title="previous chapter">Generic comment moderation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="settings.html"
                        title="next chapter">Settings that <code class="docutils literal"><span class="pre">django_comments</span></code> understands</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/example.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="settings.html" title="Settings that django_comments understands"
             >next</a> |</li>
        <li class="right" >
          <a href="moderation.html" title="Generic comment moderation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Django Comments 1.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, Django Software Foundation and contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>