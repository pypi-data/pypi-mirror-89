function R(t,o){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);o&&(s=s.filter(function(f){return Object.getOwnPropertyDescriptor(t,f).enumerable})),r.push.apply(r,s)}return r}function u(t){for(var o=1;o<arguments.length;o++){var r=arguments[o]!=null?arguments[o]:{};o%2?R(Object(r),!0).forEach(function(s){q(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function q(t,o,r){return o in t?Object.defineProperty(t,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[o]=r,t}import a,{useCallback as D,useEffect as c,useMemo as M,useState as h}from"../../../web_modules/react.js";import{rem as P,transitionProps as k}from"../../utils/style.js";import{AsideSection as w}from"../Aside.js";import W from"../Field.js";import K from"../RunAside.js";import N from"./StepSlider.js";import z from"../TimeModeSelect.js";import{TimeType as B}from"../../resource/curves/index.js";import{cycleFetcher as G}from"../../utils/fetch.js";import H from"../../../web_modules/query-string.js";import J from"../../../web_modules/styled-components.js";import{useRunningRequest as Q}from"../../hooks/useRequest.js";import U from"../../hooks/useTagFilter.js";import{useTranslation as V}from"../../../web_modules/react-i18next.js";const X=J.div.withConfig({displayName:"CurveAside__StepSliderWrapper",componentId:"sc-9miumj-0"})(["max-height:30vh;overflow:auto;overflow-x:hidden;overflow-y:auto;flex-shrink:0;> ",":last-child{padding-bottom:",";margin-bottom:0;}+ .run-section{border-top:1px solid var(--border-color);margin-top:0;padding-top:",";","}&:empty + .run-section{border-top:none;}"],w,P(20),P(20),k("border-color")),Y=({type:t,onChangeLoading:o,onChangeSteps:r,onToggleRunning:s})=>{const{t:f}=V("curves"),[p,E]=h(!0),{runs:O,tags:S,runsInTags:m,selectedRuns:I,onChangeRuns:C,loading:T}=U(`${t}-curve`,p),{data:l}=Q(m.map(e=>`/${t}-curve/steps?${H.stringify({run:e.label})}`),!!p,(...e)=>G(e)),[_,$]=h({}),A=D((e,n)=>$(i=>u(u({},i),{},{[e]:n})),[]);c(()=>$(e=>m.reduce((n,i)=>(e[i.label]!=null&&(n[i.label]=e[i.label]),n),{})),[m]);const v=M(()=>m.map((e,n)=>{var i,b,g,y,j;return u(u({},e),{},{index:(i=_[e.label])!==null&&i!==void 0?i:((b=l==null?void 0:l[n].length)!==null&&b!==void 0?b:1)-1,steps:(g=l==null?void 0:l[n].map(d=>d[1]))!==null&&g!==void 0?g:[],wallTimes:(y=l==null?void 0:l[n].map(d=>Math.floor(d[0])))!==null&&y!==void 0?y:[],relatives:(j=l==null?void 0:l[n].map(d=>d[0]-l[n][0][0]))!==null&&j!==void 0?j:[]})}),[m,l,_]),[x,F]=h(B.Step);return c(()=>{r(S.map(e=>u(u({},e),{},{runs:e.runs.map(n=>u(u({},n),{},{index:0,steps:[],wallTimes:[],relatives:[]},v.find(i=>i.label===n.label)))})))},[S,v,r]),c(()=>{o(T)},[T,o]),c(()=>{s(p)},[s,p]),O.length?a.createElement(K,{runs:O,selectedRuns:I,onChangeRuns:C,running:p,onToggleRunning:E},a.createElement(w,null,a.createElement(W,{label:f("curves:time-display-type")},a.createElement(z,{value:x,onChange:F}))),a.createElement(X,null,v.map(e=>a.createElement(w,{key:e.label},a.createElement(N,{run:e,type:x,onChange:n=>A(e.label,n)}))))):null};export default Y;
